Note: Google Test filter = BundleRegistryConcurrencyTest.testConcurrent
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from BundleRegistryConcurrencyTest
[ RUN      ] BundleRegistryConcurrencyTest.testConcurrent
================== *********************I THINK THIS IS TSAN *******************
WARNING: ThreadSanitizer: double lock of a mutex (pid=1247535) 
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #3 std::lock_guard<std::mutex>::lock_guard(std::mutex&) /usr/include/c++/10/bits/std_mutex.h:159 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #4 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:232 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #5 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #6 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #7 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #8 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xed0ac)
    #9 ~InitialBundleMapCleanup /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #10 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #11 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #12 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #13 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:76 (usFrameworkTests+0x274e46)
    #14 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #15 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #16 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #17 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #18 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #19 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 40 at 0x7b0c00001860 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_MakeUniq<std::mutex>::__single_object std::make_unique<std::mutex>() /usr/include/c++/10/bits/unique_ptr.h:962 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #2 cppmicroservices::BundleRegistry::WaitCondition::WaitCondition() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.h:181 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:218 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:76 (usFrameworkTests+0x274e46)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M680 (0x7b0c00001860) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:76 (usFrameworkTests+0x274e46)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535) ********************* TSAN ERROR *******************8
  Write of size 1 at 0x7b1400002840 by thread T1 (mutexes: write M614, write M680):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #1 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #2 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #3 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #4 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xed0ac)
    #5 ~InitialBundleMapCleanup /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #6 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #7 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #8 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #9 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:76 (usFrameworkTests+0x274e46)
    #10 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #11 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #12 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #13 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #14 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #15 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 1 at 0x7b1400002840 by thread T3 (mutexes: write M680):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:157 (libCppMicroServicesd.so.3.7.6+0x108789)
    #2 wait_for<long double, std::ratio<1, 1000>, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:185 (libCppMicroServicesd.so.3.7.6+0x108789)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:76 (usFrameworkTests+0x274e46)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 80 at 0x7b1400002800 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_Scoped_node::_Scoped_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, true> > >*, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #2 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::integral_constant<bool, true>, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:1673 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #3 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:788 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #4 std::enable_if<std::is_constructible<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&>::value, std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> >::type std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > > >::insert<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/unordered_map.h:592 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:219 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:76 (usFrameworkTests+0x274e46)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M614 (0x7b64000021c8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:153 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #7 cppmicroservices::BundleRegistry::Load() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:496 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #8 cppmicroservices::CoreBundleContext::Init() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:175 (libCppMicroServicesd.so.3.7.6+0x11fc67)
    #9 cppmicroservices::FrameworkPrivate::DoInit() /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:58 (libCppMicroServicesd.so.3.7.6+0x5c6e3)
    #10 cppmicroservices::FrameworkPrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:189 (libCppMicroServicesd.so.3.7.6+0x5f4ac)
    #11 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #12 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:114 (usFrameworkTests+0x277137)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M680 (0x7b0c00001860) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:76 (usFrameworkTests+0x274e46)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T3 (tid=1247540, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 in operator()
==================
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=1247535) *********************I THINK THIS IS TSAN *******************8
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x275010)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 40 at 0x7b0c00001830 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_MakeUniq<std::mutex>::__single_object std::make_unique<std::mutex>() /usr/include/c++/10/bits/unique_ptr.h:962 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #2 cppmicroservices::BundleRegistry::WaitCondition::WaitCondition() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.h:181 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:218 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x275010)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M687 (0x7b0c00001830) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x275010)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535) *********************I THINK THIS IS TSAN *******************8
  Write of size 1 at 0x7b1400002a70 by thread T1 (mutexes: write M614, write M687):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #1 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #2 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #3 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #4 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xed0ac)
    #5 ~InitialBundleMapCleanup /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #6 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #7 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #8 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #9 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x275010)
    #10 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #11 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #12 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #13 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #14 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #15 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 1 at 0x7b1400002a70 by thread T3 (mutexes: write M687):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:157 (libCppMicroServicesd.so.3.7.6+0x108789)
    #2 wait_for<long double, std::ratio<1, 1000>, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:185 (libCppMicroServicesd.so.3.7.6+0x108789)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x275010)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 80 at 0x7b1400002a30 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_Scoped_node::_Scoped_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, true> > >*, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #2 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::integral_constant<bool, true>, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:1673 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #3 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:788 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #4 std::enable_if<std::is_constructible<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&>::value, std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> >::type std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > > >::insert<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/unordered_map.h:592 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:219 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x275010)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M614 (0x7b64000021c8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:153 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #7 cppmicroservices::BundleRegistry::Load() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:496 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #8 cppmicroservices::CoreBundleContext::Init() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:175 (libCppMicroServicesd.so.3.7.6+0x11fc67)
    #9 cppmicroservices::FrameworkPrivate::DoInit() /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:58 (libCppMicroServicesd.so.3.7.6+0x5c6e3)
    #10 cppmicroservices::FrameworkPrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:189 (libCppMicroServicesd.so.3.7.6+0x5f4ac)
    #11 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #12 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:114 (usFrameworkTests+0x277137)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M687 (0x7b0c00001830) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x275010)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T3 (tid=1247540, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 in operator()
==================
================== *********************I THINK THIS IS TSAN *******************8
WARNING: ThreadSanitizer: double lock of a mutex (pid=1247535)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #3 std::lock_guard<std::mutex>::lock_guard(std::mutex&) /usr/include/c++/10/bits/std_mutex.h:159 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #4 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:232 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #5 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #6 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #7 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x103ea8)
    #8 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xed0ac)
    #9 ~InitialBundleMapCleanup /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #10 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #11 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #12 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #13 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:82 (usFrameworkTests+0x27556e)
    #14 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #15 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #16 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #17 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #18 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #19 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 40 at 0x7b0c000019b0 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_MakeUniq<std::mutex>::__single_object std::make_unique<std::mutex>() /usr/include/c++/10/bits/unique_ptr.h:962 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #2 cppmicroservices::BundleRegistry::WaitCondition::WaitCondition() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.h:181 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:218 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:82 (usFrameworkTests+0x27556e)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M743 (0x7b0c000019b0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:82 (usFrameworkTests+0x27556e)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
================== *********************I THINK THIS IS TSAN *******************8
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 1 at 0x7b1400002d40 by thread T1 (mutexes: write M614, write M743):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #1 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #2 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #3 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #4 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xed0ac)
    #5 ~InitialBundleMapCleanup /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #6 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #7 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #8 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #9 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:82 (usFrameworkTests+0x27556e)
    #10 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #11 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #12 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #13 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #14 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #15 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 1 at 0x7b1400002d40 by thread T9 (mutexes: write M743):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:157 (libCppMicroServicesd.so.3.7.6+0x108789)
    #2 wait_for<long double, std::ratio<1, 1000>, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:185 (libCppMicroServicesd.so.3.7.6+0x108789)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:82 (usFrameworkTests+0x27556e)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 80 at 0x7b1400002d00 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_Scoped_node::_Scoped_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, true> > >*, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #2 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::integral_constant<bool, true>, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:1673 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #3 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:788 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #4 std::enable_if<std::is_constructible<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&>::value, std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> >::type std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > > >::insert<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/unordered_map.h:592 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:219 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:82 (usFrameworkTests+0x27556e)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M614 (0x7b64000021c8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:153 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #7 cppmicroservices::BundleRegistry::Load() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:496 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #8 cppmicroservices::CoreBundleContext::Init() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:175 (libCppMicroServicesd.so.3.7.6+0x11fc67)
    #9 cppmicroservices::FrameworkPrivate::DoInit() /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:58 (libCppMicroServicesd.so.3.7.6+0x5c6e3)
    #10 cppmicroservices::FrameworkPrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:189 (libCppMicroServicesd.so.3.7.6+0x5f4ac)
    #11 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #12 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:114 (usFrameworkTests+0x277137)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M743 (0x7b0c000019b0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:82 (usFrameworkTests+0x27556e)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T9 (tid=1247546, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 in operator()
==================
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=1247535)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:83 (usFrameworkTests+0x275738)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 40 at 0x7b0c00001920 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_MakeUniq<std::mutex>::__single_object std::make_unique<std::mutex>() /usr/include/c++/10/bits/unique_ptr.h:962 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #2 cppmicroservices::BundleRegistry::WaitCondition::WaitCondition() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.h:181 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:218 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:83 (usFrameworkTests+0x275738)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M751 (0x7b0c00001920) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:83 (usFrameworkTests+0x275738)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 1 at 0x7b1400003100 by thread T1 (mutexes: write M614, write M751):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #1 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #2 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #3 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #4 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xed0ac)
    #5 ~InitialBundleMapCleanup /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #6 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #7 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #8 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #9 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:83 (usFrameworkTests+0x275738)
    #10 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #11 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #12 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #13 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #14 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #15 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 1 at 0x7b1400003100 by thread T11 (mutexes: write M751):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:157 (libCppMicroServicesd.so.3.7.6+0x108789)
    #2 wait_for<long double, std::ratio<1, 1000>, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:185 (libCppMicroServicesd.so.3.7.6+0x108789)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:83 (usFrameworkTests+0x275738)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 80 at 0x7b14000030c0 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_Scoped_node::_Scoped_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, true> > >*, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #2 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::integral_constant<bool, true>, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:1673 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #3 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:788 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #4 std::enable_if<std::is_constructible<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&>::value, std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> >::type std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > > >::insert<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/unordered_map.h:592 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:219 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:83 (usFrameworkTests+0x275738)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M614 (0x7b64000021c8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:153 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #7 cppmicroservices::BundleRegistry::Load() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:496 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #8 cppmicroservices::CoreBundleContext::Init() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:175 (libCppMicroServicesd.so.3.7.6+0x11fc67)
    #9 cppmicroservices::FrameworkPrivate::DoInit() /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:58 (libCppMicroServicesd.so.3.7.6+0x5c6e3)
    #10 cppmicroservices::FrameworkPrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:189 (libCppMicroServicesd.so.3.7.6+0x5f4ac)
    #11 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #12 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:114 (usFrameworkTests+0x277137)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M751 (0x7b0c00001920) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:83 (usFrameworkTests+0x275738)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T11 (tid=1247548, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #3 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #4 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 in operator()
==================
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=1247535)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:84 (usFrameworkTests+0x275902)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 40 at 0x7b0c00001c20 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_MakeUniq<std::mutex>::__single_object std::make_unique<std::mutex>() /usr/include/c++/10/bits/unique_ptr.h:962 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #2 cppmicroservices::BundleRegistry::WaitCondition::WaitCondition() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.h:181 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:218 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:84 (usFrameworkTests+0x275902)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M764 (0x7b0c00001c20) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:84 (usFrameworkTests+0x275902)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 1 at 0x7b1400003240 by thread T1 (mutexes: write M614, write M764):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #1 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #2 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #3 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #4 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xed0ac)
    #5 ~InitialBundleMapCleanup /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #6 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #7 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #8 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #9 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:84 (usFrameworkTests+0x275902)
    #10 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #11 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #12 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #13 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #14 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #15 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 1 at 0x7b1400003240 by thread T5 (mutexes: write M764):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:157 (libCppMicroServicesd.so.3.7.6+0x108789)
    #2 wait_for<long double, std::ratio<1, 1000>, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:185 (libCppMicroServicesd.so.3.7.6+0x108789)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:84 (usFrameworkTests+0x275902)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 80 at 0x7b1400003200 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_Scoped_node::_Scoped_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, true> > >*, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #2 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::integral_constant<bool, true>, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:1673 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #3 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:788 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #4 std::enable_if<std::is_constructible<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&>::value, std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> >::type std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > > >::insert<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/unordered_map.h:592 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:219 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:84 (usFrameworkTests+0x275902)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M614 (0x7b64000021c8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:153 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #7 cppmicroservices::BundleRegistry::Load() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:496 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #8 cppmicroservices::CoreBundleContext::Init() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:175 (libCppMicroServicesd.so.3.7.6+0x11fc67)
    #9 cppmicroservices::FrameworkPrivate::DoInit() /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:58 (libCppMicroServicesd.so.3.7.6+0x5c6e3)
    #10 cppmicroservices::FrameworkPrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:189 (libCppMicroServicesd.so.3.7.6+0x5f4ac)
    #11 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #12 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:114 (usFrameworkTests+0x277137)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M764 (0x7b0c00001c20) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:84 (usFrameworkTests+0x275902)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T5 (tid=1247542, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 in operator()
==================
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=1247535)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:85 (usFrameworkTests+0x275acc)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 40 at 0x7b0c00001f20 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_MakeUniq<std::mutex>::__single_object std::make_unique<std::mutex>() /usr/include/c++/10/bits/unique_ptr.h:962 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #2 cppmicroservices::BundleRegistry::WaitCondition::WaitCondition() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.h:181 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:218 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:85 (usFrameworkTests+0x275acc)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M777 (0x7b0c00001f20) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:85 (usFrameworkTests+0x275acc)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 1 at 0x7b1400003600 by thread T1 (mutexes: write M614, write M777):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #1 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #2 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #3 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #4 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xed0ac)
    #5 ~InitialBundleMapCleanup /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #6 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #7 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #8 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #9 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:85 (usFrameworkTests+0x275acc)
    #10 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #11 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #12 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #13 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #14 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #15 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 1 at 0x7b1400003600 by thread T7 (mutexes: write M777):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:157 (libCppMicroServicesd.so.3.7.6+0x108789)
    #2 wait_for<long double, std::ratio<1, 1000>, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:185 (libCppMicroServicesd.so.3.7.6+0x108789)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:85 (usFrameworkTests+0x275acc)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 80 at 0x7b14000035c0 allocated by thread T1:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_Scoped_node::_Scoped_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, true> > >*, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #2 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::integral_constant<bool, true>, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:1673 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #3 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:788 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #4 std::enable_if<std::is_constructible<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&>::value, std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> >::type std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > > >::insert<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/unordered_map.h:592 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:219 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:85 (usFrameworkTests+0x275acc)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M614 (0x7b64000021c8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:153 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #7 cppmicroservices::BundleRegistry::Load() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:496 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #8 cppmicroservices::CoreBundleContext::Init() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:175 (libCppMicroServicesd.so.3.7.6+0x11fc67)
    #9 cppmicroservices::FrameworkPrivate::DoInit() /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:58 (libCppMicroServicesd.so.3.7.6+0x5c6e3)
    #10 cppmicroservices::FrameworkPrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:189 (libCppMicroServicesd.so.3.7.6+0x5f4ac)
    #11 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #12 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:114 (usFrameworkTests+0x277137)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M777 (0x7b0c00001f20) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:85 (usFrameworkTests+0x275acc)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1247538, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T7 (tid=1247544, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #3 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #4 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 in operator()
==================
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=1247535)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:87 (usFrameworkTests+0x275e60)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 40 at 0x7b0c00008fd0 allocated by thread T7:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_MakeUniq<std::mutex>::__single_object std::make_unique<std::mutex>() /usr/include/c++/10/bits/unique_ptr.h:962 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #2 cppmicroservices::BundleRegistry::WaitCondition::WaitCondition() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.h:181 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:218 (libCppMicroServicesd.so.3.7.6+0x107b77)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:87 (usFrameworkTests+0x275e60)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M805 (0x7b0c00008fd0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:87 (usFrameworkTests+0x275e60)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T7 (tid=1247544, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #3 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #4 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 1 at 0x7b140000a040 by thread T7 (mutexes: write M614, write M805):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #1 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #2 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #3 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x103eb9)
    #4 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xed0ac)
    #5 ~InitialBundleMapCleanup /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #6 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x1084e2)
    #7 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #8 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #9 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:87 (usFrameworkTests+0x275e60)
    #10 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #11 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #12 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #13 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #14 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #15 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 1 at 0x7b140000a040 by thread T3 (mutexes: write M805):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:157 (libCppMicroServicesd.so.3.7.6+0x108789)
    #2 wait_for<long double, std::ratio<1, 1000>, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:185 (libCppMicroServicesd.so.3.7.6+0x108789)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x108789)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:87 (usFrameworkTests+0x275e60)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 80 at 0x7b140000a000 allocated by thread T7:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_Scoped_node::_Scoped_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, true> > >*, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #2 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::integral_constant<bool, true>, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:1673 (libCppMicroServicesd.so.3.7.6+0x10c227)
    #3 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:788 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #4 std::enable_if<std::is_constructible<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&>::value, std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> >::type std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > > >::insert<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/unordered_map.h:592 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:219 (libCppMicroServicesd.so.3.7.6+0x107d6f)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:87 (usFrameworkTests+0x275e60)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M614 (0x7b64000021c8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:153 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #7 cppmicroservices::BundleRegistry::Load() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:496 (libCppMicroServicesd.so.3.7.6+0x1046be)
    #8 cppmicroservices::CoreBundleContext::Init() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:175 (libCppMicroServicesd.so.3.7.6+0x11fc67)
    #9 cppmicroservices::FrameworkPrivate::DoInit() /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:58 (libCppMicroServicesd.so.3.7.6+0x5c6e3)
    #10 cppmicroservices::FrameworkPrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:189 (libCppMicroServicesd.so.3.7.6+0x5f4ac)
    #11 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #12 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:114 (usFrameworkTests+0x277137)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M805 (0x7b0c00008fd0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10873c)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xced20)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274644)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:87 (usFrameworkTests+0x275e60)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T7 (tid=1247544, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #3 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #4 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T3 (tid=1247540, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x2785e9)
    #3 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 in operator()
==================
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=1247535)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d6fa)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000010000 allocated by thread T7:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:565 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #10 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #11 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #12 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #13 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #14 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #15 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #16 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T7 (tid=1247544, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #3 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #4 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex (/home/tcormack/dev/issue710/CppMicroServices/build/glnxa64/lib/libTestBundleC1d.so+0x1d6fa) 
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 8 at 0x7b40000100a0 by thread T16 (mutexes: write M1039, write M1476):
    #0 <null> <null> (libTestBundleC1d.so+0x11f0f)
    #1 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 8 at 0x7b40000100a0 by thread T39 (mutexes: write M1039):
    #0 <null> <null> (libTestBundleC1d.so+0x173aa)
    #1 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #2 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000010000 allocated by thread T7:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:565 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #10 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #11 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #12 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #13 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #14 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #15 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #16 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1476 (0x7f4000afd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T16 (tid=1247553, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T7 (tid=1247544, finished) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #3 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #4 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race (/home/tcormack/dev/issue710/CppMicroServices/build/glnxa64/lib/libTestBundleC1d.so+0x11f0f) 
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 8 at 0x7b40000100a8 by thread T16 (mutexes: write M1039, write M1476):
    #0 <null> <null> (libTestBundleC1d.so+0x11f21)
    #1 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 8 at 0x7b40000100a8 by thread T39 (mutexes: write M1039):
    #0 <null> <null> (libTestBundleC1d.so+0x17397)
    #1 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #2 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000010000 allocated by thread T7:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:565 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #10 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #11 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #12 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #13 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #14 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #15 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #16 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1476 (0x7f4000afd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T16 (tid=1247553, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T7 (tid=1247544, finished) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #3 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #4 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race (/home/tcormack/dev/issue710/CppMicroServices/build/glnxa64/lib/libTestBundleC1d.so+0x11f21) 
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b40000100b0 by thread T26 (mutexes: write M1039, write M1493):
    #0 <null> <null> (libTestBundleC1d.so+0x1d98a)
    #1 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #2 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b40000100b0 by thread T16 (mutexes: write M1039, write M1476):
    #0 <null> <null> (libTestBundleC1d.so+0x11f2e)
    #1 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000010000 allocated by thread T7:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:565 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #10 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #11 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #12 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #13 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #14 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #15 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #16 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1493 (0x7f3ffbaf31a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1476 (0x7f4000afd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T26 (tid=1247563, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T16 (tid=1247553, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T7 (tid=1247544, finished) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 TestBody /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277523)
    #3 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #4 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race (/home/tcormack/dev/issue710/CppMicroServices/build/glnxa64/lib/libTestBundleC1d.so+0x1d98a) 
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b10000222a8 by thread T26 (mutexes: write M1039, write M1493):
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:1181 (libCppMicroServicesd.so.3.7.6+0xb53b7)
    #1 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&) /usr/include/c++/10/bits/shared_ptr.h:149 (libCppMicroServicesd.so.3.7.6+0xb53b7)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:45 (libCppMicroServicesd.so.3.7.6+0xb53b7)
    #3 <null> <null> (libTestBundleC1d.so+0x11e41)
    #4 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #5 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b10000222a8 by thread T16 (mutexes: write M1039, write M1476):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 56 at 0x7b1000022280 allocated by thread T16:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1493 (0x7f3ffbaf31a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1476 (0x7f4000afd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T26 (tid=1247563, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T16 (tid=1247553, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1181 in std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b10000222b0 by thread T26 (mutexes: write M1039, write M1493):
    #0 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count(std::__shared_count<(__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:737 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #1 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:1181 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #2 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&) /usr/include/c++/10/bits/shared_ptr.h:149 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #3 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:45 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #4 <null> <null> (libTestBundleC1d.so+0x11e41)
    #5 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #6 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b10000222b0 by thread T16 (mutexes: write M1039, write M1476):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 56 at 0x7b1000022280 allocated by thread T16:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1493 (0x7f3ffbaf31a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1476 (0x7f4000afd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T26 (tid=1247563, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T16 (tid=1247553, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:737 in std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count(std::__shared_count<(__gnu_cxx::_Lock_policy)2> const&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 8 at 0x7b1000022280 by thread T26 (mutexes: write M1039, write M1493):
    #0 operator delete(void*, unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:150 (libtsan.so.0+0x842b8)
    #1 <null> <null> (libTestBundleC1d.so+0x11f07)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b1000022280 by thread T16 (mutexes: write M1039, write M1476):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1493 (0x7f3ffbaf31a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1476 (0x7f4000afd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T26 (tid=1247563, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T16 (tid=1247553, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:150 in operator delete(void*, unsigned long)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 8 at 0x7b38000000a8 by thread T24 (mutexes: write M1039, write M1525):
    #0 <null> <null> (libTestBundleC1d.so+0x1d9a4)
    #1 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #2 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b38000000a8 by thread T27 (mutexes: write M1039, write M1509):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 224 at 0x7b3800000000 allocated by thread T27:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1525 (0x7f3ffcaf51a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1509 (0x7f3ffb1bf1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T24 (tid=1247561, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T27 (tid=1247564, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race (/home/tcormack/dev/issue710/CppMicroServices/build/glnxa64/lib/libTestBundleC1d.so+0x1d9a4) 
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 8 at 0x7b38000000d0 by thread T24 (mutexes: write M1039, write M1525):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #2 <null> <null> (libTestBundleC1d.so+0x1d9dc)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b38000000d0 by thread T27 (mutexes: write M1039, write M1509):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 224 at 0x7b3800000000 allocated by thread T27:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1525 (0x7f3ffcaf51a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1509 (0x7f3ffb1bf1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T24 (tid=1247561, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T27 (tid=1247564, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1191 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 8 at 0x7b38000000d8 by thread T24 (mutexes: write M1039, write M1525):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:619 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #2 <null> <null> (libTestBundleC1d.so+0x1d9dc)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b38000000d8 by thread T27 (mutexes: write M1039, write M1509):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 224 at 0x7b3800000000 allocated by thread T27:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1525 (0x7f3ffcaf51a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1509 (0x7f3ffb1bf1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T24 (tid=1247561, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T27 (tid=1247564, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:619 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b5c000002c8 by thread T25 (mutexes: write M1039, write M1695):
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:1181 (libCppMicroServicesd.so.3.7.6+0xb53b7)
    #1 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&) /usr/include/c++/10/bits/shared_ptr.h:149 (libCppMicroServicesd.so.3.7.6+0xb53b7)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:45 (libCppMicroServicesd.so.3.7.6+0xb53b7)
    #3 <null> <null> (libTestBundleC1d.so+0x11e41)
    #4 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #5 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b5c000002c8 by thread T24 (mutexes: write M1039, write M1525):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #2 <null> <null> (libTestBundleC1d.so+0x1d9dc)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 896 at 0x7b5c00000000 allocated by thread T24:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1695 (0x7f3ffc2f41a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1525 (0x7f3ffcaf51a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T25 (tid=1247562, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T24 (tid=1247561, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1181 in std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b5c000002d0 by thread T25 (mutexes: write M1039, write M1695):
    #0 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count(std::__shared_count<(__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:737 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #1 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:1181 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #2 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&) /usr/include/c++/10/bits/shared_ptr.h:149 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #3 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:45 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #4 <null> <null> (libTestBundleC1d.so+0x11e41)
    #5 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #6 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b5c000002d0 by thread T24 (mutexes: write M1039, write M1525):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:619 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #2 <null> <null> (libTestBundleC1d.so+0x1d9dc)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 896 at 0x7b5c00000000 allocated by thread T24:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1695 (0x7f3ffc2f41a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1525 (0x7f3ffcaf51a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T25 (tid=1247562, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T24 (tid=1247561, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:737 in std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count(std::__shared_count<(__gnu_cxx::_Lock_policy)2> const&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Write of size 8 at 0x7b5c000002a0 by thread T25 (mutexes: write M1039, write M1695):
    #0 operator delete(void*, unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:150 (libtsan.so.0+0x842b8)
    #1 <null> <null> (libTestBundleC1d.so+0x11f07)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b5c000002a0 by thread T24 (mutexes: write M1039, write M1525):
    #0 <null> <null> (libTestBundleC1d.so+0x1d9a4)
    #1 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #2 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1695 (0x7f3ffc2f41a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1525 (0x7f3ffcaf51a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T25 (tid=1247562, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T24 (tid=1247561, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:150 in operator delete(void*, unsigned long)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Atomic read of size 1 at 0x7b7c00000000 by thread T39:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17b29)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b7c00000000 by thread T29 (mutexes: write M1039, write M1893):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 3584 at 0x7b7c00000000 allocated by thread T29:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1893 (0x7f3ffa1bd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T29 (tid=1247566, finished) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race (/home/tcormack/dev/issue710/CppMicroServices/build/glnxa64/lib/libTestBundleC1d.so+0x17b29) 
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b7c00000028 by thread T39 (mutexes: write M2031):
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::operator bool() const /usr/include/c++/10/bits/shared_ptr_base.h:1329 (libCppMicroServicesd.so.3.7.6+0xb5930)
    #1 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:80 (libCppMicroServicesd.so.3.7.6+0xb5930)
    #2 <null> <null> (libTestBundleC1d.so+0x17b9d)
    #3 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b7c00000028 by thread T29 (mutexes: write M1039, write M1893):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 3584 at 0x7b7c00000000 allocated by thread T29:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M2031 (0x7b7c00000000) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17b29)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1893 (0x7f3ffa1bd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T29 (tid=1247566, finished) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1329 in std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::operator bool() const
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b1c00013a08 by thread T39 (mutexes: write M2031):
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2>::get() const /usr/include/c++/10/bits/shared_ptr_base.h:1325 (libCppMicroServicesd.so.3.7.6+0xb5941)
    #1 std::__shared_ptr_access<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2, false, false>::_M_get() const /usr/include/c++/10/bits/shared_ptr_base.h:1024 (libCppMicroServicesd.so.3.7.6+0xb5941)
    #2 std::__shared_ptr_access<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2, false, false>::operator->() const /usr/include/c++/10/bits/shared_ptr_base.h:1018 (libCppMicroServicesd.so.3.7.6+0xb5941)
    #3 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:84 (libCppMicroServicesd.so.3.7.6+0xb5941)
    #4 <null> <null> (libTestBundleC1d.so+0x17b9d)
    #5 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b1c00013a08 by thread T16 (mutexes: write M1039):
    #0 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /usr/include/c++/10/bits/shared_ptr_base.h:686 (libCppMicroServicesd.so.3.7.6+0xbbc7b)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb6256)
    #2 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #3 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #4 <null> <null> (libTestBundleC1d.so+0x1d7f3)
    #5 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 104 at 0x7b1c000139b0 allocated by thread T16:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xb6190)
    #2 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #3 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #4 <null> <null> (libTestBundleC1d.so+0x1d7f3)
    #5 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M2031 (0x7b7c00000000) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17b29)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T16 (tid=1247553, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1325 in std::__shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2>::get() const
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Atomic read of size 1 at 0x7b480002dbf0 by thread T39 (mutexes: write M2031):
    #0 __tsan_atomic8_load ../../../../src/libsanitizer/tsan/tsan_interface_atomic.cpp:524 (libtsan.so.0+0x75cd3)
    #1 std::__atomic_base<bool>::load(std::memory_order) const /usr/include/c++/10/bits/atomic_base.h:426 (libCppMicroServicesd.so.3.7.6+0xb5956)
    #2 std::atomic<bool>::operator bool() const /usr/include/c++/10/atomic:87 (libCppMicroServicesd.so.3.7.6+0xb5956)
    #3 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:84 (libCppMicroServicesd.so.3.7.6+0xb5956)
    #4 <null> <null> (libTestBundleC1d.so+0x17b9d)
    #5 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b480002dbf0 by thread T16 (mutexes: write M1039):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xbbb3d)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb6256)
    #3 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #4 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #5 <null> <null> (libTestBundleC1d.so+0x1d7f3)
    #6 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 376 at 0x7b480002da80 allocated by thread T16:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xbbb3d)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb6256)
    #3 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #4 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #5 <null> <null> (libTestBundleC1d.so+0x1d7f3)
    #6 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M2031 (0x7b7c00000000) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17b29)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T16 (tid=1247553, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/atomic_base.h:426 in std::__atomic_base<bool>::load(std::memory_order) const
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Atomic read of size 1 at 0x7b1c000139c0 by thread T39 (mutexes: write M2031):
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::ServiceRegistrationLocks::ServiceRegistrationLocks(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&, std::shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo> const&) /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x7b0d6)
    #2 cppmicroservices::ServiceRegistrationBase::LockServiceRegistration() const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:336 (libCppMicroServicesd.so.3.7.6+0xb58c7)
    #3 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:89 (libCppMicroServicesd.so.3.7.6+0xb5965)
    #4 <null> <null> (libTestBundleC1d.so+0x17b9d)
    #5 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b1c000139c0 by thread T16 (mutexes: write M1039):
    #0 std::__mutex_base::__mutex_base() /usr/include/c++/10/bits/std_mutex.h:65 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #1 std::mutex::mutex() /usr/include/c++/10/bits/std_mutex.h:91 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #2 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::MutexLockingStrategy() /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:47 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #3 cppmicroservices::detail::MultiThreaded<cppmicroservices::detail::MutexLockingStrategy<std::mutex>, cppmicroservices::detail::NoWaitCondition>::MultiThreaded() /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:181 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #4 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBasePrivate.cpp:39 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #5 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb6256)
    #6 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #7 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #8 <null> <null> (libTestBundleC1d.so+0x1d7f3)
    #9 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #10 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 104 at 0x7b1c000139b0 allocated by thread T16:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xb6190)
    #2 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #3 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #4 <null> <null> (libTestBundleC1d.so+0x1d7f3)
    #5 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M2031 (0x7b7c00000000) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17b29)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T16 (tid=1247553, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in cppmicroservices::ServiceRegistrationLocks::ServiceRegistrationLocks(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&, std::shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo> const&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b7c00010638 by thread T39 (mutexes: write M1039, write M3083):
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:1181 (libCppMicroServicesd.so.3.7.6+0xb53b7)
    #1 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&) /usr/include/c++/10/bits/shared_ptr.h:149 (libCppMicroServicesd.so.3.7.6+0xb53b7)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:45 (libCppMicroServicesd.so.3.7.6+0xb53b7)
    #3 <null> <null> (libTestBundleC1d.so+0x121d5)
    #4 <null> <null> (libTestBundleC1d.so+0x179c4)
    #5 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b7c00010638 by thread T17 (mutexes: write M1039, write M2063):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #2 <null> <null> (libTestBundleC1d.so+0x1d9dc)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 3584 at 0x7b7c0000fc00 allocated by thread T17:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M3083 (0x7b7c000001c0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17b29)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M2063 (0x7f40002fc1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T17 (tid=1247554, finished) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1181 in std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b7c00010640 by thread T39 (mutexes: write M1039, write M3083):
    #0 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count(std::__shared_count<(__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:737 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #1 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:1181 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #2 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&) /usr/include/c++/10/bits/shared_ptr.h:149 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #3 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:45 (libCppMicroServicesd.so.3.7.6+0xb53cf)
    #4 <null> <null> (libTestBundleC1d.so+0x121d5)
    #5 <null> <null> (libTestBundleC1d.so+0x179c4)
    #6 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b7c00010640 by thread T17 (mutexes: write M1039, write M2063):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:619 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #2 <null> <null> (libTestBundleC1d.so+0x1d9dc)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 3584 at 0x7b7c0000fc00 allocated by thread T17:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M3083 (0x7b7c000001c0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17b29)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M2063 (0x7f40002fc1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T17 (tid=1247554, finished) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x1162b)
    #3 <null> <null> (libTestBundleC1d.so+0x15f59)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:737 in std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count(std::__shared_count<(__gnu_cxx::_Lock_policy)2> const&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Atomic read of size 1 at 0x7b7c000007a8 by thread T39:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17b29)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b7c000007a8 by thread T29 (mutexes: write M1039, write M1893):
    #0 <null> <null> (libTestBundleC1d.so+0x1d9a4)
    #1 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #2 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 3584 at 0x7b7c00000000 allocated by thread T29:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1893 (0x7f3ffa1bd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T29 (tid=1247566, finished) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race (/home/tcormack/dev/issue710/CppMicroServices/build/glnxa64/lib/libTestBundleC1d.so+0x17b29) 
==================
==================
WARNING: ThreadSanitizer: data race (pid=1247535)
  Read of size 8 at 0x7b7c000007d0 by thread T39 (mutexes: write M3374):
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::operator bool() const /usr/include/c++/10/bits/shared_ptr_base.h:1329 (libCppMicroServicesd.so.3.7.6+0xb5930)
    #1 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:80 (libCppMicroServicesd.so.3.7.6+0xb5930)
    #2 <null> <null> (libTestBundleC1d.so+0x17b9d)
    #3 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b7c000007d0 by thread T29 (mutexes: write M1039, write M1893):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #2 <null> <null> (libTestBundleC1d.so+0x1d9dc)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 3584 at 0x7b7c00000000 allocated by thread T29:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 <null> <null> (libTestBundleC1d.so+0x12043)
    #2 <null> <null> (libTestBundleC1d.so+0x1dc4d)
    #3 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #4 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M3374 (0x7b7c000007a8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17b29)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1039 (0x7b4000010048) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x17cc1)
    #2 <null> <null> (libTestBundleC1d.so+0xbb4f)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1893 (0x7f3ffa1bd1a0) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 <null> <null> (libTestBundleC1d.so+0x1d936)
    #2 <null> <null> (libTestBundleC1d.so+0xe7bf)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T39 (tid=1247576, running) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T29 (tid=1247566, finished) created by thread T7 at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 <null> <null> (libTestBundleC1d.so+0x15f59)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 TestSerialBundleInstall /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x2765ab)
    #8 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x277fa9)
    #9 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x277fa9)
    #10 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x277fa9)
    #11 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x277fa9)
    #12 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x277fa9)
    #13 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1329 in std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::operator bool() const
==================
[       OK ] BundleRegistryConcurrencyTest.testConcurrent (555 ms)
[----------] 1 test from BundleRegistryConcurrencyTest (555 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (555 ms total)
[  PASSED  ] 1 test.
ThreadSanitizer: reported 36 warnings
