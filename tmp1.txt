Note: Google Test filter = FrameworkTest.Events
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from FrameworkTest
[ RUN      ] FrameworkTest.Events
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=1077419)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libTestBundleC1d.so+0x1e02c)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libTestBundleC1d.so+0x1e02c)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libTestBundleC1d.so+0x1e02c)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libTestBundleC1d.so+0x1e02c)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libTestBundleC1d.so+0x1e02c)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:153 (libTestBundleC1d.so+0x1e02c)
    #7 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e02c)
    #8 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #9 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000000700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:565 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #10 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #12 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b40000007a8 by thread T2 (mutexes: write M1003):
    #0 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:112 (libTestBundleC1d.so+0x1e057)
    #1 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e057)
    #2 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b40000007a8 by thread T11 (mutexes: write M1003):
    #0 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x178b3)
    #1 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #2 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #3 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #4 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000000700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:565 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #10 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #12 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T2 (tid=1077423, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T11 (tid=1077432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/vector.tcc:112 in cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b40000007b0 by thread T2 (mutexes: write M1003):
    #0 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:112 (libTestBundleC1d.so+0x1e06a)
    #1 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e06a)
    #2 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b40000007b0 by thread T11 (mutexes: write M1003):
    #0 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x178c7)
    #1 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #2 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #3 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #4 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000000700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:565 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #10 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #12 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T2 (tid=1077423, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T11 (tid=1077432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/vector.tcc:112 in cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b40000007a0 by thread T2 (mutexes: write M1003):
    #0 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::size() const /usr/include/c++/10/bits/stl_vector.h:919 (libTestBundleC1d.so+0x11d08)
    #1 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_check_len(unsigned long, char const*) const /usr/include/c++/10/bits/stl_vector.h:1758 (libTestBundleC1d.so+0x11d08)
    #2 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:436 (libTestBundleC1d.so+0x11d08)
    #3 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #4 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b40000007a0 by thread T11 (mutexes: write M1003):
    #0 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x178a4)
    #1 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #2 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #3 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #4 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000000700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x100a0b)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:565 (libCppMicroServicesd.so.3.7.6+0xfd763)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #10 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #12 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T2 (tid=1077423, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T11 (tid=1077432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/stl_vector.h:919 in std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::size() const
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b0400005840 by thread T10 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb5479)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5479)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b0400005840 by thread T2 (mutexes: write M1003):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 16 at 0x7b0400005840 allocated by thread T2:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T10 (tid=1077431, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T2 (tid=1077423, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1191 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b0400005848 by thread T10 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:761 (libCppMicroServicesd.so.3.7.6+0xb54a8)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb54a8)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b0400005848 by thread T2 (mutexes: write M1003):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 16 at 0x7b0400005840 allocated by thread T2:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T10 (tid=1077431, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T2 (tid=1077423, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:761 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b080000e040 by thread T11:
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::operator bool() const /usr/include/c++/10/bits/shared_ptr_base.h:1329 (libCppMicroServicesd.so.3.7.6+0xb5930)
    #1 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:80 (libCppMicroServicesd.so.3.7.6+0xb5930)
    #2 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17600)
    #3 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #4 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #5 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b080000e040 by thread T10 (mutexes: write M1003):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 32 at 0x7b080000e040 allocated by thread T10:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T11 (tid=1077432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T10 (tid=1077431, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1329 in std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::operator bool() const
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b1c0001e208 by thread T11:
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2>::get() const /usr/include/c++/10/bits/shared_ptr_base.h:1325 (libCppMicroServicesd.so.3.7.6+0xb5941)
    #1 std::__shared_ptr_access<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2, false, false>::_M_get() const /usr/include/c++/10/bits/shared_ptr_base.h:1024 (libCppMicroServicesd.so.3.7.6+0xb5941)
    #2 std::__shared_ptr_access<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2, false, false>::operator->() const /usr/include/c++/10/bits/shared_ptr_base.h:1018 (libCppMicroServicesd.so.3.7.6+0xb5941)
    #3 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:84 (libCppMicroServicesd.so.3.7.6+0xb5941)
    #4 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17600)
    #5 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #6 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #7 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #8 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #9 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #10 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b1c0001e208 by thread T2:
    #0 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /usr/include/c++/10/bits/shared_ptr_base.h:686 (libCppMicroServicesd.so.3.7.6+0xbbc7b)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb6256)
    #2 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #3 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #4 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1df85)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 104 at 0x7b1c0001e1b0 allocated by thread T2:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xb6190)
    #2 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #3 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #4 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1df85)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T11 (tid=1077432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T2 (tid=1077423, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1325 in std::__shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2>::get() const
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Atomic read of size 1 at 0x7b48000200f0 by thread T11:
    #0 __tsan_atomic8_load ../../../../src/libsanitizer/tsan/tsan_interface_atomic.cpp:524 (libtsan.so.0+0x75cd3)
    #1 std::__atomic_base<bool>::load(std::memory_order) const /usr/include/c++/10/bits/atomic_base.h:426 (libCppMicroServicesd.so.3.7.6+0xb5956)
    #2 std::atomic<bool>::operator bool() const /usr/include/c++/10/atomic:87 (libCppMicroServicesd.so.3.7.6+0xb5956)
    #3 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:84 (libCppMicroServicesd.so.3.7.6+0xb5956)
    #4 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17600)
    #5 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #6 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #7 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #8 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #9 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #10 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b48000200f0 by thread T2:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xbbb3d)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb6256)
    #3 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #4 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #5 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1df85)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 376 at 0x7b480001ff80 allocated by thread T2:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xbbb3d)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb6256)
    #3 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #4 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #5 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1df85)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T11 (tid=1077432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T2 (tid=1077423, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/atomic_base.h:426 in std::__atomic_base<bool>::load(std::memory_order) const
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Write of size 8 at 0x7b4000018190 by thread T9 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x1e084)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x1e084)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x1e084)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:115 (libTestBundleC1d.so+0x1e084)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e084)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b4000018190 by thread T10 (mutexes: write M1003):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 256 at 0x7b4000018100 allocated by thread T10:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T9 (tid=1077430, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T10 (tid=1077431, finished) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1191 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Atomic read of size 1 at 0x7b1c0001e1c0 by thread T11:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::ServiceRegistrationLocks::ServiceRegistrationLocks(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&, std::shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo> const&) /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x7b0d6)
    #2 cppmicroservices::ServiceRegistrationBase::LockServiceRegistration() const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:336 (libCppMicroServicesd.so.3.7.6+0xb58c7)
    #3 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:89 (libCppMicroServicesd.so.3.7.6+0xb5965)
    #4 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17600)
    #5 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #6 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #7 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #8 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #9 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #10 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b1c0001e1c0 by thread T2:
    #0 std::__mutex_base::__mutex_base() /usr/include/c++/10/bits/std_mutex.h:65 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #1 std::mutex::mutex() /usr/include/c++/10/bits/std_mutex.h:91 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #2 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::MutexLockingStrategy() /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:47 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #3 cppmicroservices::detail::MultiThreaded<cppmicroservices::detail::MutexLockingStrategy<std::mutex>, cppmicroservices::detail::NoWaitCondition>::MultiThreaded() /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:181 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #4 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBasePrivate.cpp:39 (libCppMicroServicesd.so.3.7.6+0xbbac5)
    #5 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb6256)
    #6 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #7 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #8 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1df85)
    #9 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #10 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 104 at 0x7b1c0001e1b0 allocated by thread T2:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xb6190)
    #2 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistry.cpp:114 (libCppMicroServicesd.so.3.7.6+0xc0b09)
    #3 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xcd314)
    #4 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1df85)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T11 (tid=1077432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T2 (tid=1077423, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in cppmicroservices::ServiceRegistrationLocks::ServiceRegistrationLocks(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&, std::shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo> const&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Write of size 8 at 0x7b4000018198 by thread T9 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:619 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x1e084)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x1e084)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x1e084)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:115 (libTestBundleC1d.so+0x1e084)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e084)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b4000018198 by thread T10 (mutexes: write M1003):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 256 at 0x7b4000018100 allocated by thread T10:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T9 (tid=1077430, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T10 (tid=1077431, finished) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:619 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b2000010050 by thread T1 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb5479)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5479)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b2000010050 by thread T7 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5484)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x1e084)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x1e084)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x1e084)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:115 (libTestBundleC1d.so+0x1e084)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e084)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 128 at 0x7b2000010000 allocated by thread T7:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1077422, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T7 (tid=1077428, finished) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1191 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b2000010058 by thread T1 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:761 (libCppMicroServicesd.so.3.7.6+0xb54a8)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb54a8)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b2000010058 by thread T7 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:619 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5494)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x1e084)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x1e084)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x1e084)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:115 (libTestBundleC1d.so+0x1e084)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e084)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 128 at 0x7b2000010000 allocated by thread T7:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T1 (tid=1077422, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T7 (tid=1077428, finished) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:761 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b50000301b0 by thread T9 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb5479)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb5479)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b50000301b0 by thread T11 (mutexes: write M1003):
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:1181 (libCppMicroServicesd.so.3.7.6+0xb53c3)
    #1 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&) /usr/include/c++/10/bits/shared_ptr.h:149 (libCppMicroServicesd.so.3.7.6+0xb53c3)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:45 (libCppMicroServicesd.so.3.7.6+0xb53c3)
    #3 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17543)
    #4 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #5 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #6 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #7 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #8 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #9 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 512 at 0x7b5000030000 allocated by thread T5:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T9 (tid=1077430, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T11 (tid=1077432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T5 (tid=1077426, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1191 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=1077419)
  Read of size 8 at 0x7b50000301b8 by thread T9 (mutexes: write M1003):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:761 (libCppMicroServicesd.so.3.7.6+0xb54a8)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb54a8)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/dev/issue710/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b50000301b8 by thread T11 (mutexes: write M1003):
    #0 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count(std::__shared_count<(__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:737 (libCppMicroServicesd.so.3.7.6+0xb53dc)
    #1 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2> const&) /usr/include/c++/10/bits/shared_ptr_base.h:1181 (libCppMicroServicesd.so.3.7.6+0xb53dc)
    #2 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&) /usr/include/c++/10/bits/shared_ptr.h:149 (libCppMicroServicesd.so.3.7.6+0xb53dc)
    #3 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase const&) /home/tcormack/dev/issue710/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:45 (libCppMicroServicesd.so.3.7.6+0xb53dc)
    #4 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17543)
    #5 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #6 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #7 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #8 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #9 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #10 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 512 at 0x7b5000030000 allocated by thread T5:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e2a3)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/dev/issue710/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e2a3)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M1003 (0x7b4000000748) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x177e4)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T9 (tid=1077430, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T11 (tid=1077432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T5 (tid=1077426, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:566 (libCppMicroServicesd.so.3.7.6+0xfdce6)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0xffeaf)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:438 (libCppMicroServicesd.so.3.7.6+0x1007a3)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/dev/issue710/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xc8e99)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x12fdc9)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:761 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
[       OK ] FrameworkTest.Events (561 ms)
[----------] 1 test from FrameworkTest (561 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (561 ms total)
[  PASSED  ] 1 test.
ThreadSanitizer: reported 16 warnings
