(function(){var f,l,t,y,w,v,b,g,i,h,z,k,E,e,p,s,q,o,m,a,D,j,C,x,B,n,d,c,u=[].slice,r={}.hasOwnProperty,A=function(I,G){for(var F in G){if(r.call(G,F)){I[F]=G[F]}}function H(){this.constructor=I}H.prototype=G.prototype;I.prototype=new H();I.__super__=G.prototype;return I};f=this.jQuery;q=(function(){F.prototype.defaults={};function F(H,G){this.$el=f(H);this.options=f.extend({},this.defaults,G)}F.prototype.destroy=function(){return this._deinit()};F.prototype._init=function(){return null};F.prototype._deinit=function(){return null};F.register=function(L,J){var K,I,G,H;H=function(){return"simple_widget_"+J};I=function(O,N){var Q,P,S,R,M;Q=H();for(R=0,M=O.length;R<M;R++){P=O[R];S=new L(P,N);if(!f.data(P,Q)){f.data(P,Q,S)}S._init()}return O};G=function(O){var Q,P,S,R,N,M;Q=H();M=[];for(R=0,N=O.length;R<N;R++){P=O[R];S=f.data(P,Q);if(S&&(S instanceof F)){S.destroy()}M.push(f.removeData(P,Q))}return M};K=function(T,Q,R){var M,U,P,N,O,S;U=null;for(O=0,S=T.length;O<S;O++){M=T[O];P=f.data(M,H());if(P&&(P instanceof F)){N=P[Q];if(N&&(typeof N==="function")){U=N.apply(P,R)}}}return U};return f.fn[J]=function(){var O,N,P,Q,M;P=arguments[0],N=2<=arguments.length?u.call(arguments,1):[];O=this;if(P===void 0||typeof P==="object"){M=P;return I(O,M)}else{if(typeof P==="string"&&P[0]!=="_"){Q=P;if(Q==="destroy"){return G(O)}else{return K(O,Q,N)}}}}};return F})();this.SimpleWidget=q;h=(function(F){A(G,F);function G(){n=G.__super__.constructor.apply(this,arguments);return n}G.is_mouse_handled=false;G.prototype._init=function(){this.$el.bind("mousedown.mousewidget",f.proxy(this._mouseDown,this));this.$el.bind("touchstart.mousewidget",f.proxy(this._touchStart,this));this.is_mouse_started=false;this.mouse_delay=0;this._mouse_delay_timer=null;this._is_mouse_delay_met=true;return this.mouse_down_info=null};G.prototype._deinit=function(){var H;this.$el.unbind("mousedown.mousewidget");this.$el.unbind("touchstart.mousewidget");H=f(document);H.unbind("mousemove.mousewidget");return H.unbind("mouseup.mousewidget")};G.prototype._mouseDown=function(I){var H;if(I.which!==1){return}H=this._handleMouseDown(I,this._getPositionInfo(I));if(H){I.preventDefault()}return H};G.prototype._handleMouseDown=function(I,H){if(G.is_mouse_handled){return}if(this.is_mouse_started){this._handleMouseUp(H)}this.mouse_down_info=H;if(!this._mouseCapture(H)){return}this._handleStartMouse();this.is_mouse_handled=true;return true};G.prototype._handleStartMouse=function(){var H;H=f(document);H.bind("mousemove.mousewidget",f.proxy(this._mouseMove,this));H.bind("touchmove.mousewidget",f.proxy(this._touchMove,this));H.bind("mouseup.mousewidget",f.proxy(this._mouseUp,this));H.bind("touchend.mousewidget",f.proxy(this._touchEnd,this));if(this.mouse_delay){return this._startMouseDelayTimer()}};G.prototype._startMouseDelayTimer=function(){var H=this;if(this._mouse_delay_timer){clearTimeout(this._mouse_delay_timer)}this._mouse_delay_timer=setTimeout(function(){return H._is_mouse_delay_met=true},this.mouse_delay);return this._is_mouse_delay_met=false};G.prototype._mouseMove=function(H){return this._handleMouseMove(H,this._getPositionInfo(H))};G.prototype._handleMouseMove=function(I,H){if(this.is_mouse_started){this._mouseDrag(H);return I.preventDefault()}if(this.mouse_delay&&!this._is_mouse_delay_met){return true}this.is_mouse_started=this._mouseStart(this.mouse_down_info)!==false;if(this.is_mouse_started){this._mouseDrag(H)}else{this._handleMouseUp(H)}return !this.is_mouse_started};G.prototype._getPositionInfo=function(H){return{page_x:H.pageX,page_y:H.pageY,target:H.target,original_event:H}};G.prototype._mouseUp=function(H){return this._handleMouseUp(this._getPositionInfo(H))};G.prototype._handleMouseUp=function(H){var I;I=f(document);I.unbind("mousemove.mousewidget");I.unbind("touchmove.mousewidget");I.unbind("mouseup.mousewidget");I.unbind("touchend.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(H)}};G.prototype._mouseCapture=function(H){return true};G.prototype._mouseStart=function(H){return null};G.prototype._mouseDrag=function(H){return null};G.prototype._mouseStop=function(H){return null};G.prototype.setMouseDelay=function(H){return this.mouse_delay=H};G.prototype._touchStart=function(H){var I;if(H.originalEvent.touches.length>1){return}I=H.originalEvent.changedTouches[0];return this._handleMouseDown(H,this._getPositionInfo(I))};G.prototype._touchMove=function(H){var I;if(H.originalEvent.touches.length>1){return}I=H.originalEvent.changedTouches[0];return this._handleMouseMove(H,this._getPositionInfo(I))};G.prototype._touchEnd=function(H){var I;if(H.originalEvent.touches.length>1){return}I=H.originalEvent.changedTouches[0];return this._handleMouseUp(this._getPositionInfo(I))};return G})(q);this.Tree={};f=this.jQuery;E={getName:function(F){return E.strings[F-1]},nameToIndex:function(G){var H,I,F;for(H=I=1,F=E.strings.length;1<=F?I<=F:I>=F;H=1<=F?++I:--I){if(E.strings[H-1]===G){return H}}return 0}};E.BEFORE=1;E.AFTER=2;E.INSIDE=3;E.NONE=4;E.strings=["before","after","inside","none"];this.Tree.Position=E;z=(function(){function F(H,G,I){if(G==null){G=false}if(I==null){I=F}this.setData(H);this.children=[];this.parent=null;if(G){this.id_mapping={};this.tree=this;this.node_class=I}}F.prototype.setData=function(J){var H,I,G;if(typeof J!=="object"){return this.name=J}else{G=[];for(H in J){I=J[H];if(H==="label"){G.push(this.name=I)}else{G.push(this[H]=I)}}return G}};F.prototype.initFromData=function(H){var G,I,J=this;I=function(K){J.setData(K);if(K.children){return G(K.children)}};G=function(N){var O,L,M,K;for(M=0,K=N.length;M<K;M++){O=N[M];L=new J.tree.node_class("");L.initFromData(O);J.addChild(L)}return null};I(H);return null};F.prototype.loadFromData=function(J){var H,K,I,G;this.removeChildren();for(I=0,G=J.length;I<G;I++){K=J[I];H=new this.tree.node_class(K);this.addChild(H);if(typeof K==="object"&&K.children){H.loadFromData(K.children)}}return null};F.prototype.addChild=function(G){this.children.push(G);return G._setParent(this)};F.prototype.addChildAtPosition=function(H,G){this.children.splice(G,0,H);return H._setParent(this)};F.prototype._setParent=function(G){this.parent=G;this.tree=G.tree;return this.tree.addNodeToIndex(this)};F.prototype.removeChild=function(G){G.removeChildren();return this._removeChild(G)};F.prototype._removeChild=function(G){this.children.splice(this.getChildIndex(G),1);return this.tree.removeNodeFromIndex(G)};F.prototype.getChildIndex=function(G){return f.inArray(G,this.children)};F.prototype.hasChildren=function(){return this.children.length!==0};F.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};F.prototype.iterate=function(I){var G,H=this;G=function(M,P){var O,K,N,L,J;if(M.children){J=M.children;for(N=0,L=J.length;N<L;N++){O=J[N];K=I(O,P);if(H.hasChildren()&&K){G(O,P+1)}}return null}};G(this,0);return null};F.prototype.moveNode=function(H,I,G){if(H.isParentOf(I)){return}H.parent._removeChild(H);if(G===E.AFTER){return I.parent.addChildAtPosition(H,I.parent.getChildIndex(I)+1)}else{if(G===E.BEFORE){return I.parent.addChildAtPosition(H,I.parent.getChildIndex(I))}else{if(G===E.INSIDE){return I.addChildAtPosition(H,0)}}}};F.prototype.getData=function(){var G,H=this;G=function(L){var P,K,N,M,J,O,I;P=[];for(O=0,I=L.length;O<I;O++){N=L[O];M={};for(K in N){J=N[K];if((K!=="parent"&&K!=="children"&&K!=="element"&&K!=="tree")&&Object.prototype.hasOwnProperty.call(N,K)){M[K]=J}}if(N.hasChildren()){M.children=G(N.children)}P.push(M)}return P};return G(this.children)};F.prototype.getNodeByName=function(H){var G;G=null;this.iterate(function(I){if(I.name===H){G=I;return false}else{return true}});return G};F.prototype.addAfter=function(H){var I,G;if(!this.parent){return null}else{G=new this.tree.node_class(H);I=this.parent.getChildIndex(this);this.parent.addChildAtPosition(G,I+1);return G}};F.prototype.addBefore=function(H){var I,G;if(!this.parent){return null}else{G=new this.tree.node_class(H);I=this.parent.getChildIndex(this);this.parent.addChildAtPosition(G,I);return G}};F.prototype.addParent=function(K){var M,L,J,I,H,G;if(!this.parent){return null}else{L=new this.tree.node_class(K);L._setParent(this.tree);J=this.parent;G=J.children;for(I=0,H=G.length;I<H;I++){M=G[I];L.addChild(M)}J.children=[];J.addChild(L);return L}};F.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};F.prototype.append=function(H){var G;G=new this.tree.node_class(H);this.addChild(G);return G};F.prototype.prepend=function(H){var G;G=new this.tree.node_class(H);this.addChildAtPosition(G,0);return G};F.prototype.isParentOf=function(H){var G;G=H.parent;while(G){if(G===this){return true}G=G.parent}return false};F.prototype.getLevel=function(){var H,G;H=0;G=this;while(G.parent){H+=1;G=G.parent}return H};F.prototype.getNodeById=function(G){return this.id_mapping[G]};F.prototype.addNodeToIndex=function(G){if(G.id!=null){return this.id_mapping[G.id]=G}};F.prototype.removeNodeFromIndex=function(G){if(G.id!=null){return delete this.id_mapping[G.id]}};F.prototype.removeChildren=function(){var G=this;this.iterate(function(H){G.tree.removeNodeFromIndex(H);return true});return this.children=[]};F.prototype.getPreviousSibling=function(){var G;if(!this.parent){return null}else{G=this.parent.getChildIndex(this)-1;if(G>=0){return this.parent.children[G]}else{return null}}};F.prototype.getNextSibling=function(){var G;if(!this.parent){return null}else{G=this.parent.getChildIndex(this)+1;if(G<this.parent.children.length){return this.parent.children[G]}else{return null}}};return F})();this.Tree.Node=z;g=(function(G){A(F,G);function F(){d=F.__super__.constructor.apply(this,arguments);return d}F.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:true,useContextMenu:true,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:true,dataUrl:null,closedIcon:"&#x25ba;",openedIcon:"&#x25bc;",slide:true,nodeClass:z,dataFilter:null,keyboardSupport:true,openFolderDelay:500};F.prototype.toggle=function(I,H){if(H==null){H=true}if(I.is_open){return this.closeNode(I,H)}else{return this.openNode(I,H)}};F.prototype.getTree=function(){return this.tree};F.prototype.selectNode=function(H){return this._selectNode(H,false)};F.prototype._selectNode=function(J,H){var L,K,N,I,M=this;if(H==null){H=false}if(!this.select_node_handler){return}L=function(){if(M.options.onCanSelectNode){return M.options.selectable&&M.options.onCanSelectNode(J)}else{return M.options.selectable}};N=function(){var O;O=J.parent;if(O&&O.parent&&!O.is_open){return M.openNode(O,false)}};I=function(){if(M.options.saveState){return M.save_state_handler.saveState()}};if(!J){this._deselectCurrentNode();I();return}if(!L()){return}if(this.select_node_handler.isNodeSelected(J)){if(H){this._deselectCurrentNode();this._triggerEvent("tree.select",{node:null,previous_node:J})}}else{K=this.getSelectedNode();this._deselectCurrentNode();this.addToSelection(J);this._triggerEvent("tree.select",{node:J,deselected_node:K});N()}return I()};F.prototype.getSelectedNode=function(){return this.select_node_handler.getSelectedNode()};F.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};F.prototype.loadData=function(H,I){return this._loadData(H,I)};F.prototype.loadDataFromUrl=function(H,J,I){if(f.type(H)!=="string"){I=J;J=H;H=null}return this._loadDataFromUrl(H,J,I)};F.prototype._loadDataFromUrl=function(H,N,L){var J,M,I,K,O=this;J=null;M=function(){var P;if(!N){J=O.element}else{P=new w(N,O);J=P.getLi()}return J.addClass("jqtree-loading")};K=function(){if(J){return J.removeClass("jqtree-loading")}};I=function(){if(f.type(H)==="string"){H={url:H}}if(!H.method){return H.method="get"}};M();if(!H){H=this._getDataUrlInfo(N)}I();return f.ajax({url:H.url,data:H.data,type:H.method.toUpperCase(),cache:false,dataType:"json",success:function(P){var Q;if(f.isArray(P)||typeof P==="object"){Q=P}else{Q=f.parseJSON(P)}if(O.options.dataFilter){Q=O.options.dataFilter(Q)}K();O._loadData(Q,N);if(L&&f.isFunction(L)){return L()}},error:function(P){K();if(O.options.onLoadFailed){return O.options.onLoadFailed(P)}}})};F.prototype._loadData=function(K,L){var M,I,J,H;if(!K){return}this._triggerEvent("tree.load_data",{tree_data:K});if(!L){this._initTree(K)}else{I=this.select_node_handler.getSelectedNodes(L);for(J=0,H=I.length;J<H;J++){M=I[J];this.select_node_handler.removeFromSelection(M)}L.loadFromData(K);L.load_on_demand=false;this._refreshElements(L.parent)}if(this.is_dragging){return this.dnd_handler.refreshHitAreas()}};F.prototype.getNodeById=function(H){return this.tree.getNodeById(H)};F.prototype.getNodeByName=function(H){return this.tree.getNodeByName(H)};F.prototype.openNode=function(I,H){if(H==null){H=true}return this._openNode(I,H)};F.prototype._openNode=function(J,H,K){var M,I,L=this;if(H==null){H=true}M=function(O,P,N){var Q;Q=new w(O,L);return Q.open(N,P)};if(J.isFolder()){if(J.load_on_demand){return this._loadFolderOnDemand(J,H,K)}else{I=J.parent;while(I&&!I.is_open){if(I.parent){M(I,false,null)}I=I.parent}M(J,H,K);return this._saveState()}}};F.prototype._loadFolderOnDemand=function(I,H,J){var K=this;if(H==null){H=true}return this._loadDataFromUrl(null,I,function(){return K._openNode(I,H,J)})};F.prototype.closeNode=function(I,H){if(H==null){H=true}if(I.isFolder()){new w(I,this).close(H);return this._saveState()}};F.prototype.isDragging=function(){return this.is_dragging};F.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()};F.prototype.addNodeAfter=function(I,H){var J;J=H.addAfter(I);this._refreshElements(H.parent);return J};F.prototype.addNodeBefore=function(I,H){var J;J=H.addBefore(I);this._refreshElements(H.parent);return J};F.prototype.addParentNode=function(I,H){var J;J=H.addParent(I);this._refreshElements(J.parent);return J};F.prototype.removeNode=function(I){var H;H=I.parent;if(H){this.select_node_handler.removeFromSelection(I,true);I.remove();return this._refreshElements(H.parent)}};F.prototype.appendNode=function(J,K){var H,I;if(!K){K=this.tree}H=K.isFolder();I=K.append(J);if(H){this._refreshElements(K)}else{this._refreshElements(K.parent)}return I};F.prototype.prependNode=function(I,J){var H;if(!J){J=this.tree}H=J.prepend(I);this._refreshElements(J);return H};F.prototype.updateNode=function(H,J){var I;I=J.id&&J.id!==H.id;if(I){this.tree.removeNodeFromIndex(H)}H.setData(J);if(I){this.tree.addNodeToIndex(H)}this._refreshElements(H.parent);return this._selectCurrentNode()};F.prototype.moveNode=function(J,K,H){var I;I=E.nameToIndex(H);this.tree.moveNode(J,K,I);return this._refreshElements()};F.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};F.prototype.addToSelection=function(H){this.select_node_handler.addToSelection(H);return this._getNodeElementForNode(H).select()};F.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()};F.prototype.isNodeSelected=function(H){return this.select_node_handler.isNodeSelected(H)};F.prototype.removeFromSelection=function(H){this.select_node_handler.removeFromSelection(H);return this._getNodeElementForNode(H).deselect()};F.prototype.scrollToNode=function(I){var H,J;H=f(I.element);J=H.offset().top-this.$el.offset().top;return this.scroll_handler.scrollTo(J)};F.prototype.getState=function(){return this.save_state_handler.getState()};F.prototype.setState=function(H){this.save_state_handler.setState(H);return this._refreshElements()};F.prototype._init=function(){F.__super__._init.call(this);this.element=this.$el;this.mouse_delay=300;this.is_initialized=false;if(typeof e!=="undefined"&&e!==null){this.save_state_handler=new e(this)}else{this.options.saveState=false}if(typeof s!=="undefined"&&s!==null){this.select_node_handler=new s(this)}if(typeof t!=="undefined"&&t!==null){this.dnd_handler=new t(this)}else{this.options.dragAndDrop=false}if(typeof p!=="undefined"&&p!==null){this.scroll_handler=new p(this)}if((typeof i!=="undefined"&&i!==null)&&(typeof s!=="undefined"&&s!==null)){this.key_handler=new i(this)}this._initData();this.element.click(f.proxy(this._click,this));this.element.dblclick(f.proxy(this._dblclick,this));if(this.options.useContextMenu){return this.element.bind("contextmenu",f.proxy(this._contextmenu,this))}};F.prototype._deinit=function(){this.element.empty();this.element.unbind();this.key_handler.deinit();this.tree=null;return F.__super__._deinit.call(this)};F.prototype._initData=function(){if(this.options.data){return this._loadData(this.options.data)}else{return this._loadDataFromUrl(this._getDataUrlInfo())}};F.prototype._getDataUrlInfo=function(I){var H,K,J=this;H=this.options.dataUrl||this.element.data("url");K=function(){var N,M,L;L={url:H};if(I&&I.id){N={node:I.id};L.data=N}else{M=J._getNodeIdToBeSelected();if(M){N={selected_node:M};L.data=N}}return L};if(f.isFunction(H)){return H(I)}else{if(f.type(H)==="string"){return K()}else{return H}}};F.prototype._getNodeIdToBeSelected=function(){if(this.options.saveState){return this.save_state_handler.getNodeIdToBeSelected()}else{return null}};F.prototype._initTree=function(H){this.tree=new this.options.nodeClass(null,true,this.options.nodeClass);if(this.select_node_handler){this.select_node_handler.clear()}this.tree.loadFromData(H);this._openNodes();this._refreshElements();if(!this.is_initialized){this.is_initialized=true;return this._triggerEvent("tree.init")}};F.prototype._openNodes=function(){var H;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else{if(this.options.autoOpen===true){H=-1}else{H=parseInt(this.options.autoOpen)}}return this.tree.iterate(function(I,J){if(I.hasChildren()){I.is_open=true}return J!==H})};F.prototype._refreshElements=function(K){var P,O,H,J,R,N,L,Q,I,M=this;if(K==null){K=null}L=function(S){if(M.options.autoEscape){return m(S)}else{return S}};R=function(T){var S;if(T){S="jqtree-tree"}else{S=""}return f('<ul class="jqtree_common '+S+'"></ul>')};H=function(S){var T;if(S.isFolder()){T=O(S)}else{T=J(S)}if(M.options.onCreateLi){M.options.onCreateLi(S,T)}return T};J=function(T){var V,S,U;U=["jqtree_common"];if(M.select_node_handler&&M.select_node_handler.isNodeSelected(T)){U.push("jqtree-selected")}V=U.join(" ");S=L(T.name);return f('<li class="'+V+'"><div class="jqtree-element jqtree_common"><span class="jqtree-title jqtree_common">'+S+"</span></div></li>")};O=function(W){var S,U,T,Y,V,X;V=function(){var Z;Z=["jqtree-toggler"];if(!W.is_open){Z.push("jqtree-closed")}return Z.join(" ")};X=function(){var Z;Z=["jqtree-folder"];if(!W.is_open){Z.push("jqtree-closed")}if(M.select_node_handler&&M.select_node_handler.isNodeSelected(W)){Z.push("jqtree-selected")}return Z.join(" ")};U=V();Y=X();T=L(W.name);if(W.is_open){S=M.options.openedIcon}else{S=M.options.closedIcon}return f('<li class="jqtree_common '+Y+'"><div class="jqtree-element jqtree_common"><a class="jqtree_common '+U+'">'+S+'</a><span class="jqtree_common jqtree-title">'+T+"</span></div></li>")};N=function(Z,T,aa,U){var X,W,S,V,Y;W=R(aa);Z.append(W);for(V=0,Y=T.length;V<Y;V++){S=T[V];X=H(S);W.append(X);S.element=X[0];X.data("node",S);if(S.hasChildren()){N(X,S.children,false,S.is_open)}}return null};if(K&&K.parent){Q=false;I=this._getNodeElementForNode(K);I.getUl().remove();P=I.$element}else{K=this.tree;P=this.element;P.empty();Q=true}N(P,K.children,Q,Q);return this._triggerEvent("tree.refresh")};F.prototype._click=function(J){var K,I,H;K=this._getClickTarget(J.target);if(K){if(K.type==="button"){this.toggle(K.node,this.options.slide);J.preventDefault();return J.stopPropagation()}else{if(K.type==="label"){H=K.node;I=this._triggerEvent("tree.click",{node:H,click_event:J});if(!I.isDefaultPrevented()){return this._selectNode(H,true)}}}}};F.prototype._dblclick=function(H){var I;I=this._getClickTarget(H.target);if(I&&I.type==="label"){return this._triggerEvent("tree.dblclick",{node:I.node,click_event:H})}};F.prototype._getClickTarget=function(J){var L,I,H,K;H=f(J);L=H.closest(".jqtree-toggler");if(L.length){K=this._getNode(L);if(K){return{type:"button",node:K}}}else{I=H.closest(".jqtree-element");if(I.length){K=this._getNode(I);if(K){return{type:"label",node:K}}}}return null};F.prototype._getNode=function(H){var I;I=H.closest("li");if(I.length===0){return null}else{return I.data("node")}};F.prototype._getNodeElementForNode=function(H){if(H.isFolder()){return new w(H,this)}else{return new k(H,this)}};F.prototype._getNodeElement=function(H){var I;I=this._getNode(H);if(I){return this._getNodeElementForNode(I)}else{return null}};F.prototype._contextmenu=function(J){var H,I;H=f(J.target).closest("ul.jqtree-tree .jqtree-element");if(H.length){I=this._getNode(H);if(I){J.preventDefault();J.stopPropagation();this._triggerEvent("tree.contextmenu",{node:I,click_event:J});return false}}};F.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};F.prototype._mouseCapture=function(H){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(H)}else{return false}};F.prototype._mouseStart=function(H){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(H)}else{return false}};F.prototype._mouseDrag=function(I){var H;if(this.options.dragAndDrop){H=this.dnd_handler.mouseDrag(I);if(this.scroll_handler){this.scroll_handler.checkScrolling()}return H}else{return false}};F.prototype._mouseStop=function(H){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop(H)}else{return false}};F.prototype._triggerEvent=function(J,H){var I;I=f.Event(J);f.extend(I,H);this.element.trigger(I);return I};F.prototype.testGenerateHitAreas=function(H){this.dnd_handler.current_item=this._getNodeElementForNode(H);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};F.prototype._selectCurrentNode=function(){var H,I;H=this.getSelectedNode();if(H){I=this._getNodeElementForNode(H);if(I){return I.select()}}};F.prototype._deselectCurrentNode=function(){var H;H=this.getSelectedNode();if(H){return this.removeFromSelection(H)}};return F})(h);q.register(g,"tree");k=(function(){function F(G,H){this.init(G,H)}F.prototype.init=function(G,H){this.node=G;this.tree_widget=H;return this.$element=f(G.element)};F.prototype.getUl=function(){return this.$element.children("ul:first")};F.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")};F.prototype.getLi=function(){return this.$element};F.prototype.addDropHint=function(G){if(G===E.INSIDE){return new l(this.$element)}else{return new v(this.node,this.$element,G)}};F.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};F.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")};return F})();w=(function(G){A(F,G);function F(){c=F.__super__.constructor.apply(this,arguments);return c}F.prototype.open=function(K,H){var J,I,L=this;if(H==null){H=true}if(!this.node.is_open){this.node.is_open=true;J=this.getButton();J.removeClass("jqtree-closed");J.html(this.tree_widget.options.openedIcon);I=function(){L.getLi().removeClass("jqtree-closed");if(K){K()}return L.tree_widget._triggerEvent("tree.open",{node:L.node})};if(H){return this.getUl().slideDown("fast",I)}else{this.getUl().show();return I()}}};F.prototype.close=function(H){var J,I,K=this;if(H==null){H=true}if(this.node.is_open){this.node.is_open=false;J=this.getButton();J.addClass("jqtree-closed");J.html(this.tree_widget.options.closedIcon);I=function(){K.getLi().addClass("jqtree-closed");return K.tree_widget._triggerEvent("tree.close",{node:K.node})};if(H){return this.getUl().slideUp("fast",I)}else{this.getUl().hide();return I()}}};F.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")};F.prototype.addDropHint=function(H){if(!this.node.is_open&&H===E.INSIDE){return new l(this.$element)}else{return new v(this.node,this.$element,H)}};return F})(k);m=function(F){return(""+F).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};B=function(K,H){var G,J,I,F;for(G=I=0,F=K.length;I<F;G=++I){J=K[G];if(J===H){return G}}return -1};a=function(G,F){if(G.indexOf){return G.indexOf(F)}else{return B(G,F)}};this.Tree.indexOf=a;this.Tree._indexOf=B;if(!((this.JSON!=null)&&(this.JSON.stringify!=null)&&typeof this.JSON.stringify==="function")){D=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;j={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};C=function(F){D.lastIndex=0;if(D.test(F)){return'"'+F.replace(D,function(G){var H;H=j[G];return(typeof H==="string"?H:"\\u"+("0000"+G.charCodeAt(0).toString(16)).slice(-4))})+'"'}else{return'"'+F+'"'}};x=function(M,J){var H,F,I,N,L,G,K;L=J[M];switch(typeof L){case"string":return C(L);case"number":if(isFinite(L)){return String(L)}else{return"null"}case"boolean":case"null":return String(L);case"object":if(!L){return"null"}I=[];if(Object.prototype.toString.apply(L)==="[object Array]"){for(H=G=0,K=L.length;G<K;H=++G){N=L[H];I[H]=x(H,L)||"null"}return(I.length===0?"[]":"["+I.join(",")+"]")}for(F in L){if(Object.prototype.hasOwnProperty.call(L,F)){N=x(F,L);if(N){I.push(C(F)+":"+N)}}}return(I.length===0?"{}":"{"+I.join(",")+"}")}};if(this.JSON==null){this.JSON={}}this.JSON.stringify=function(F){return x("",{"":F})}}e=(function(){function F(G){this.tree_widget=G}F.prototype.saveState=function(){var G;G=JSON.stringify(this.getState());if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(G)}else{if(this.supportsLocalStorage()){return localStorage.setItem(this.getCookieName(),G)}else{if(f.cookie){f.cookie.raw=true;return f.cookie(this.getCookieName(),G,{path:"/"})}}}};F.prototype.restoreState=function(){var G;G=this.getStateFromStorage();if(G){this.setState(f.parseJSON(G));return true}else{return false}};F.prototype.getStateFromStorage=function(){if(this.tree_widget.options.onGetStateFromStorage){return this.tree_widget.options.onGetStateFromStorage()}else{if(this.supportsLocalStorage()){return localStorage.getItem(this.getCookieName())}else{if(f.cookie){f.cookie.raw=true;return f.cookie(this.getCookieName())}else{return null}}}};F.prototype.getState=function(){var I,H,G,J=this;I=[];this.tree_widget.tree.iterate(function(K){if(K.is_open&&K.id&&K.hasChildren()){I.push(K.id)}return true});H=this.tree_widget.getSelectedNode();if(H){G=H.id}else{G=""}return{open_nodes:I,selected_node:G}};F.prototype.setState=function(I){var J,H,G,K=this;if(I){J=I.open_nodes;G=I.selected_node;this.tree_widget.tree.iterate(function(L){L.is_open=L.id&&L.hasChildren()&&(a(J,L.id)>=0);return true});if(G&&this.tree_widget.select_node_handler){this.tree_widget.select_node_handler.clear();H=this.tree_widget.getNodeById(G);if(H){return this.tree_widget.select_node_handler.addToSelection(H)}}}};F.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};F.prototype.supportsLocalStorage=function(){var G;G=function(){var H,I;if(typeof localStorage==="undefined"||localStorage===null){return false}else{try{I="_storage_test";sessionStorage.setItem(I,true);sessionStorage.removeItem(I)}catch(J){H=J;return false}return true}};if(this._supportsLocalStorage==null){this._supportsLocalStorage=G()}return this._supportsLocalStorage};F.prototype.getNodeIdToBeSelected=function(){var G,H;H=this.getStateFromStorage();if(H){G=f.parseJSON(H);return G.selected_node}else{return null}};return F})();s=(function(){function F(G){this.tree_widget=G;this.clear()}F.prototype.getSelectedNode=function(){var G;G=this.getSelectedNodes();if(G.length){return G[0]}else{return false}};F.prototype.getSelectedNodes=function(){var I,H,G;if(this.selected_single_node){return[this.selected_single_node]}else{G=[];for(I in this.selected_nodes){H=this.tree_widget.getNodeById(I);if(H){G.push(H)}}return G}};F.prototype.isNodeSelected=function(G){if(G.id){return this.selected_nodes[G.id]}else{if(this.selected_single_node){return this.selected_single_node.element===G.element}else{return false}}};F.prototype.clear=function(){this.selected_nodes={};return this.selected_single_node=null};F.prototype.removeFromSelection=function(G,I){var H=this;if(I==null){I=false}if(!G.id){if(this.selected_single_node&&G.element===this.selected_single_node.element){return this.selected_single_node=null}}else{delete this.selected_nodes[G.id];if(I){return G.iterate(function(J){delete H.selected_nodes[G.id];return true})}}};F.prototype.addToSelection=function(G){if(G.id){return this.selected_nodes[G.id]=true}else{return this.selected_single_node=G}};return F})();t=(function(){function F(G){this.tree_widget=G;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false}F.prototype.mouseCapture=function(H){var G,I;G=f(H.target);if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(G)){return null}I=this.tree_widget._getNodeElement(G);if(I&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(I.node)){I=null}}this.current_item=I;return this.current_item!==null};F.prototype.mouseStart=function(G){var H;this.refreshHitAreas();H=f(G.target).offset();this.drag_element=new y(this.current_item.node,G.page_x-H.left,G.page_y-H.top,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("jqtree-moving");return true};F.prototype.mouseDrag=function(G){var I,H;this.drag_element.move(G.page_x,G.page_y);I=this.findHoveredArea(G.page_x,G.page_y);H=this.canMoveToArea(I);if(I){if(this.hovered_area!==I){this.hovered_area=I;if(this.mustOpenFolderTimer(I)){this.startOpenFolderTimer(I.node)}if(H){this.updateDropHint()}}}else{this.removeHover();this.removeDropHint();this.stopOpenFolderTimer()}return true};F.prototype.canMoveToArea=function(G){var H;if(!G){return false}else{if(this.tree_widget.options.onCanMoveTo){H=E.getName(G.position);return this.tree_widget.options.onCanMoveTo(this.current_item.node,G.node,H)}else{return true}}};F.prototype.mouseStop=function(G){this.moveItem(G);this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();if(this.current_item){this.current_item.$element.removeClass("jqtree-moving")}this.is_dragging=false;return false};F.prototype.refreshHitAreas=function(){this.removeHitAreas();return this.generateHitAreas()};F.prototype.removeHitAreas=function(){return this.hit_areas=[]};F.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};F.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};F.prototype.removeHover=function(){return this.hovered_area=null};F.prototype.generateHitAreas=function(){var G;G=new b(this.tree_widget.tree,this.current_item.node,this.getTreeDimensions().bottom);return this.hit_areas=G.generate()};F.prototype.findHoveredArea=function(H,M){var K,J,L,G,I;J=this.getTreeDimensions();if(H<J.left||M<J.top||H>J.right||M>J.bottom){return null}G=0;L=this.hit_areas.length;while(G<L){I=(G+L)>>1;K=this.hit_areas[I];if(M<K.top){L=I}else{if(M>K.bottom){G=I+1}else{return K}}}return null};F.prototype.mustOpenFolderTimer=function(H){var G;G=H.node;return G.isFolder()&&!G.is_open&&H.position===E.INSIDE};F.prototype.updateDropHint=function(){var G;if(!this.hovered_area){return}this.removeDropHint();G=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=G.addDropHint(this.hovered_area.position)};F.prototype.startOpenFolderTimer=function(H){var G,I=this;G=function(){return I.tree_widget._openNode(H,I.tree_widget.options.slide,function(){I.refreshHitAreas();return I.updateDropHint()})};this.stopOpenFolderTimer();return this.open_folder_timer=setTimeout(G,this.tree_widget.options.openFolderDelay)};F.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};F.prototype.moveItem=function(I){var J,L,K,G,H,M,N=this;if(this.hovered_area&&this.hovered_area.position!==E.NONE&&this.canMoveToArea(this.hovered_area)){K=this.current_item.node;M=this.hovered_area.node;G=this.hovered_area.position;H=K.parent;if(G===E.INSIDE){this.hovered_area.node.is_open=true}J=function(){N.tree_widget.tree.moveNode(K,M,G);N.tree_widget.element.empty();return N.tree_widget._refreshElements()};L=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:K,target_node:M,position:E.getName(G),previous_parent:H,do_move:J,original_event:I.original_event}});if(!L.isDefaultPrevented()){return J()}}};F.prototype.getTreeDimensions=function(){var G;G=this.tree_widget.element.offset();return{left:G.left,top:G.top,right:G.left+this.tree_widget.element.width(),bottom:G.top+this.tree_widget.element.height()+16}};return F})();o=(function(){function F(G){this.tree=G}F.prototype.iterate=function(){var G,H,I=this;G=true;H=function(M,J){var T,K,S,P,Q,O,R,L,N;Q=(M.is_open||!M.element)&&M.hasChildren();if(M.element){T=f(M.element);if(!T.is(":visible")){return}if(G){I.handleFirstNode(M,T);G=false}if(!M.hasChildren()){I.handleNode(M,J,T)}else{if(M.is_open){if(!I.handleOpenFolder(M,T)){Q=false}}else{I.handleClosedFolder(M,J,T)}}}if(Q){S=M.children.length;L=M.children;N=[];for(P=O=0,R=L.length;O<R;P=++O){K=L[P];if(P===(S-1)){N.push(H(M.children[P],null))}else{N.push(H(M.children[P],M.children[P+1]))}}return N}};return H(this.tree,null)};F.prototype.handleNode=function(I,H,G){};F.prototype.handleOpenFolder=function(H,G){};F.prototype.handleClosedFolder=function(I,H,G){};F.prototype.handleFirstNode=function(H,G){};return F})();b=(function(F){A(G,F);function G(H,J,I){G.__super__.constructor.call(this,H);this.current_node=J;this.tree_bottom=I}G.prototype.generate=function(){this.positions=[];this.last_top=0;this.iterate();return this.generateHitAreas(this.positions)};G.prototype.getTop=function(H){return H.offset().top};G.prototype.addPosition=function(I,H,J){this.positions.push({top:J,node:I,position:H});return this.last_top=J};G.prototype.handleNode=function(J,I,H){var K;K=this.getTop(H);if(J===this.current_node){this.addPosition(J,E.NONE,K)}else{this.addPosition(J,E.INSIDE,K)}if(I===this.current_node||J===this.current_node){return this.addPosition(J,E.NONE,K)}else{return this.addPosition(J,E.AFTER,K)}};G.prototype.handleOpenFolder=function(I,H){if(I===this.current_node){return false}if(I.children[0]!==this.current_node){this.addPosition(I,E.INSIDE,this.getTop(H))}return true};G.prototype.handleClosedFolder=function(J,I,H){var K;K=this.getTop(H);if(J===this.current_node){return this.addPosition(J,E.NONE,K)}else{this.addPosition(J,E.INSIDE,K);if(I!==this.current_node){return this.addPosition(J,E.AFTER,K)}}};G.prototype.handleFirstNode=function(I,H){if(I!==this.current_node){return this.addPosition(I,E.BEFORE,this.getTop(f(I.element)))}};G.prototype.generateHitAreas=function(J){var N,K,H,M,L,I;M=-1;N=[];K=[];for(L=0,I=J.length;L<I;L++){H=J[L];if(H.top!==M&&N.length){if(N.length){this.generateHitAreasForGroup(K,N,M,H.top)}M=H.top;N=[]}N.push(H)}this.generateHitAreasForGroup(K,N,M,this.tree_bottom);return K};G.prototype.generateHitAreasForGroup=function(J,K,N,H){var I,P,M,L,O;I=(H-N)/K.length;P=N;for(L=0,O=K.length;L<O;L++){M=K[L];J.push({top:P,bottom:P+I,node:M.node,position:M.position});P+=I}return null};return G})(o);y=(function(){function F(I,H,G,J){this.offset_x=H;this.offset_y=G;this.$element=f('<span class="jqtree-title jqtree-dragging">'+I.name+"</span>");this.$element.css("position","absolute");J.append(this.$element)}F.prototype.move=function(H,G){return this.$element.offset({left:H-this.offset_x,top:G-this.offset_y})};F.prototype.remove=function(){return this.$element.remove()};return F})();v=(function(){function F(I,H,G){this.$element=H;this.node=I;this.$ghost=f('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>');if(G===E.AFTER){this.moveAfter()}else{if(G===E.BEFORE){this.moveBefore()}else{if(G===E.INSIDE){if(I.isFolder()&&I.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}}}F.prototype.remove=function(){return this.$ghost.remove()};F.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};F.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};F.prototype.moveInsideOpenFolder=function(){return f(this.node.children[0].element).before(this.$ghost)};F.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};return F})();l=(function(){function F(H){var G,I;G=H.children(".jqtree-element");I=H.width()-4;this.$hint=f('<span class="jqtree-border"></span>');G.append(this.$hint);this.$hint.css({width:I,height:G.height()-4})}F.prototype.remove=function(){return this.$hint.remove()};return F})();p=(function(){function F(G){this.tree_widget=G;this.previous_top=-1;this._initScrollParent()}F.prototype._initScrollParent=function(){var G,H,I,J=this;H=function(){var P,M,L,N,K,O;P=["overflow","overflow-y"];L=function(R){var S,T,Q,U;for(T=0,Q=P.length;T<Q;T++){S=P[T];if((U=f.css(R,S))==="auto"||U==="scroll"){return true}}return false};if(L(J.tree_widget.$el[0])){return J.tree_widget.$el}O=J.tree_widget.$el.parents();for(N=0,K=O.length;N<K;N++){M=O[N];if(L(M)){return f(M)}}return null};I=function(){J.scroll_parent_top=0;return J.$scroll_parent=null};if(this.tree_widget.$el.css("position")==="fixed"){I()}G=H();if(G&&G.length&&G[0].tagName!=="HTML"){this.$scroll_parent=G;return this.scroll_parent_top=this.$scroll_parent.offset().top}else{return I()}};F.prototype.checkScrolling=function(){var G;G=this.tree_widget.dnd_handler.hovered_area;if(G&&G.top!==this.previous_top){this.previous_top=G.top;if(this.$scroll_parent){return this._handleScrollingWithScrollParent(G)}else{return this._handleScrollingWithDocument(G)}}};F.prototype._handleScrollingWithScrollParent=function(H){var G;G=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-H.bottom;if(G<20){this.$scroll_parent[0].scrollTop+=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}else{if((H.top-this.scroll_parent_top)<20){this.$scroll_parent[0].scrollTop-=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}}};F.prototype._handleScrollingWithDocument=function(H){var G;G=H.top-f(document).scrollTop();if(G<20){return f(document).scrollTop(f(document).scrollTop()-20)}else{if(f(window).height()-(H.bottom-f(document).scrollTop())<20){return f(document).scrollTop(f(document).scrollTop()+20)}}};F.prototype.scrollTo=function(H){var G;if(this.$scroll_parent){return this.$scroll_parent[0].scrollTop=H}else{G=this.tree_widget.$el.offset().top;return f(document).scrollTop(H+G)}};F.prototype.isScrolledIntoView=function(H){var G,L,K,J,I;G=f(H);if(this.$scroll_parent){I=0;J=this.$scroll_parent.height();K=G.offset().top-this.scroll_parent_top;L=K+G.height()}else{I=f(window).scrollTop();J=I+f(window).height();K=G.offset().top;L=K+G.height()}return(L<=J)&&(K>=I)};return F})();i=(function(){var J,G,I,F;G=37;F=38;I=39;J=40;function H(K){this.tree_widget=K;if(K.options.keyboardSupport){f(document).bind("keydown.jqtree",f.proxy(this.handleKeyDown,this))}}H.prototype.deinit=function(){return f(document).unbind("keydown.jqtree")};H.prototype.handleKeyDown=function(Q){var L,S,K,P,R,N,M,O=this;if(f(document.activeElement).is("textarea,input")){return true}L=this.tree_widget.getSelectedNode();M=function(T){if(T){O.tree_widget.selectNode(T);if(O.tree_widget.scroll_handler&&(!O.tree_widget.scroll_handler.isScrolledIntoView(f(T.element).find(".jqtree-element")))){O.tree_widget.scrollToNode(T)}return false}else{return true}};K=function(){return M(O.getNextNode(L))};N=function(){return M(O.getPreviousNode(L))};R=function(){if(L.hasChildren()&&!L.is_open){O.tree_widget.openNode(L);return false}else{return true}};P=function(){if(L.hasChildren()&&L.is_open){O.tree_widget.closeNode(L);return false}else{return true}};if(!L){return true}else{S=Q.which;switch(S){case J:return K();case F:return N();case I:return R();case G:return P()}}};H.prototype.getNextNode=function(K,M){var L;if(M==null){M=true}if(M&&K.hasChildren()&&K.is_open){return K.children[0]}else{if(!K.parent){return null}else{L=K.getNextSibling();if(L){return L}else{return this.getNextNode(K.parent,false)}}}};H.prototype.getPreviousNode=function(L){var K;if(!L.parent){return null}else{K=L.getPreviousSibling();if(K){if(!K.hasChildren()||!K.is_open){return K}else{return this.getLastChild(K)}}else{if(L.parent.parent){return L.parent}else{return null}}}};H.prototype.getLastChild=function(L){var K;if(!L.hasChildren()){return null}else{K=L.children[L.children.length-1];if(!K.hasChildren()||!K.is_open){return K}else{return this.getLastChild(K)}}};return H})()}).call(this);