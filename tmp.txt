[==========] Running 66 tests from 12 test suites.
[----------] Global test environment set-up.
[----------] 4 tests from tGenericDSAndCASuite
[ RUN      ] tGenericDSAndCASuite.TestAsyncWorkServiceWithoutUserService
[       OK ] tGenericDSAndCASuite.TestAsyncWorkServiceWithoutUserService (17 ms)
[ RUN      ] tGenericDSAndCASuite.TestUserServiceUsedAfterInstall
[       OK ] tGenericDSAndCASuite.TestUserServiceUsedAfterInstall (18 ms)
[ RUN      ] tGenericDSAndCASuite.TestFallbackUsedAfterUnregister
[       OK ] tGenericDSAndCASuite.TestFallbackUsedAfterUnregister (10 ms)
[ RUN      ] tGenericDSAndCASuite.TestUseAsyncWorkServiceDuringConcurrentBundleOperations
[       OK ] tGenericDSAndCASuite.TestUseAsyncWorkServiceDuringConcurrentBundleOperations (30151 ms)
[----------] 4 tests from tGenericDSAndCASuite (30198 ms total)

[----------] 2 tests from TestCMActivator
[ RUN      ] TestCMActivator.VerifyConfigAdmin
[       OK ] TestCMActivator.VerifyConfigAdmin (5 ms)
[ RUN      ] TestCMActivator.VerifyConcurrentStartStop
[       OK ] TestCMActivator.VerifyConcurrentStartStop (83 ms)
[----------] 2 tests from TestCMActivator (88 ms total)

[----------] 2 tests from TestCMBundleExtension
[ RUN      ] TestCMBundleExtension.CtorInvalidArgs
[       OK ] TestCMBundleExtension.CtorInvalidArgs (3 ms)
[ RUN      ] TestCMBundleExtension.CtorWithValidArgs
[       OK ] TestCMBundleExtension.CtorWithValidArgs (2 ms)
[----------] 2 tests from TestCMBundleExtension (6 ms total)

[----------] 4 tests from TestCMLogger
[ RUN      ] TestCMLogger.VerifyWithoutLoggerService
[       OK ] TestCMLogger.VerifyWithoutLoggerService (2 ms)
[ RUN      ] TestCMLogger.VerifyWithLoggerService
[       OK ] TestCMLogger.VerifyWithLoggerService (3 ms)
[ RUN      ] TestCMLogger.VerifyLoggerServiceStaticBinding
[       OK ] TestCMLogger.VerifyLoggerServiceStaticBinding (6 ms)
[ RUN      ] TestCMLogger.VerifyMultiThreadedAccess
[       OK ] TestCMLogger.VerifyMultiThreadedAccess (30075 ms)
[----------] 4 tests from TestCMLogger (30089 ms total)

[----------] 14 tests from ConfigAdminTests
[ RUN      ] ConfigAdminTests.testProperties
[       OK ] ConfigAdminTests.testProperties (8 ms)
[ RUN      ] ConfigAdminTests.testInstallAndStart
[       OK ] ConfigAdminTests.testInstallAndStart (15 ms)
[ RUN      ] ConfigAdminTests.testServiceUpdated
[       OK ] ConfigAdminTests.testServiceUpdated (25 ms)
[ RUN      ] ConfigAdminTests.testConfigurationRemoved
[       OK ] ConfigAdminTests.testConfigurationRemoved (2024 ms)
[ RUN      ] ConfigAdminTests.testServiceFactoryUpdated
[       OK ] ConfigAdminTests.testServiceFactoryUpdated (2015 ms)
[ RUN      ] ConfigAdminTests.testCreateFactoryConfiguration
[       OK ] ConfigAdminTests.testCreateFactoryConfiguration (15 ms)
[ RUN      ] ConfigAdminTests.testRemoveFactoryConfiguration
[       OK ] ConfigAdminTests.testRemoveFactoryConfiguration (2015 ms)
[ RUN      ] ConfigAdminTests.testDuplicateUpdated
[       OK ] ConfigAdminTests.testDuplicateUpdated (13 ms)
[ RUN      ] ConfigAdminTests.testConcurrentDuplicateManagedServiceUpdated
[       OK ] ConfigAdminTests.testConcurrentDuplicateManagedServiceUpdated (27 ms)
[ RUN      ] ConfigAdminTests.testConcurrentDuplicateManagedServiceFactoryUpdated
[       OK ] ConfigAdminTests.testConcurrentDuplicateManagedServiceFactoryUpdated (13 ms)
[ RUN      ] ConfigAdminTests.testNestedBundleInstallAndStart
[       OK ] ConfigAdminTests.testNestedBundleInstallAndStart (40 ms)
[ RUN      ] ConfigAdminTests.testMultipleManagedServicesInBundleGetUpdate
[       OK ] ConfigAdminTests.testMultipleManagedServicesInBundleGetUpdate (34 ms)
[ RUN      ] ConfigAdminTests.testMultipleManagedFactoriesInBundleGetUpdate
[       OK ] ConfigAdminTests.testMultipleManagedFactoriesInBundleGetUpdate (24 ms)
[ RUN      ] ConfigAdminTests.testManagedServiceRemoveConfigurationsDeadlock
[       OK ] ConfigAdminTests.testManagedServiceRemoveConfigurationsDeadlock (7 ms)
[----------] 14 tests from ConfigAdminTests (6282 ms total)

[----------] 12 tests from TestConfigurationAdminImpl
[ RUN      ] TestConfigurationAdminImpl.VerifyNoUpdateDeadlock
[       OK ] TestConfigurationAdminImpl.VerifyNoUpdateDeadlock (14 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyGetConfiguration
[       OK ] TestConfigurationAdminImpl.VerifyGetConfiguration (4 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyCreateFactoryConfiguration
[       OK ] TestConfigurationAdminImpl.VerifyCreateFactoryConfiguration (4 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyGetFactoryConfiguration
[       OK ] TestConfigurationAdminImpl.VerifyGetFactoryConfiguration (5 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyListConfigurations
[       OK ] TestConfigurationAdminImpl.VerifyListConfigurations (36 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyAddConfigurations
[       OK ] TestConfigurationAdminImpl.VerifyAddConfigurations (13 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyRemoveConfigurations
[       OK ] TestConfigurationAdminImpl.VerifyRemoveConfigurations (3 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyManagedServiceNotification
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=1234649)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (usConfigurationAdminTests+0xc49b2)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (usConfigurationAdminTests+0xc49b2)
    #3 std::lock_guard<std::mutex>::lock_guard(std::mutex&) /usr/include/c++/10/bits/std_mutex.h:159 (usConfigurationAdminTests+0xc49b2)
    #4 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:469 (usConfigurationAdminTests+0xc49b2)
    #5 operator()<cppmicroservices::AnyMap> /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:943 (usConfigurationAdminTests+0xc49b2)
    #6 __invoke_impl<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceNotification_Test::TestBody()::<lambda()> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0xc49b2)
    #7 __invoke_r<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceNotification_Test::TestBody()::<lambda()> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0xc49b2)
    #8 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (usConfigurationAdminTests+0xc49b2)
    #9 std::function<void (cppmicroservices::AnyMap const&)>::operator()(cppmicroservices::AnyMap const&) const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0xf887e)
    #10 decltype (((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}))((get<0ul>)((forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2})))) testing::internal::ApplyImpl<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>, 0ul>(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&, testing::internal::IndexSequence<0ul>) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:405 (usConfigurationAdminTests+0xf887e)
    #11 decltype (ApplyImpl((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}), (forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2}), (testing::internal::MakeIndexSequenceImpl<std::tuple_size<std::remove_reference<std::tuple<cppmicroservices::AnyMap const&> >::type>::value>::type)())) testing::internal::Apply<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&> >(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:414 (usConfigurationAdminTests+0xf887e)
    #12 testing::Action<void (cppmicroservices::AnyMap const&)>::Perform(std::tuple<cppmicroservices::AnyMap const&>) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:496 (usConfigurationAdminTests+0xf891b)
    #13 testing::internal::ActionResultHolder<void>* testing::internal::ActionResultHolder<void>::PerformAction<void (cppmicroservices::AnyMap const&)>(testing::Action<void (cppmicroservices::AnyMap const&)> const&, testing::internal::Function<void (cppmicroservices::AnyMap const&)>::ArgumentTuple&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1445 (usConfigurationAdminTests+0xf891b)
    #14 testing::internal::FunctionMocker<void (cppmicroservices::AnyMap const&)>::UntypedPerformAction(void const*, void*) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1560 (usConfigurationAdminTests+0xf891b)
    #15 testing::internal::UntypedFunctionMockerBase::UntypedInvokeWith(void*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/src/gmock-spec-builders.cc:452 (libgmockd.so.1.11.0+0x33f13)
    #16 notifyServiceUpdated /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:97 (usConfigurationAdminTests+0x1592d1)
    #17 operator()<std::shared_ptr<cppmicroservices::cmimpl::TrackedServiceWrapper<cppmicroservices::service::cm::ManagedService> > > /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:691 (usConfigurationAdminTests+0x15db28)
    #18 for_each<__gnu_cxx::__normal_iterator<std::shared_ptr<cppmicroservices::cmimpl::TrackedServiceWrapper<cppmicroservices::service::cm::ManagedService> >*, std::vector<std::shared_ptr<cppmicroservices::cmimpl::TrackedServiceWrapper<cppmicroservices::service::cm::ManagedService> >, std::allocator<std::shared_ptr<cppmicroservices::cmimpl::TrackedServiceWrapper<cppmicroservices::service::cm::ManagedService> > > > >, cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()>::<lambda(const auto:2&)> > /usr/include/c++/10/bits/stl_algo.h:3839 (usConfigurationAdminTests+0x15db28)
    #19 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:704 (usConfigurationAdminTests+0x15db28)
    #20 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:1059 (usConfigurationAdminTests+0x15efb4)
    #21 __invoke_impl<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x15efb4)
    #22 __invoke_r<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0x15efb4)
    #23 operator() /usr/include/c++/10/future:1432 (usConfigurationAdminTests+0x15efb4)
    #24 operator() /usr/include/c++/10/future:1373 (usConfigurationAdminTests+0x15efb4)
    #25 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x15efb4)
    #26 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:113 (usConfigurationAdminTests+0x15efb4)
    #27 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usConfigurationAdminTests+0x15efb4)
    #28 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0x3f10a)
    #29 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usConfigurationAdminTests+0x3f10a)
    #30 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usConfigurationAdminTests+0x3ad0e)
    #31 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usConfigurationAdminTests+0x3ad0e)
    #32 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usConfigurationAdminTests+0x3ad0e)
    #33 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #34 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #35 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #36 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usConfigurationAdminTests+0x44c45)
    #37 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usConfigurationAdminTests+0x44c45)
    #38 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usConfigurationAdminTests+0x157ca2)
    #39 _M_run /usr/include/c++/10/future:1435 (usConfigurationAdminTests+0x157ca2)
    #40 boost::asio::detail::executor_op<boost::asio::detail::work_dispatcher<cppmicroservices::cmimpl::FallbackAsyncWorkService::post(std::packaged_task<void ()>&&)::{lambda()#1}>, std::allocator<void>, boost::asio::detail::scheduler_operation>::do_complete(void*, std::allocator<void>*, boost::system::error_code const&, unsigned long) /usr/include/c++/10/future:1568 (usConfigurationAdminTests+0x135c7b)
    #41 boost::asio::detail::scheduler_operation::complete(void*, boost::system::error_code const&, unsigned long) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/scheduler_operation.hpp:40 (usConfigurationAdminTests+0x44302)
    #42 boost::asio::detail::scheduler::do_run_one(boost::asio::detail::conditionally_enabled_mutex::scoped_lock&, boost::asio::detail::scheduler_thread_info&, boost::system::error_code const&) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/scheduler.ipp:447 (usConfigurationAdminTests+0x44302)
    #43 boost::asio::detail::scheduler::run(boost::system::error_code&) <null> (usConfigurationAdminTests+0x45503)
    #44 boost::asio::thread_pool::thread_function::operator()() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/impl/thread_pool.ipp:33 (usConfigurationAdminTests+0x45840)
    #45 boost::asio::detail::posix_thread::func<boost::asio::thread_pool::thread_function>::run() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/posix_thread.hpp:86 (usConfigurationAdminTests+0x45840)
    #46 boost_asio_detail_posix_thread_function /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/posix_thread.ipp:74 (usConfigurationAdminTests+0x3d4a5)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001c960)

  Mutex M17873647188105568 is already destroyed.

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=1234649)
  Write of size 4 at 0x7ffcc77cd74c by thread T30 (mutexes: write M17873647188105568):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:470 (usConfigurationAdminTests+0xc49da)
    #1 operator()<cppmicroservices::AnyMap> /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:943 (usConfigurationAdminTests+0xc49da)
    #2 __invoke_impl<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceNotification_Test::TestBody()::<lambda()> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0xc49da)
    #3 __invoke_r<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceNotification_Test::TestBody()::<lambda()> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0xc49da)
    #4 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (usConfigurationAdminTests+0xc49da)
    #5 std::function<void (cppmicroservices::AnyMap const&)>::operator()(cppmicroservices::AnyMap const&) const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0xf887e)
    #6 decltype (((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}))((get<0ul>)((forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2})))) testing::internal::ApplyImpl<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>, 0ul>(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&, testing::internal::IndexSequence<0ul>) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:405 (usConfigurationAdminTests+0xf887e)
    #7 decltype (ApplyImpl((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}), (forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2}), (testing::internal::MakeIndexSequenceImpl<std::tuple_size<std::remove_reference<std::tuple<cppmicroservices::AnyMap const&> >::type>::value>::type)())) testing::internal::Apply<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&> >(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:414 (usConfigurationAdminTests+0xf887e)
    #8 testing::Action<void (cppmicroservices::AnyMap const&)>::Perform(std::tuple<cppmicroservices::AnyMap const&>) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:496 (usConfigurationAdminTests+0xf891b)
    #9 testing::internal::ActionResultHolder<void>* testing::internal::ActionResultHolder<void>::PerformAction<void (cppmicroservices::AnyMap const&)>(testing::Action<void (cppmicroservices::AnyMap const&)> const&, testing::internal::Function<void (cppmicroservices::AnyMap const&)>::ArgumentTuple&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1445 (usConfigurationAdminTests+0xf891b)
    #10 testing::internal::FunctionMocker<void (cppmicroservices::AnyMap const&)>::UntypedPerformAction(void const*, void*) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1560 (usConfigurationAdminTests+0xf891b)
    #11 testing::internal::UntypedFunctionMockerBase::UntypedInvokeWith(void*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/src/gmock-spec-builders.cc:452 (libgmockd.so.1.11.0+0x33f13)
    #12 notifyServiceUpdated /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:97 (usConfigurationAdminTests+0x1592d1)
    #13 operator()<std::shared_ptr<cppmicroservices::cmimpl::TrackedServiceWrapper<cppmicroservices::service::cm::ManagedService> > > /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:691 (usConfigurationAdminTests+0x15db28)
    #14 for_each<__gnu_cxx::__normal_iterator<std::shared_ptr<cppmicroservices::cmimpl::TrackedServiceWrapper<cppmicroservices::service::cm::ManagedService> >*, std::vector<std::shared_ptr<cppmicroservices::cmimpl::TrackedServiceWrapper<cppmicroservices::service::cm::ManagedService> >, std::allocator<std::shared_ptr<cppmicroservices::cmimpl::TrackedServiceWrapper<cppmicroservices::service::cm::ManagedService> > > > >, cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()>::<lambda(const auto:2&)> > /usr/include/c++/10/bits/stl_algo.h:3839 (usConfigurationAdminTests+0x15db28)
    #15 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:704 (usConfigurationAdminTests+0x15db28)
    #16 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:1059 (usConfigurationAdminTests+0x15efb4)
    #17 __invoke_impl<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x15efb4)
    #18 __invoke_r<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0x15efb4)
    #19 operator() /usr/include/c++/10/future:1432 (usConfigurationAdminTests+0x15efb4)
    #20 operator() /usr/include/c++/10/future:1373 (usConfigurationAdminTests+0x15efb4)
    #21 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x15efb4)
    #22 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::NotifyConfigurationUpdated(const string&, long unsigned int)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:113 (usConfigurationAdminTests+0x15efb4)
    #23 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usConfigurationAdminTests+0x15efb4)
    #24 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0x3f10a)
    #25 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usConfigurationAdminTests+0x3f10a)
    #26 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usConfigurationAdminTests+0x3ad0e)
    #27 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usConfigurationAdminTests+0x3ad0e)
    #28 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usConfigurationAdminTests+0x3ad0e)
    #29 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #30 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #31 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #32 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usConfigurationAdminTests+0x44c45)
    #33 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usConfigurationAdminTests+0x44c45)
    #34 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usConfigurationAdminTests+0x157ca2)
    #35 _M_run /usr/include/c++/10/future:1435 (usConfigurationAdminTests+0x157ca2)
    #36 boost::asio::detail::executor_op<boost::asio::detail::work_dispatcher<cppmicroservices::cmimpl::FallbackAsyncWorkService::post(std::packaged_task<void ()>&&)::{lambda()#1}>, std::allocator<void>, boost::asio::detail::scheduler_operation>::do_complete(void*, std::allocator<void>*, boost::system::error_code const&, unsigned long) /usr/include/c++/10/future:1568 (usConfigurationAdminTests+0x135c7b)
    #37 boost::asio::detail::scheduler_operation::complete(void*, boost::system::error_code const&, unsigned long) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/scheduler_operation.hpp:40 (usConfigurationAdminTests+0x44302)
    #38 boost::asio::detail::scheduler::do_run_one(boost::asio::detail::conditionally_enabled_mutex::scoped_lock&, boost::asio::detail::scheduler_thread_info&, boost::system::error_code const&) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/scheduler.ipp:447 (usConfigurationAdminTests+0x44302)
    #39 boost::asio::detail::scheduler::run(boost::system::error_code&) <null> (usConfigurationAdminTests+0x45503)
    #40 boost::asio::thread_pool::thread_function::operator()() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/impl/thread_pool.ipp:33 (usConfigurationAdminTests+0x45840)
    #41 boost::asio::detail::posix_thread::func<boost::asio::thread_pool::thread_function>::run() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/posix_thread.hpp:86 (usConfigurationAdminTests+0x45840)
    #42 boost_asio_detail_posix_thread_function /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/posix_thread.ipp:74 (usConfigurationAdminTests+0x3d4a5)

  Previous read of size 4 at 0x7ffcc77cd74c by main thread (mutexes: write M17873647188105568):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:517 (usConfigurationAdminTests+0xcba88)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceNotification_Test::TestBody()::<lambda()> > /usr/include/c++/10/condition_variable:157 (usConfigurationAdminTests+0xcba88)
    #2 wait_for<long int, std::ratio<1>, cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceNotification_Test::TestBody()::<lambda()> > /usr/include/c++/10/condition_variable:185 (usConfigurationAdminTests+0xcba88)
    #3 cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceNotification_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:515 (usConfigurationAdminTests+0xcba88)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001c74c)

  Mutex M17873647188105568 is already destroyed.

  Thread T30 (tid=1235196, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 boost::asio::thread_pool::thread_pool(unsigned long) <null> (usConfigurationAdminTests+0x4e77d)
    #2 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<boost::asio::thread_pool, std::allocator<boost::asio::thread_pool>, int>(boost::asio::thread_pool*&, std::_Sp_alloc_shared_tag<std::allocator<boost::asio::thread_pool> >, int&&) /usr/include/c++/10/ext/new_allocator.h:150 (usConfigurationAdminTests+0x13903d)
    #3 std::__shared_ptr<boost::asio::thread_pool, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<boost::asio::thread_pool>, int>(std::_Sp_alloc_shared_tag<std::allocator<boost::asio::thread_pool> >, int&&) /usr/include/c++/10/bits/shared_ptr_base.h:1371 (usConfigurationAdminTests+0x13903d)
    #4 std::shared_ptr<boost::asio::thread_pool>::shared_ptr<std::allocator<boost::asio::thread_pool>, int>(std::_Sp_alloc_shared_tag<std::allocator<boost::asio::thread_pool> >, int&&) /usr/include/c++/10/bits/shared_ptr.h:408 (usConfigurationAdminTests+0x13903d)
    #5 std::shared_ptr<boost::asio::thread_pool> std::allocate_shared<boost::asio::thread_pool, std::allocator<boost::asio::thread_pool>, int>(std::allocator<boost::asio::thread_pool> const&, int&&) /usr/include/c++/10/bits/shared_ptr.h:860 (usConfigurationAdminTests+0x13903d)
    #6 std::shared_ptr<boost::asio::thread_pool> std::make_shared<boost::asio::thread_pool, int>(int&&) /usr/include/c++/10/bits/shared_ptr.h:876 (usConfigurationAdminTests+0x13903d)
    #7 cppmicroservices::cmimpl::FallbackAsyncWorkService::Initialize() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/CMAsyncWorkService.cpp:54 (usConfigurationAdminTests+0x13903d)
    #8 cppmicroservices::cmimpl::FallbackAsyncWorkService::FallbackAsyncWorkService(std::shared_ptr<cppmicroservices::logservice::LogService> const&) /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/CMAsyncWorkService.cpp:48 (usConfigurationAdminTests+0x13903d)
    #9 std::shared_ptr<cppmicroservices::cmimpl::FallbackAsyncWorkService> std::make_shared<cppmicroservices::cmimpl::FallbackAsyncWorkService, std::shared_ptr<cppmicroservices::logservice::LogService> const&>(std::shared_ptr<cppmicroservices::logservice::LogService> const&) /usr/include/c++/10/ext/new_allocator.h:150 (usConfigurationAdminTests+0x134453)
    #10 cppmicroservices::cmimpl::CMAsyncWorkService::CMAsyncWorkService(cppmicroservices::BundleContext, std::shared_ptr<cppmicroservices::logservice::LogService> const&) /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/CMAsyncWorkService.cpp:118 (usConfigurationAdminTests+0x134453)
    #11 std::shared_ptr<cppmicroservices::cmimpl::CMAsyncWorkService> std::make_shared<cppmicroservices::cmimpl::CMAsyncWorkService, cppmicroservices::BundleContext&, std::shared_ptr<cppmicroservices::cmimpl::FakeLogger>&>(cppmicroservices::BundleContext&, std::shared_ptr<cppmicroservices::cmimpl::FakeLogger>&) /usr/include/c++/10/ext/new_allocator.h:150 (usConfigurationAdminTests+0xfe01a)
    #12 cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceNotification_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:449 (usConfigurationAdminTests+0xca122)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:470 in operator()
==================
[       OK ] TestConfigurationAdminImpl.VerifyManagedServiceNotification (271 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyManagedServiceFactoryNotification
==================
WARNING: ThreadSanitizer: data race (pid=1234649)
  Read of size 4 at 0x7ffcc77cd714 by main thread (mutexes: write M17873647188105568):
    #0 cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceFactoryNotification_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:623 (usConfigurationAdminTests+0xce76f)
    #1 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #2 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Previous write of size 4 at 0x7ffcc77cd714 by thread T31 (mutexes: write M17873647188105568):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:567 (usConfigurationAdminTests+0xc4c6b)
    #1 operator()<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::AnyMap> /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:943 (usConfigurationAdminTests+0xc4c6b)
    #2 __invoke_impl<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceFactoryNotification_Test::TestBody()::<lambda()> >&, const std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0xc4c6b)
    #3 __invoke_r<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceFactoryNotification_Test::TestBody()::<lambda()> >&, const std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0xc4c6b)
    #4 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (usConfigurationAdminTests+0xc4c6b)
    #5 std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)>::operator()(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0xf8a85)
    #6 decltype (((forward<std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)> const&>)({parm#1}))((get<0ul>)((forward<std::tuple<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&> >)({parm#2})), (get<1ul>)((forward<std::tuple<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&> >)({parm#2})))) testing::internal::ApplyImpl<std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)> const&, std::tuple<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&>, 0ul, 1ul>(std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)> const&, std::tuple<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&>&&, testing::internal::IndexSequence<0ul, 1ul>) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:405 (usConfigurationAdminTests+0xf8a85)
    #7 decltype (ApplyImpl((forward<std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)> const&>)({parm#1}), (forward<std::tuple<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&> >)({parm#2}), (testing::internal::MakeIndexSequenceImpl<std::tuple_size<std::remove_reference<std::tuple<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&> >::type>::value>::type)())) testing::internal::Apply<std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)> const&, std::tuple<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&> >(std::function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)> const&, std::tuple<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&>&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:414 (usConfigurationAdminTests+0xf8a85)
    #8 testing::Action<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)>::Perform(std::tuple<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&>) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:496 (usConfigurationAdminTests+0xf8b3a)
    #9 testing::internal::ActionResultHolder<void>* testing::internal::ActionResultHolder<void>::PerformAction<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)>(testing::Action<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)> const&, testing::internal::Function<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)>::ArgumentTuple&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1445 (usConfigurationAdminTests+0xf8b3a)
    #10 testing::internal::FunctionMocker<void (std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&)>::UntypedPerformAction(void const*, void*) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1560 (usConfigurationAdminTests+0xf8b3a)
    #11 testing::internal::UntypedFunctionMockerBase::UntypedInvokeWith(void*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/src/gmock-spec-builders.cc:452 (libgmockd.so.1.11.0+0x33f13)
    #12 notifyServiceUpdated /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:113 (usConfigurationAdminTests+0x159785)
    #13 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:979 (usConfigurationAdminTests+0x159902)
    #14 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:1059 (usConfigurationAdminTests+0x159902)
    #15 __invoke_impl<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedServiceFactory>&)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x159902)
    #16 __invoke_r<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedServiceFactory>&)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0x159902)
    #17 operator() /usr/include/c++/10/future:1432 (usConfigurationAdminTests+0x159902)
    #18 operator() /usr/include/c++/10/future:1373 (usConfigurationAdminTests+0x159902)
    #19 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedServiceFactory>&)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x159902)
    #20 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedServiceFactory>&)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:113 (usConfigurationAdminTests+0x159902)
    #21 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usConfigurationAdminTests+0x159902)
    #22 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0x3f10a)
    #23 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usConfigurationAdminTests+0x3f10a)
    #24 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usConfigurationAdminTests+0x3ad0e)
    #25 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usConfigurationAdminTests+0x3ad0e)
    #26 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usConfigurationAdminTests+0x3ad0e)
    #27 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #28 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #29 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #30 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usConfigurationAdminTests+0x44c45)
    #31 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usConfigurationAdminTests+0x44c45)
    #32 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usConfigurationAdminTests+0x15795e)
    #33 _M_run /usr/include/c++/10/future:1435 (usConfigurationAdminTests+0x15795e)
    #34 boost::asio::detail::executor_op<boost::asio::detail::work_dispatcher<cppmicroservices::cmimpl::FallbackAsyncWorkService::post(std::packaged_task<void ()>&&)::{lambda()#1}>, std::allocator<void>, boost::asio::detail::scheduler_operation>::do_complete(void*, std::allocator<void>*, boost::system::error_code const&, unsigned long) /usr/include/c++/10/future:1568 (usConfigurationAdminTests+0x135c7b)
    #35 boost::asio::detail::scheduler_operation::complete(void*, boost::system::error_code const&, unsigned long) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/scheduler_operation.hpp:40 (usConfigurationAdminTests+0x44302)
    #36 boost::asio::detail::scheduler::do_run_one(boost::asio::detail::conditionally_enabled_mutex::scoped_lock&, boost::asio::detail::scheduler_thread_info&, boost::system::error_code const&) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/scheduler.ipp:447 (usConfigurationAdminTests+0x44302)
    #37 boost::asio::detail::scheduler::run(boost::system::error_code&) <null> (usConfigurationAdminTests+0x45503)
    #38 boost::asio::thread_pool::thread_function::operator()() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/impl/thread_pool.ipp:33 (usConfigurationAdminTests+0x45840)
    #39 boost::asio::detail::posix_thread::func<boost::asio::thread_pool::thread_function>::run() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/posix_thread.hpp:86 (usConfigurationAdminTests+0x45840)
    #40 boost_asio_detail_posix_thread_function /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/posix_thread.ipp:74 (usConfigurationAdminTests+0x3d4a5)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001c714)

  Mutex M17873647188105568 is already destroyed.

  Thread T31 (tid=1235198, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 boost::asio::thread_pool::thread_pool(unsigned long) <null> (usConfigurationAdminTests+0x4e77d)
    #2 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<boost::asio::thread_pool, std::allocator<boost::asio::thread_pool>, int>(boost::asio::thread_pool*&, std::_Sp_alloc_shared_tag<std::allocator<boost::asio::thread_pool> >, int&&) /usr/include/c++/10/ext/new_allocator.h:150 (usConfigurationAdminTests+0x13903d)
    #3 std::__shared_ptr<boost::asio::thread_pool, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<boost::asio::thread_pool>, int>(std::_Sp_alloc_shared_tag<std::allocator<boost::asio::thread_pool> >, int&&) /usr/include/c++/10/bits/shared_ptr_base.h:1371 (usConfigurationAdminTests+0x13903d)
    #4 std::shared_ptr<boost::asio::thread_pool>::shared_ptr<std::allocator<boost::asio::thread_pool>, int>(std::_Sp_alloc_shared_tag<std::allocator<boost::asio::thread_pool> >, int&&) /usr/include/c++/10/bits/shared_ptr.h:408 (usConfigurationAdminTests+0x13903d)
    #5 std::shared_ptr<boost::asio::thread_pool> std::allocate_shared<boost::asio::thread_pool, std::allocator<boost::asio::thread_pool>, int>(std::allocator<boost::asio::thread_pool> const&, int&&) /usr/include/c++/10/bits/shared_ptr.h:860 (usConfigurationAdminTests+0x13903d)
    #6 std::shared_ptr<boost::asio::thread_pool> std::make_shared<boost::asio::thread_pool, int>(int&&) /usr/include/c++/10/bits/shared_ptr.h:876 (usConfigurationAdminTests+0x13903d)
    #7 cppmicroservices::cmimpl::FallbackAsyncWorkService::Initialize() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/CMAsyncWorkService.cpp:54 (usConfigurationAdminTests+0x13903d)
    #8 cppmicroservices::cmimpl::FallbackAsyncWorkService::FallbackAsyncWorkService(std::shared_ptr<cppmicroservices::logservice::LogService> const&) /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/CMAsyncWorkService.cpp:48 (usConfigurationAdminTests+0x13903d)
    #9 std::shared_ptr<cppmicroservices::cmimpl::FallbackAsyncWorkService> std::make_shared<cppmicroservices::cmimpl::FallbackAsyncWorkService, std::shared_ptr<cppmicroservices::logservice::LogService> const&>(std::shared_ptr<cppmicroservices::logservice::LogService> const&) /usr/include/c++/10/ext/new_allocator.h:150 (usConfigurationAdminTests+0x134453)
    #10 cppmicroservices::cmimpl::CMAsyncWorkService::CMAsyncWorkService(cppmicroservices::BundleContext, std::shared_ptr<cppmicroservices::logservice::LogService> const&) /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/CMAsyncWorkService.cpp:118 (usConfigurationAdminTests+0x134453)
    #11 std::shared_ptr<cppmicroservices::cmimpl::CMAsyncWorkService> std::make_shared<cppmicroservices::cmimpl::CMAsyncWorkService, cppmicroservices::BundleContext&, std::shared_ptr<cppmicroservices::cmimpl::FakeLogger>&>(cppmicroservices::BundleContext&, std::shared_ptr<cppmicroservices::cmimpl::FakeLogger>&) /usr/include/c++/10/ext/new_allocator.h:150 (usConfigurationAdminTests+0xfe01a)
    #12 cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceFactoryNotification_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:534 (usConfigurationAdminTests+0xcc5a6)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:623 in cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceFactoryNotification_Test::TestBody()
==================
[       OK ] TestConfigurationAdminImpl.VerifyManagedServiceFactoryNotification (8 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyConfigAdminStartupShutdownNotification
[       OK ] TestConfigurationAdminImpl.VerifyConfigAdminStartupShutdownNotification (13 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyConfigAdminStartupShutdownNotificationWithUpdate
[       OK ] TestConfigurationAdminImpl.VerifyConfigAdminStartupShutdownNotificationWithUpdate (5 ms)
[ RUN      ] TestConfigurationAdminImpl.VerifyManagedServiceExceptionsAreLogged
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=1234649)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (usConfigurationAdminTests+0xc4a8d)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (usConfigurationAdminTests+0xc4a8d)
    #3 std::lock_guard<std::mutex>::lock_guard(std::mutex&) /usr/include/c++/10/bits/std_mutex.h:159 (usConfigurationAdminTests+0xc4a8d)
    #4 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:957 (usConfigurationAdminTests+0xc4a8d)
    #5 operator()<cppmicroservices::AnyMap> /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:943 (usConfigurationAdminTests+0xc4a8d)
    #6 __invoke_impl<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceExceptionsAreLogged_Test::TestBody()::<lambda()> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0xc4a8d)
    #7 __invoke_r<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceExceptionsAreLogged_Test::TestBody()::<lambda()> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0xc4a8d)
    #8 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (usConfigurationAdminTests+0xc4a8d)
    #9 std::function<void (cppmicroservices::AnyMap const&)>::operator()(cppmicroservices::AnyMap const&) const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0xf887e)
    #10 decltype (((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}))((get<0ul>)((forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2})))) testing::internal::ApplyImpl<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>, 0ul>(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&, testing::internal::IndexSequence<0ul>) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:405 (usConfigurationAdminTests+0xf887e)
    #11 decltype (ApplyImpl((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}), (forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2}), (testing::internal::MakeIndexSequenceImpl<std::tuple_size<std::remove_reference<std::tuple<cppmicroservices::AnyMap const&> >::type>::value>::type)())) testing::internal::Apply<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&> >(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:414 (usConfigurationAdminTests+0xf887e)
    #12 testing::Action<void (cppmicroservices::AnyMap const&)>::Perform(std::tuple<cppmicroservices::AnyMap const&>) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:496 (usConfigurationAdminTests+0xc52f2)
    #13 operator() /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:1054 (usConfigurationAdminTests+0xc52f2)
    #14 __invoke_impl<void, testing::internal::DoAllAction<Actions>::operator testing::Action<R(Args ...)><void, {const cppmicroservices::AnyMap&}>::Op&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0xc52f2)
    #15 __invoke_r<void, testing::internal::DoAllAction<Actions>::operator testing::Action<R(Args ...)><void, {const cppmicroservices::AnyMap&}>::Op&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0xc52f2)
    #16 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (usConfigurationAdminTests+0xc52f2)
    #17 std::function<void (cppmicroservices::AnyMap const&)>::operator()(cppmicroservices::AnyMap const&) const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0xf887e)
    #18 decltype (((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}))((get<0ul>)((forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2})))) testing::internal::ApplyImpl<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>, 0ul>(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&, testing::internal::IndexSequence<0ul>) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:405 (usConfigurationAdminTests+0xf887e)
    #19 decltype (ApplyImpl((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}), (forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2}), (testing::internal::MakeIndexSequenceImpl<std::tuple_size<std::remove_reference<std::tuple<cppmicroservices::AnyMap const&> >::type>::value>::type)())) testing::internal::Apply<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&> >(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:414 (usConfigurationAdminTests+0xf887e)
    #20 testing::Action<void (cppmicroservices::AnyMap const&)>::Perform(std::tuple<cppmicroservices::AnyMap const&>) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:496 (usConfigurationAdminTests+0xf891b)
    #21 testing::internal::ActionResultHolder<void>* testing::internal::ActionResultHolder<void>::PerformAction<void (cppmicroservices::AnyMap const&)>(testing::Action<void (cppmicroservices::AnyMap const&)> const&, testing::internal::Function<void (cppmicroservices::AnyMap const&)>::ArgumentTuple&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1445 (usConfigurationAdminTests+0xf891b)
    #22 testing::internal::FunctionMocker<void (cppmicroservices::AnyMap const&)>::UntypedPerformAction(void const*, void*) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1560 (usConfigurationAdminTests+0xf891b)
    #23 testing::internal::UntypedFunctionMockerBase::UntypedInvokeWith(void*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/src/gmock-spec-builders.cc:452 (libgmockd.so.1.11.0+0x33f13)
    #24 notifyServiceUpdated /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:97 (usConfigurationAdminTests+0x1592d1)
    #25 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:856 (usConfigurationAdminTests+0x159413)
    #26 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:1059 (usConfigurationAdminTests+0x159413)
    #27 __invoke_impl<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedService>&)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x159413)
    #28 __invoke_r<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedService>&)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0x159413)
    #29 operator() /usr/include/c++/10/future:1432 (usConfigurationAdminTests+0x159413)
    #30 operator() /usr/include/c++/10/future:1373 (usConfigurationAdminTests+0x159413)
    #31 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedService>&)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x159413)
    #32 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedService>&)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:113 (usConfigurationAdminTests+0x159413)
    #33 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usConfigurationAdminTests+0x159413)
    #34 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0x3f10a)
    #35 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usConfigurationAdminTests+0x3f10a)
    #36 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usConfigurationAdminTests+0x3ad0e)
    #37 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usConfigurationAdminTests+0x3ad0e)
    #38 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usConfigurationAdminTests+0x3ad0e)
    #39 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #40 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #41 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #42 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usConfigurationAdminTests+0x44c45)
    #43 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usConfigurationAdminTests+0x44c45)
    #44 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usConfigurationAdminTests+0x157e44)
    #45 _M_run /usr/include/c++/10/future:1435 (usConfigurationAdminTests+0x157e44)
    #46 boost::asio::detail::executor_op<boost::asio::detail::work_dispatcher<cppmicroservices::cmimpl::FallbackAsyncWorkService::post(std::packaged_task<void ()>&&)::{lambda()#1}>, std::allocator<void>, boost::asio::detail::scheduler_operation>::do_complete(void*, std::allocator<void>*, boost::system::error_code const&, unsigned long) /usr/include/c++/10/future:1568 (usConfigurationAdminTests+0x135c7b)
    #47 boost::asio::detail::scheduler_operation::complete(void*, boost::system::error_code const&, unsigned long) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/scheduler_operation.hpp:40 (usConfigurationAdminTests+0x44302)
    #48 boost::asio::detail::scheduler::do_run_one(boost::asio::detail::conditionally_enabled_mutex::scoped_lock&, boost::asio::detail::scheduler_thread_info&, boost::system::error_code const&) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/scheduler.ipp:447 (usConfigurationAdminTests+0x44302)
    #49 boost::asio::detail::scheduler::run(boost::system::error_code&) <null> (usConfigurationAdminTests+0x45503)
    #50 boost::asio::thread_pool::thread_function::operator()() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/impl/thread_pool.ipp:33 (usConfigurationAdminTests+0x45840)
    #51 boost::asio::detail::posix_thread::func<boost::asio::thread_pool::thread_function>::run() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/posix_thread.hpp:86 (usConfigurationAdminTests+0x45840)
    #52 boost_asio_detail_posix_thread_function /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/posix_thread.ipp:74 (usConfigurationAdminTests+0x3d4a5)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001c570)

  Mutex M474426059412788592 is already destroyed.

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=1234649)
  Write of size 4 at 0x7ffcc77cd2f0 by thread T47 (mutexes: write M474426059412788592):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:958 (usConfigurationAdminTests+0xc4ab5)
    #1 operator()<cppmicroservices::AnyMap> /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:943 (usConfigurationAdminTests+0xc4ab5)
    #2 __invoke_impl<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceExceptionsAreLogged_Test::TestBody()::<lambda()> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0xc4ab5)
    #3 __invoke_r<void, testing::internal::InvokeWithoutArgsAction<cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceExceptionsAreLogged_Test::TestBody()::<lambda()> >&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0xc4ab5)
    #4 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (usConfigurationAdminTests+0xc4ab5)
    #5 std::function<void (cppmicroservices::AnyMap const&)>::operator()(cppmicroservices::AnyMap const&) const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0xf887e)
    #6 decltype (((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}))((get<0ul>)((forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2})))) testing::internal::ApplyImpl<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>, 0ul>(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&, testing::internal::IndexSequence<0ul>) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:405 (usConfigurationAdminTests+0xf887e)
    #7 decltype (ApplyImpl((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}), (forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2}), (testing::internal::MakeIndexSequenceImpl<std::tuple_size<std::remove_reference<std::tuple<cppmicroservices::AnyMap const&> >::type>::value>::type)())) testing::internal::Apply<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&> >(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:414 (usConfigurationAdminTests+0xf887e)
    #8 testing::Action<void (cppmicroservices::AnyMap const&)>::Perform(std::tuple<cppmicroservices::AnyMap const&>) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:496 (usConfigurationAdminTests+0xc52f2)
    #9 operator() /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:1054 (usConfigurationAdminTests+0xc52f2)
    #10 __invoke_impl<void, testing::internal::DoAllAction<Actions>::operator testing::Action<R(Args ...)><void, {const cppmicroservices::AnyMap&}>::Op&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0xc52f2)
    #11 __invoke_r<void, testing::internal::DoAllAction<Actions>::operator testing::Action<R(Args ...)><void, {const cppmicroservices::AnyMap&}>::Op&, const cppmicroservices::AnyMap&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0xc52f2)
    #12 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (usConfigurationAdminTests+0xc52f2)
    #13 std::function<void (cppmicroservices::AnyMap const&)>::operator()(cppmicroservices::AnyMap const&) const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0xf887e)
    #14 decltype (((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}))((get<0ul>)((forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2})))) testing::internal::ApplyImpl<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>, 0ul>(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&, testing::internal::IndexSequence<0ul>) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:405 (usConfigurationAdminTests+0xf887e)
    #15 decltype (ApplyImpl((forward<std::function<void (cppmicroservices::AnyMap const&)> const&>)({parm#1}), (forward<std::tuple<cppmicroservices::AnyMap const&> >)({parm#2}), (testing::internal::MakeIndexSequenceImpl<std::tuple_size<std::remove_reference<std::tuple<cppmicroservices::AnyMap const&> >::type>::value>::type)())) testing::internal::Apply<std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&> >(std::function<void (cppmicroservices::AnyMap const&)> const&, std::tuple<cppmicroservices::AnyMap const&>&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/internal/gmock-internal-utils.h:414 (usConfigurationAdminTests+0xf887e)
    #16 testing::Action<void (cppmicroservices::AnyMap const&)>::Perform(std::tuple<cppmicroservices::AnyMap const&>) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-actions.h:496 (usConfigurationAdminTests+0xf891b)
    #17 testing::internal::ActionResultHolder<void>* testing::internal::ActionResultHolder<void>::PerformAction<void (cppmicroservices::AnyMap const&)>(testing::Action<void (cppmicroservices::AnyMap const&)> const&, testing::internal::Function<void (cppmicroservices::AnyMap const&)>::ArgumentTuple&&) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1445 (usConfigurationAdminTests+0xf891b)
    #18 testing::internal::FunctionMocker<void (cppmicroservices::AnyMap const&)>::UntypedPerformAction(void const*, void*) const /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/include/gmock/gmock-spec-builders.h:1560 (usConfigurationAdminTests+0xf891b)
    #19 testing::internal::UntypedFunctionMockerBase::UntypedInvokeWith(void*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googlemock/src/gmock-spec-builders.cc:452 (libgmockd.so.1.11.0+0x33f13)
    #20 notifyServiceUpdated /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:97 (usConfigurationAdminTests+0x1592d1)
    #21 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:856 (usConfigurationAdminTests+0x159413)
    #22 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/ConfigurationAdminImpl.cpp:1059 (usConfigurationAdminTests+0x159413)
    #23 __invoke_impl<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedService>&)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x159413)
    #24 __invoke_r<void, cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedService>&)::<lambda()> >::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (usConfigurationAdminTests+0x159413)
    #25 operator() /usr/include/c++/10/future:1432 (usConfigurationAdminTests+0x159413)
    #26 operator() /usr/include/c++/10/future:1373 (usConfigurationAdminTests+0x159413)
    #27 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedService>&)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:60 (usConfigurationAdminTests+0x159413)
    #28 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_state<_Fn, _Alloc, _Res(_Args ...)>::_M_run<cppmicroservices::cmimpl::ConfigurationAdminImpl::PerformAsync<cppmicroservices::cmimpl::ConfigurationAdminImpl::AddingService(const cppmicroservices::ServiceReference<cppmicroservices::service::cm::ManagedService>&)::<lambda()> >::<lambda()>, std::allocator<int>, void, {}>::<lambda()>, void>&> /usr/include/c++/10/bits/invoke.h:113 (usConfigurationAdminTests+0x159413)
    #29 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usConfigurationAdminTests+0x159413)
    #30 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usConfigurationAdminTests+0x3f10a)
    #31 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usConfigurationAdminTests+0x3f10a)
    #32 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usConfigurationAdminTests+0x3ad0e)
    #33 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usConfigurationAdminTests+0x3ad0e)
    #34 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usConfigurationAdminTests+0x3ad0e)
    #35 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #36 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usConfigurationAdminTests+0x3ad0e)
    #37 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #38 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usConfigurationAdminTests+0x44c45)
    #39 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usConfigurationAdminTests+0x44c45)
    #40 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usConfigurationAdminTests+0x157e44)
    #41 _M_run /usr/include/c++/10/future:1435 (usConfigurationAdminTests+0x157e44)
    #42 boost::asio::detail::executor_op<boost::asio::detail::work_dispatcher<cppmicroservices::cmimpl::FallbackAsyncWorkService::post(std::packaged_task<void ()>&&)::{lambda()#1}>, std::allocator<void>, boost::asio::detail::scheduler_operation>::do_complete(void*, std::allocator<void>*, boost::system::error_code const&, unsigned long) /usr/include/c++/10/future:1568 (usConfigurationAdminTests+0x135c7b)
    #43 boost::asio::detail::scheduler_operation::complete(void*, boost::system::error_code const&, unsigned long) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/scheduler_operation.hpp:40 (usConfigurationAdminTests+0x44302)
    #44 boost::asio::detail::scheduler::do_run_one(boost::asio::detail::conditionally_enabled_mutex::scoped_lock&, boost::asio::detail::scheduler_thread_info&, boost::system::error_code const&) /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/scheduler.ipp:447 (usConfigurationAdminTests+0x44302)
    #45 boost::asio::detail::scheduler::run(boost::system::error_code&) <null> (usConfigurationAdminTests+0x45503)
    #46 boost::asio::thread_pool::thread_function::operator()() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/impl/thread_pool.ipp:33 (usConfigurationAdminTests+0x45840)
    #47 boost::asio::detail::posix_thread::func<boost::asio::thread_pool::thread_function>::run() /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/posix_thread.hpp:86 (usConfigurationAdminTests+0x45840)
    #48 boost_asio_detail_posix_thread_function /home/tcormack/dev/issue710/CppMicroServices/third_party/boost/include/boost/asio/detail/impl/posix_thread.ipp:74 (usConfigurationAdminTests+0x3d4a5)

  Previous read of size 4 at 0x7ffcc77cd2f0 by main thread (mutexes: write M474426059412788592):
    #0 operator() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:1015 (usConfigurationAdminTests+0xdcb42)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceExceptionsAreLogged_Test::TestBody()::<lambda()> > /usr/include/c++/10/condition_variable:157 (usConfigurationAdminTests+0xdcb42)
    #2 wait_for<long int, std::ratio<1>, cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceExceptionsAreLogged_Test::TestBody()::<lambda()> > /usr/include/c++/10/condition_variable:185 (usConfigurationAdminTests+0xdcb42)
    #3 cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceExceptionsAreLogged_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:1015 (usConfigurationAdminTests+0xdcb42)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Location is stack of main thread.

  Location is global '<null>' at 0x000000000000 ([stack]+0x00000001c2f0)

  Mutex M474426059412788592 is already destroyed.

  Thread T47 (tid=1235204, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 boost::asio::thread_pool::thread_pool(unsigned long) <null> (usConfigurationAdminTests+0x4e77d)
    #2 std::__shared_count<(__gnu_cxx::_Lock_policy)2>::__shared_count<boost::asio::thread_pool, std::allocator<boost::asio::thread_pool>, int>(boost::asio::thread_pool*&, std::_Sp_alloc_shared_tag<std::allocator<boost::asio::thread_pool> >, int&&) /usr/include/c++/10/ext/new_allocator.h:150 (usConfigurationAdminTests+0x13903d)
    #3 std::__shared_ptr<boost::asio::thread_pool, (__gnu_cxx::_Lock_policy)2>::__shared_ptr<std::allocator<boost::asio::thread_pool>, int>(std::_Sp_alloc_shared_tag<std::allocator<boost::asio::thread_pool> >, int&&) /usr/include/c++/10/bits/shared_ptr_base.h:1371 (usConfigurationAdminTests+0x13903d)
    #4 std::shared_ptr<boost::asio::thread_pool>::shared_ptr<std::allocator<boost::asio::thread_pool>, int>(std::_Sp_alloc_shared_tag<std::allocator<boost::asio::thread_pool> >, int&&) /usr/include/c++/10/bits/shared_ptr.h:408 (usConfigurationAdminTests+0x13903d)
    #5 std::shared_ptr<boost::asio::thread_pool> std::allocate_shared<boost::asio::thread_pool, std::allocator<boost::asio::thread_pool>, int>(std::allocator<boost::asio::thread_pool> const&, int&&) /usr/include/c++/10/bits/shared_ptr.h:860 (usConfigurationAdminTests+0x13903d)
    #6 std::shared_ptr<boost::asio::thread_pool> std::make_shared<boost::asio::thread_pool, int>(int&&) /usr/include/c++/10/bits/shared_ptr.h:876 (usConfigurationAdminTests+0x13903d)
    #7 cppmicroservices::cmimpl::FallbackAsyncWorkService::Initialize() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/CMAsyncWorkService.cpp:54 (usConfigurationAdminTests+0x13903d)
    #8 cppmicroservices::cmimpl::FallbackAsyncWorkService::FallbackAsyncWorkService(std::shared_ptr<cppmicroservices::logservice::LogService> const&) /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/CMAsyncWorkService.cpp:48 (usConfigurationAdminTests+0x13903d)
    #9 std::shared_ptr<cppmicroservices::cmimpl::FallbackAsyncWorkService> std::make_shared<cppmicroservices::cmimpl::FallbackAsyncWorkService, std::shared_ptr<cppmicroservices::logservice::LogService> const&>(std::shared_ptr<cppmicroservices::logservice::LogService> const&) /usr/include/c++/10/ext/new_allocator.h:150 (usConfigurationAdminTests+0x134453)
    #10 cppmicroservices::cmimpl::CMAsyncWorkService::CMAsyncWorkService(cppmicroservices::BundleContext, std::shared_ptr<cppmicroservices::logservice::LogService> const&) /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/src/CMAsyncWorkService.cpp:118 (usConfigurationAdminTests+0x134453)
    #11 std::shared_ptr<cppmicroservices::cmimpl::CMAsyncWorkService> std::make_shared<cppmicroservices::cmimpl::CMAsyncWorkService, cppmicroservices::BundleContext&, std::shared_ptr<cppmicroservices::cmimpl::MockLogger>&>(cppmicroservices::BundleContext&, std::shared_ptr<cppmicroservices::cmimpl::MockLogger>&) /usr/include/c++/10/ext/new_allocator.h:150 (usConfigurationAdminTests+0xd672b)
    #12 cppmicroservices::cmimpl::TestConfigurationAdminImpl_VerifyManagedServiceExceptionsAreLogged_Test::TestBody() /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:936 (usConfigurationAdminTests+0xd672b)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/dev/issue710/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/dev/issue710/CppMicroServices/compendium/ConfigurationAdmin/test/TestConfigurationAdminImpl.cpp:958 in operator()
==================
[       OK ] TestConfigurationAdminImpl.VerifyManagedServiceExceptionsAreLogged (15 ms)
[----------] 12 tests from TestConfigurationAdminImpl (400 ms total)

[----------] 7 tests from TestConfigurationImpl
[ RUN      ] TestConfigurationImpl.VerifyGetters
[       OK ] TestConfigurationImpl.VerifyGetters (0 ms)
[ RUN      ] TestConfigurationImpl.ThrowsWhenRemoved
[       OK ] TestConfigurationImpl.ThrowsWhenRemoved (0 ms)
[ RUN      ] TestConfigurationImpl.NoCallbacksAfterInvalidate
[       OK ] TestConfigurationImpl.NoCallbacksAfterInvalidate (0 ms)
[ RUN      ] TestConfigurationImpl.VerifyUpdate
[       OK ] TestConfigurationImpl.VerifyUpdate (0 ms)
[ RUN      ] TestConfigurationImpl.VerifyUpdateIfDifferent
[       OK ] TestConfigurationImpl.VerifyUpdateIfDifferent (0 ms)
[ RUN      ] TestConfigurationImpl.VerifyUpdateWithoutNotificationIfDifferent
[       OK ] TestConfigurationImpl.VerifyUpdateWithoutNotificationIfDifferent (0 ms)
[ RUN      ] TestConfigurationImpl.VerifyRemoveWithoutNotificationIfChangeCountEquals
[       OK ] TestConfigurationImpl.VerifyRemoveWithoutNotificationIfChangeCountEquals (0 ms)
[----------] 7 tests from TestConfigurationImpl (1 ms total)

[----------] 1 test from TestMetadataParserFactory
[ RUN      ] TestMetadataParserFactory.ManifestVersionInvalid
[       OK ] TestMetadataParserFactory.ManifestVersionInvalid (0 ms)
[----------] 1 test from TestMetadataParserFactory (0 ms total)

[----------] 4 tests from TestMetadataParserImplV1
[ RUN      ] TestMetadataParserImplV1.ParseValidManifest
[       OK ] TestMetadataParserImplV1.ParseValidManifest (0 ms)
[ RUN      ] TestMetadataParserImplV1.ParseManifestEmptyProps
[       OK ] TestMetadataParserImplV1.ParseManifestEmptyProps (0 ms)
[ RUN      ] TestMetadataParserImplV1.ParseManifestEmptyConfigurations
[       OK ] TestMetadataParserImplV1.ParseManifestEmptyConfigurations (0 ms)
[ RUN      ] TestMetadataParserImplV1.ParseMultipleConfigurations
[       OK ] TestMetadataParserImplV1.ParseMultipleConfigurations (0 ms)
[----------] 4 tests from TestMetadataParserImplV1 (0 ms total)

[----------] 4 tests from AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd
[ RUN      ] AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd.TestEndToEndBehaviorWithAsyncWorkService/0
[       OK ] AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd.TestEndToEndBehaviorWithAsyncWorkService/0 (28 ms)
[ RUN      ] AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd.TestEndToEndBehaviorWithAsyncWorkService/1
[       OK ] AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd.TestEndToEndBehaviorWithAsyncWorkService/1 (13 ms)
[ RUN      ] AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd.TestEndToEndBehaviorWithAsyncWorkService/2
[       OK ] AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd.TestEndToEndBehaviorWithAsyncWorkService/2 (65 ms)
[ RUN      ] AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd.TestEndToEndBehaviorWithAsyncWorkService/3
[       OK ] AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd.TestEndToEndBehaviorWithAsyncWorkService/3 (30 ms)
[----------] 4 tests from AsyncWorkServiceEndToEndParameterized/TestAsyncWorkServiceEndToEnd (138 ms total)

[----------] 7 tests from FailureModes/TestInvalidMetadata
[ RUN      ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/0
[       OK ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/0 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/1
[       OK ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/1 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/2
[       OK ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/2 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/3
[       OK ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/3 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/4
[       OK ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/4 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/5
[       OK ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/5 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/6
[       OK ] FailureModes/TestInvalidMetadata.TestMetadataFailureModes/6 (0 ms)
[----------] 7 tests from FailureModes/TestInvalidMetadata (0 ms total)

[----------] 5 tests from FailureModes/TestInvalidMetadataThroughLogger
[ RUN      ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/0
[       OK ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/0 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/1
[       OK ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/1 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/2
[       OK ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/2 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/3
[       OK ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/3 (0 ms)
[ RUN      ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/4
[       OK ] FailureModes/TestInvalidMetadataThroughLogger.TestMetadataFailureModes/4 (0 ms)
[----------] 5 tests from FailureModes/TestInvalidMetadataThroughLogger (0 ms total)

[----------] Global test environment tear-down
[==========] 66 tests from 12 test suites ran. (67214 ms total)
[  PASSED  ] 66 tests.
ThreadSanitizer: reported 5 warnings
