[==========] Running 300 tests from 51 test suites.
[----------] Global test environment set-up.
[----------] 19 tests from AnyTest
[ RUN      ] AnyTest.EmptyAny
[       OK ] AnyTest.EmptyAny (0 ms)
[ RUN      ] AnyTest.AnyBool
[       OK ] AnyTest.AnyBool (0 ms)
[ RUN      ] AnyTest.AnyInt
[       OK ] AnyTest.AnyInt (0 ms)
[ RUN      ] AnyTest.AnyChar
[       OK ] AnyTest.AnyChar (0 ms)
[ RUN      ] AnyTest.AnyFloat
[       OK ] AnyTest.AnyFloat (0 ms)
[ RUN      ] AnyTest.AnyDouble
[       OK ] AnyTest.AnyDouble (0 ms)
[ RUN      ] AnyTest.AnyString
[       OK ] AnyTest.AnyString (0 ms)
[ RUN      ] AnyTest.AnyVector
[       OK ] AnyTest.AnyVector (0 ms)
[ RUN      ] AnyTest.AnyList
[       OK ] AnyTest.AnyList (0 ms)
[ RUN      ] AnyTest.AnySet
[       OK ] AnyTest.AnySet (0 ms)
[ RUN      ] AnyTest.AnyVectorAny
[       OK ] AnyTest.AnyVectorAny (0 ms)
[ RUN      ] AnyTest.AnyListAny
[       OK ] AnyTest.AnyListAny (0 ms)
[ RUN      ] AnyTest.AnyMap
[       OK ] AnyTest.AnyMap (0 ms)
[ RUN      ] AnyTest.AnyMapAny
[       OK ] AnyTest.AnyMapAny (0 ms)
[ RUN      ] AnyTest.AnyStringEscapeCharacters
[       OK ] AnyTest.AnyStringEscapeCharacters (0 ms)
[ RUN      ] AnyTest.AnyToJSONWithFormatting
[       OK ] AnyTest.AnyToJSONWithFormatting (0 ms)
[ RUN      ] AnyTest.AnyMapComplex
[       OK ] AnyTest.AnyMapComplex (0 ms)
[ RUN      ] AnyTest.AnyBadAnyCastException
[       OK ] AnyTest.AnyBadAnyCastException (0 ms)
[ RUN      ] AnyTest.AnyEquality
[       OK ] AnyTest.AnyEquality (0 ms)
[----------] 19 tests from AnyTest (1 ms total)

[----------] 10 tests from AnyMapTest
[ RUN      ] AnyMapTest.CheckExceptions
[       OK ] AnyMapTest.CheckExceptions (0 ms)
[ RUN      ] AnyMapTest.AtCompoundKey
[       OK ] AnyMapTest.AtCompoundKey (0 ms)
[ RUN      ] AnyMapTest.IteratorTest
[       OK ] AnyMapTest.IteratorTest (0 ms)
[ RUN      ] AnyMapTest.AnyMap
[       OK ] AnyMapTest.AnyMap (0 ms)
[ RUN      ] AnyMapTest.MoveConstructor
[       OK ] AnyMapTest.MoveConstructor (129 ms)
[ RUN      ] AnyMapTest.MoveAssignment
[       OK ] AnyMapTest.MoveAssignment (129 ms)
[ RUN      ] AnyMapTest.CIHash
[       OK ] AnyMapTest.CIHash (0 ms)
[ RUN      ] AnyMapTest.CIHashUnique
[       OK ] AnyMapTest.CIHashUnique (0 ms)
[ RUN      ] AnyMapTest.GeneralUsage
[       OK ] AnyMapTest.GeneralUsage (0 ms)
[ RUN      ] AnyMapTest.ManifestFromCache
[       OK ] AnyMapTest.ManifestFromCache (0 ms)
[----------] 10 tests from AnyMapTest (259 ms total)

[----------] 7 tests from BundleActivatorTest
[ RUN      ] BundleActivatorTest.NoPropertyNoClass
[       OK ] BundleActivatorTest.NoPropertyNoClass (4 ms)
[ RUN      ] BundleActivatorTest.NoPropertyWithClass
[       OK ] BundleActivatorTest.NoPropertyWithClass (2 ms)
[ RUN      ] BundleActivatorTest.WrongPropertyTypeWithClass
[       OK ] BundleActivatorTest.WrongPropertyTypeWithClass (2 ms)
[ RUN      ] BundleActivatorTest.PropertyFalseWithoutClass
[       OK ] BundleActivatorTest.PropertyFalseWithoutClass (2 ms)
[ RUN      ] BundleActivatorTest.PropertyFalseWithClass
[       OK ] BundleActivatorTest.PropertyFalseWithClass (2 ms)
[ RUN      ] BundleActivatorTest.PropertyTrueWithoutClass
[       OK ] BundleActivatorTest.PropertyTrueWithoutClass (2 ms)
[ RUN      ] BundleActivatorTest.PropertyTrueWithClass
[       OK ] BundleActivatorTest.PropertyTrueWithClass (2 ms)
[----------] 7 tests from BundleActivatorTest (17 ms total)

[----------] 3 tests from BundleContextTest
[ RUN      ] BundleContextTest.BundleContextThrowWhenInvalid
[       OK ] BundleContextTest.BundleContextThrowWhenInvalid (1 ms)
[ RUN      ] BundleContextTest.NoSegfaultWithRegisterServiceShutdownRace
[       OK ] BundleContextTest.NoSegfaultWithRegisterServiceShutdownRace (2 ms)
[ RUN      ] BundleContextTest.NoSegfaultWithServiceFactory
[       OK ] BundleContextTest.NoSegfaultWithServiceFactory (10 ms)
[----------] 3 tests from BundleContextTest (14 ms total)

[----------] 3 tests from BundleDeadLock
[ RUN      ] BundleDeadLock.BundleActivatorCallsStart
[       OK ] BundleDeadLock.BundleActivatorCallsStart (4 ms)
[ RUN      ] BundleDeadLock.BundleActivatorCallsStop
[       OK ] BundleDeadLock.BundleActivatorCallsStop (13 ms)
[ RUN      ] BundleDeadLock.BundleInstall0Throws
[       OK ] BundleDeadLock.BundleInstall0Throws (2 ms)
[----------] 3 tests from BundleDeadLock (20 ms total)

[----------] 11 tests from BundleManifestTest
[ RUN      ] BundleManifestTest.UnicodeProperty
[       OK ] BundleManifestTest.UnicodeProperty (1 ms)
[ RUN      ] BundleManifestTest.InstallBundleWithDeepManifest
[       OK ] BundleManifestTest.InstallBundleWithDeepManifest (10 ms)
[ RUN      ] BundleManifestTest.ParseManifest
[       OK ] BundleManifestTest.ParseManifest (2 ms)
[ RUN      ] BundleManifestTest.DirectManifestInstall
[       OK ] BundleManifestTest.DirectManifestInstall (1 ms)
[ RUN      ] BundleManifestTest.DirectManifestInstallNoSymbolicName
[       OK ] BundleManifestTest.DirectManifestInstallNoSymbolicName (1 ms)
[ RUN      ] BundleManifestTest.DirectManifestInstallBadLocation
[       OK ] BundleManifestTest.DirectManifestInstallBadLocation (1 ms)
[ RUN      ] BundleManifestTest.DirectManifestInstallMulti
[       OK ] BundleManifestTest.DirectManifestInstallMulti (1 ms)
[ RUN      ] BundleManifestTest.DirectManifestInstallAndStart
[       OK ] BundleManifestTest.DirectManifestInstallAndStart (1 ms)
[ RUN      ] BundleManifestTest.DirectManifestInstallAndStartMulti
[       OK ] BundleManifestTest.DirectManifestInstallAndStartMulti (2 ms)
[ RUN      ] BundleManifestTest.IgnoreSecondManifestInstall
[       OK ] BundleManifestTest.IgnoreSecondManifestInstall (1 ms)
[ RUN      ] BundleManifestTest.DirectManifestInstallAndStartMultiStatic
[       OK ] BundleManifestTest.DirectManifestInstallAndStartMultiStatic (2 ms)
[----------] 11 tests from BundleManifestTest (29 ms total)

[----------] 3 tests from BundleValidationTest
[ RUN      ] BundleValidationTest.BundleValidationFailure
[       OK ] BundleValidationTest.BundleValidationFailure (1 ms)
[ RUN      ] BundleValidationTest.BundleValidationSuccess
[       OK ] BundleValidationTest.BundleValidationSuccess (1 ms)
[ RUN      ] BundleValidationTest.BundleValidationFunctionException
[       OK ] BundleValidationTest.BundleValidationFunctionException (1 ms)
[----------] 3 tests from BundleValidationTest (5 ms total)

[----------] 8 tests from BundleVersion
[ RUN      ] BundleVersion.EmptyVersion
[       OK ] BundleVersion.EmptyVersion (0 ms)
[ RUN      ] BundleVersion.UndefinedVersion
[       OK ] BundleVersion.UndefinedVersion (0 ms)
[ RUN      ] BundleVersion.InvalidQualifier
[       OK ] BundleVersion.InvalidQualifier (0 ms)
[ RUN      ] BundleVersion.Ctor
[       OK ] BundleVersion.Ctor (0 ms)
[ RUN      ] BundleVersion.Accessors
[       OK ] BundleVersion.Accessors (0 ms)
[ RUN      ] BundleVersion.ToString
[       OK ] BundleVersion.ToString (0 ms)
[ RUN      ] BundleVersion.Comparison
[       OK ] BundleVersion.Comparison (0 ms)
[ RUN      ] BundleVersion.ParseVersion
[       OK ] BundleVersion.ParseVersion (0 ms)
[----------] 8 tests from BundleVersion (0 ms total)

[----------] 19 tests from InvalidBundle
[ RUN      ] InvalidBundle.GetBundleIdFromInvalidBundle
[       OK ] InvalidBundle.GetBundleIdFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetBundleLocationFromInvalidBundle
[       OK ] InvalidBundle.GetBundleLocationFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetSymbolicNameFromInvalidBundle
[       OK ] InvalidBundle.GetSymbolicNameFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetHeadersFromInvalidBundle
[       OK ] InvalidBundle.GetHeadersFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetPropertiesFromInvalidBundle
[       OK ] InvalidBundle.GetPropertiesFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.StartFromInvalidBundle
[       OK ] InvalidBundle.StartFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.StartWithOptionsFromInvalidBundle
[       OK ] InvalidBundle.StartWithOptionsFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.StopFromInvalidBundle
[       OK ] InvalidBundle.StopFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.UninstallFromInvalidBundle
[       OK ] InvalidBundle.UninstallFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetBundleContextFromInvalidBundle
[       OK ] InvalidBundle.GetBundleContextFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetPropertyFromInvalidBundle
[       OK ] InvalidBundle.GetPropertyFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetPropertyKeysFromInvalidBundle
[       OK ] InvalidBundle.GetPropertyKeysFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetRegisteredServicesFromInvalidBundle
[       OK ] InvalidBundle.GetRegisteredServicesFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetServicesInUseFromInvalidBundle
[       OK ] InvalidBundle.GetServicesInUseFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetResourceFromInvalidBundle
[       OK ] InvalidBundle.GetResourceFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.FindResourcesFromInvalidBundle
[       OK ] InvalidBundle.FindResourcesFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetLastModifiedFromInvalidBundle
[       OK ] InvalidBundle.GetLastModifiedFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetBundleStateFromInvalidBundle
[       OK ] InvalidBundle.GetBundleStateFromInvalidBundle (0 ms)
[ RUN      ] InvalidBundle.GetBundleVersionFromInvalidBundle
[       OK ] InvalidBundle.GetBundleVersionFromInvalidBundle (0 ms)
[----------] 19 tests from InvalidBundle (0 ms total)

[----------] 1 test from GlobalServiceTrackerTest
[ RUN      ] GlobalServiceTrackerTest.Destroy
[       OK ] GlobalServiceTrackerTest.Destroy (1 ms)
[----------] 1 test from GlobalServiceTrackerTest (1 ms total)

[----------] 11 tests from LDAPExprTest
[ RUN      ] LDAPExprTest.GetMatchedObjectClasses
[       OK ] LDAPExprTest.GetMatchedObjectClasses (2 ms)
[ RUN      ] LDAPExprTest.IsSimple
[       OK ] LDAPExprTest.IsSimple (1 ms)
[ RUN      ] LDAPExprTest.Evaluate
[       OK ] LDAPExprTest.Evaluate (0 ms)
[ RUN      ] LDAPExprTest.Compare
[       OK ] LDAPExprTest.Compare (0 ms)
[ RUN      ] LDAPExprTest.CompareString
[       OK ] LDAPExprTest.CompareString (0 ms)
[ RUN      ] LDAPExprTest.PatSubstr
[       OK ] LDAPExprTest.PatSubstr (0 ms)
[ RUN      ] LDAPExprTest.ParseExceptions
[       OK ] LDAPExprTest.ParseExceptions (0 ms)
[ RUN      ] LDAPExprTest.BitWiseOperatorOr
[       OK ] LDAPExprTest.BitWiseOperatorOr (0 ms)
[ RUN      ] LDAPExprTest.BitWiseOperatorAnd
[       OK ] LDAPExprTest.BitWiseOperatorAnd (0 ms)
[ RUN      ] LDAPExprTest.OperatorAssignment
[       OK ] LDAPExprTest.OperatorAssignment (0 ms)
[ RUN      ] LDAPExprTest.AssignToDefaultConstructed
[       OK ] LDAPExprTest.AssignToDefaultConstructed (0 ms)
[----------] 11 tests from LDAPExprTest (4 ms total)

[----------] 9 tests from LDAPFilter
[ RUN      ] LDAPFilter.ToString
Empty LDAPFilter: 
[       OK ] LDAPFilter.ToString (0 ms)
[ RUN      ] LDAPFilter.BooleanOperator
[       OK ] LDAPFilter.BooleanOperator (0 ms)
[ RUN      ] LDAPFilter.Comparison
[       OK ] LDAPFilter.Comparison (0 ms)
[ RUN      ] LDAPFilter.Equality
[       OK ] LDAPFilter.Equality (0 ms)
[ RUN      ] LDAPFilter.LDAPProp
[       OK ] LDAPFilter.LDAPProp (0 ms)
[ RUN      ] LDAPFilter.DefaultConstructedMatch
[       OK ] LDAPFilter.DefaultConstructedMatch (0 ms)
[ RUN      ] LDAPFilter.TestLDAPExpressions
[       OK ] LDAPFilter.TestLDAPExpressions (0 ms)
[ RUN      ] LDAPFilter.TestParsing
[       OK ] LDAPFilter.TestParsing (0 ms)
[ RUN      ] LDAPFilter.TestEvaluate
[       OK ] LDAPFilter.TestEvaluate (0 ms)
[----------] 9 tests from LDAPFilter (0 ms total)

[----------] 2 tests from OpenFileHandleTest
[ RUN      ] OpenFileHandleTest.InstallBundle
lsof: WARNING: can't stat() tracefs file system /sys/kernel/debug/tracing
      Output information may be incomplete.
lsof: WARNING: can't stat() tracefs file system /sys/kernel/debug/tracing
      Output information may be incomplete.
[       OK ] OpenFileHandleTest.InstallBundle (301 ms)
[ RUN      ] OpenFileHandleTest.InstallBundleFailure
lsof: WARNING: can't stat() tracefs file system /sys/kernel/debug/tracing
      Output information may be incomplete.
lsof: WARNING: can't stat() tracefs file system /sys/kernel/debug/tracing
      Output information may be incomplete.
lsof: WARNING: can't stat() tracefs file system /sys/kernel/debug/tracing
      Output information may be incomplete.
lsof: WARNING: can't stat() tracefs file system /sys/kernel/debug/tracing
      Output information may be incomplete.
[       OK ] OpenFileHandleTest.InstallBundleFailure (607 ms)
[----------] 2 tests from OpenFileHandleTest (909 ms total)

[----------] 6 tests from UtilsFs
[ RUN      ] UtilsFs.Exists
[       OK ] UtilsFs.Exists (0 ms)
[ RUN      ] UtilsFs.IsDirectory
[       OK ] UtilsFs.IsDirectory (0 ms)
[ RUN      ] UtilsFs.IsFile
[       OK ] UtilsFs.IsFile (0 ms)
[ RUN      ] UtilsFs.IsRelative
[       OK ] UtilsFs.IsRelative (0 ms)
[ RUN      ] UtilsFs.GetAbsolute
[       OK ] UtilsFs.GetAbsolute (0 ms)
[ RUN      ] UtilsFs.MakeAndRemovePath
[       OK ] UtilsFs.MakeAndRemovePath (0 ms)
[----------] 6 tests from UtilsFs (0 ms total)

[----------] 21 tests from FrameworkTest
[ RUN      ] FrameworkTest.Ctor
[       OK ] FrameworkTest.Ctor (14 ms)
[ RUN      ] FrameworkTest.MoveCtor
[       OK ] FrameworkTest.MoveCtor (1 ms)
[ RUN      ] FrameworkTest.MoveAssign
[       OK ] FrameworkTest.MoveAssign (1 ms)
[ RUN      ] FrameworkTest.CopyCtor
[       OK ] FrameworkTest.CopyCtor (1 ms)
[ RUN      ] FrameworkTest.CopyAssign
[       OK ] FrameworkTest.CopyAssign (1 ms)
[ RUN      ] FrameworkTest.DefaultConfig
[       OK ] FrameworkTest.DefaultConfig (1 ms)
[ RUN      ] FrameworkTest.CustomConfiguration
In CoreBundleContext at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:103 : createdIn Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:123 : initializingIn Open at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:103 : ServiceTracker<S,TTT>::Open: (objectclass=cppmicroservices::ServiceListenerHook)In Open at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:103 : ServiceTracker<S,TTT>::Open: (objectclass=cppmicroservices::logservice::LogService)In Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:201 : inited
Installed bundles: In Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:204 :  #1 main:0.1.0 location:/home/tcormack/Documents/withCoreInfo/CppMicroServices/build/glnxa64/bin/usFrameworkTestsIn Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:204 :  #0 system_bundle:3.7.6 location:System BundleIn Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:221 : Library Load Options = 1In Uninit0 at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:228 : uninitIn Close at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:161 : ServiceTracker<S,TTT>::close:(objectclass=cppmicroservices::logservice::LogService)In Modified at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTrackerPrivate.tpp:158 : ServiceTracker::Modified(): (objectclass=cppmicroservices::logservice::LogService)In Close at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:188 : ServiceTracker<S,TTT>::close[cached cleared]:(objectclass=cppmicroservices::logservice::LogService)In Close at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:161 : ServiceTracker<S,TTT>::close:(objectclass=cppmicroservices::ServiceListenerHook)In Modified at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTrackerPrivate.tpp:158 : ServiceTracker::Modified(): (objectclass=cppmicroservices::ServiceListenerHook)In Close at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:188 : ServiceTracker<S,TTT>::close[cached cleared]:(objectclass=cppmicroservices::ServiceListenerHook)[       OK ] FrameworkTest.CustomConfiguration (2 ms)
[ RUN      ] FrameworkTest.NonIntegerLibraryLoadOption
[       OK ] FrameworkTest.NonIntegerLibraryLoadOption (7 ms)
[ RUN      ] FrameworkTest.FrameworkStartsWhenFileNamedDataExistsInTempDir
[       OK ] FrameworkTest.FrameworkStartsWhenFileNamedDataExistsInTempDir (5 ms)
[ RUN      ] FrameworkTest.TempDataDirIsNotCreatedWhenFrameworkStarts
[       OK ] FrameworkTest.TempDataDirIsNotCreatedWhenFrameworkStarts (9 ms)
[ RUN      ] FrameworkTest.DefaultLogSink
[       OK ] FrameworkTest.DefaultLogSink (10 ms)
[ RUN      ] FrameworkTest.CustomLogSink
In CoreBundleContext at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:103 : createdIn Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:123 : initializingIn Open at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:103 : ServiceTracker<S,TTT>::Open: (objectclass=cppmicroservices::ServiceListenerHook)In Open at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:103 : ServiceTracker<S,TTT>::Open: (objectclass=cppmicroservices::logservice::LogService)In Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:201 : inited
Installed bundles: In Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:204 :  #1 main:0.1.0 location:/home/tcormack/Documents/withCoreInfo/CppMicroServices/build/glnxa64/bin/usFrameworkTestsIn Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:204 :  #0 system_bundle:3.7.6 location:System BundleIn Init at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:221 : Library Load Options = 1In Uninit0 at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:228 : uninitIn Close at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:161 : ServiceTracker<S,TTT>::close:(objectclass=cppmicroservices::logservice::LogService)In Modified at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTrackerPrivate.tpp:158 : ServiceTracker::Modified(): (objectclass=cppmicroservices::logservice::LogService)In Close at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:188 : ServiceTracker<S,TTT>::close[cached cleared]:(objectclass=cppmicroservices::logservice::LogService)In Close at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:161 : ServiceTracker<S,TTT>::close:(objectclass=cppmicroservices::ServiceListenerHook)In Modified at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTrackerPrivate.tpp:158 : ServiceTracker::Modified(): (objectclass=cppmicroservices::ServiceListenerHook)In Close at /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:188 : ServiceTracker<S,TTT>::close[cached cleared]:(objectclass=cppmicroservices::ServiceListenerHook)[       OK ] FrameworkTest.CustomLogSink (9 ms)
[ RUN      ] FrameworkTest.Properties
[       OK ] FrameworkTest.Properties (1 ms)
[ RUN      ] FrameworkTest.ConcurrentFrameworkStart
[       OK ] FrameworkTest.ConcurrentFrameworkStart (88 ms)
[ RUN      ] FrameworkTest.ConcurrentFrameworkStop
[       OK ] FrameworkTest.ConcurrentFrameworkStop (27 ms)
[ RUN      ] FrameworkTest.ConcurrentFrameworkWaitForStop
[       OK ] FrameworkTest.ConcurrentFrameworkWaitForStop (65 ms)
[ RUN      ] FrameworkTest.Events
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=2244821)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libTestBundleC1d.so+0x1df68)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libTestBundleC1d.so+0x1df68)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libTestBundleC1d.so+0x1df68)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libTestBundleC1d.so+0x1df68)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libTestBundleC1d.so+0x1df68)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (libTestBundleC1d.so+0x1df68)
    #7 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1df68)
    #8 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #9 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000000700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:563 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #10 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #12 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M123140079630681928 is already destroyed.

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b40000007a8 by thread T94 (mutexes: write M123140079630681928):
    #0 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:112 (libTestBundleC1d.so+0x1df93)
    #1 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1df93)
    #2 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b40000007a8 by thread T100 (mutexes: write M123140079630681928):
    #0 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x1780f)
    #1 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #2 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #3 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #4 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000000700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:563 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #10 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #12 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M123140079630681928 is already destroyed.

  Thread T94 (tid=2245223, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T100 (tid=2245229, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/vector.tcc:112 in cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b40000007b0 by thread T94 (mutexes: write M123140079630681928):
    #0 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:112 (libTestBundleC1d.so+0x1dfa6)
    #1 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1dfa6)
    #2 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #3 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b40000007b0 by thread T100 (mutexes: write M123140079630681928):
    #0 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17823)
    #1 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #2 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #3 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #4 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000000700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:563 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #10 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #12 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M123140079630681928 is already destroyed.

  Thread T94 (tid=2245223, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T100 (tid=2245229, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/vector.tcc:112 in cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b40000007a0 by thread T94 (mutexes: write M123140079630681928):
    #0 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::size() const /usr/include/c++/10/bits/stl_vector.h:919 (libTestBundleC1d.so+0x11d08)
    #1 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_check_len(unsigned long, char const*) const /usr/include/c++/10/bits/stl_vector.h:1758 (libTestBundleC1d.so+0x11d08)
    #2 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:436 (libTestBundleC1d.so+0x11d08)
    #3 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #4 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b40000007a0 by thread T100 (mutexes: write M123140079630681928):
    #0 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17800)
    #1 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #2 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #3 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #4 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000000700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:563 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #10 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #11 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #12 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M123140079630681928 is already destroyed.

  Thread T94 (tid=2245223, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T100 (tid=2245229, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/stl_vector.h:919 in std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::size() const
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b0400004ec0 by thread T96 (mutexes: write M123140079630681928):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb86b1)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb86b1)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b0400004ec0 by thread T94 (mutexes: write M123140079630681928):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 16 at 0x7b0400004ec0 allocated by thread T94:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M123140079630681928 is already destroyed.

  Thread T96 (tid=2245225, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T94 (tid=2245223, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1191 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b0400004ec8 by thread T96 (mutexes: write M123140079630681928):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:761 (libCppMicroServicesd.so.3.7.6+0xb86e0)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb86e0)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b0400004ec8 by thread T94 (mutexes: write M123140079630681928):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 16 at 0x7b0400004ec0 allocated by thread T94:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M123140079630681928 is already destroyed.

  Thread T96 (tid=2245225, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T94 (tid=2245223, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:761 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b100000f3f0 by thread T92 (mutexes: write M123140079630681928):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb86b1)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb86b1)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b100000f3f0 by thread T96 (mutexes: write M123140079630681928):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb86bc)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb86bc)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x1dfc0)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x1dfc0)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x1dfc0)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:115 (libTestBundleC1d.so+0x1dfc0)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1dfc0)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 64 at 0x7b100000f3c0 allocated by thread T95:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M123140079630681928 is already destroyed.

  Thread T92 (tid=2245221, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T96 (tid=2245225, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T95 (tid=2245224, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1191 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b100000f3f8 by thread T92 (mutexes: write M123140079630681928):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:761 (libCppMicroServicesd.so.3.7.6+0xb86e0)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb86e0)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x11dbd)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x11dbd)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x11dbd)
    #5 void std::__relocate_object_a<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:976 (libTestBundleC1d.so+0x11dbd)
    #6 cppmicroservices::ServiceRegistration<void>* std::__relocate_a_1<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1014 (libTestBundleC1d.so+0x11dbd)
    #7 cppmicroservices::ServiceRegistration<void>* std::__relocate_a<cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> > >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_uninitialized.h:1028 (libTestBundleC1d.so+0x11dbd)
    #8 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_do_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&, std::integral_constant<bool, true>) /usr/include/c++/10/bits/stl_vector.h:456 (libTestBundleC1d.so+0x11dbd)
    #9 std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_S_relocate(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>*, std::allocator<cppmicroservices::ServiceRegistration<void> >&) /usr/include/c++/10/bits/stl_vector.h:469 (libTestBundleC1d.so+0x11dbd)
    #10 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:461 (libTestBundleC1d.so+0x11dbd)
    #11 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #12 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b100000f3f8 by thread T96 (mutexes: write M123140079630681928):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:619 (libCppMicroServicesd.so.3.7.6+0xb86cc)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb86cc)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x1dfc0)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x1dfc0)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x1dfc0)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:115 (libTestBundleC1d.so+0x1dfc0)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1dfc0)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 64 at 0x7b100000f3c0 allocated by thread T95:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M123140079630681928 is already destroyed.

  Thread T92 (tid=2245221, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T96 (tid=2245225, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T95 (tid=2245224, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:761 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Write of size 8 at 0x7b2000000650 by thread T90 (mutexes: write M123140079630681928):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:1191 (libCppMicroServicesd.so.3.7.6+0xb86bc)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb86bc)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x1dfc0)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x1dfc0)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x1dfc0)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:115 (libTestBundleC1d.so+0x1dfc0)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1dfc0)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b2000000650 by thread T92 (mutexes: write M123140079630681928):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 128 at 0x7b2000000600 allocated by thread T92:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M123140079630681928 is already destroyed.

  Thread T90 (tid=2245219, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T92 (tid=2245221, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1191 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Write of size 8 at 0x7b2000000658 by thread T90 (mutexes: write M123140079630681928):
    #0 std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&) /usr/include/c++/10/bits/shared_ptr_base.h:619 (libCppMicroServicesd.so.3.7.6+0xb86cc)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::ServiceRegistrationBase&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:47 (libCppMicroServicesd.so.3.7.6+0xb86cc)
    #2 cppmicroservices::ServiceRegistration<void>::ServiceRegistration(cppmicroservices::ServiceRegistration<void>&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/ServiceRegistration.h:118 (libTestBundleC1d.so+0x1dfc0)
    #3 void __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/ext/new_allocator.h:150 (libTestBundleC1d.so+0x1dfc0)
    #4 void std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::construct<cppmicroservices::ServiceRegistration<void>, cppmicroservices::ServiceRegistration<void> >(std::allocator<cppmicroservices::ServiceRegistration<void> >&, cppmicroservices::ServiceRegistration<void>*, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/alloc_traits.h:512 (libTestBundleC1d.so+0x1dfc0)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:115 (libTestBundleC1d.so+0x1dfc0)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1dfc0)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b2000000658 by thread T92 (mutexes: write M123140079630681928):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 128 at 0x7b2000000600 allocated by thread T92:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M123140079630681928 is already destroyed.

  Thread T90 (tid=2245219, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T92 (tid=2245221, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:619 in std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>::shared_ptr(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate>&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b4000018000 by thread T100:
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::operator bool() const /usr/include/c++/10/bits/shared_ptr_base.h:1329 (libCppMicroServicesd.so.3.7.6+0xb9488)
    #1 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:77 (libCppMicroServicesd.so.3.7.6+0xb9488)
    #2 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17672)
    #3 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #4 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #5 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b4000018000 by thread T97 (mutexes: write M123140079630681928):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 256 at 0x7b4000018000 allocated by thread T97:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M123140079630681928 is already destroyed.

  Thread T100 (tid=2245229, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T97 (tid=2245226, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1329 in std::__shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate, (__gnu_cxx::_Lock_policy)2>::operator bool() const
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b1c0001aa08 by thread T100:
    #0 std::__shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2>::get() const /usr/include/c++/10/bits/shared_ptr_base.h:1325 (libCppMicroServicesd.so.3.7.6+0xb9499)
    #1 std::__shared_ptr_access<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2, false, false>::_M_get() const /usr/include/c++/10/bits/shared_ptr_base.h:1024 (libCppMicroServicesd.so.3.7.6+0xb9499)
    #2 std::__shared_ptr_access<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2, false, false>::operator->() const /usr/include/c++/10/bits/shared_ptr_base.h:1018 (libCppMicroServicesd.so.3.7.6+0xb9499)
    #3 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:79 (libCppMicroServicesd.so.3.7.6+0xb9499)
    #4 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17672)
    #5 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #6 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #7 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #8 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #9 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #10 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b1c0001aa08 by thread T94:
    #0 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /usr/include/c++/10/bits/shared_ptr_base.h:686 (libCppMicroServicesd.so.3.7.6+0xbf8b9)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb9b4e)
    #2 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistry.cpp:115 (libCppMicroServicesd.so.3.7.6+0xc471d)
    #3 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xd0f28)
    #4 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1dec1)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 104 at 0x7b1c0001a9b0 allocated by thread T94:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xb9a7e)
    #2 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistry.cpp:115 (libCppMicroServicesd.so.3.7.6+0xc471d)
    #3 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xd0f28)
    #4 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1dec1)
    #5 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #6 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T100 (tid=2245229, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T94 (tid=2245223, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:1325 in std::__shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo, (__gnu_cxx::_Lock_policy)2>::get() const
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Atomic read of size 1 at 0x7b4800030170 by thread T100:
    #0 __tsan_atomic8_load ../../../../src/libsanitizer/tsan/tsan_interface_atomic.cpp:524 (libtsan.so.0+0x75cd3)
    #1 std::__atomic_base<bool>::load(std::memory_order) const /usr/include/c++/10/bits/atomic_base.h:426 (libCppMicroServicesd.so.3.7.6+0xb94ae)
    #2 std::atomic<bool>::operator bool() const /usr/include/c++/10/atomic:87 (libCppMicroServicesd.so.3.7.6+0xb94ae)
    #3 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:79 (libCppMicroServicesd.so.3.7.6+0xb94ae)
    #4 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17672)
    #5 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #6 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #7 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #8 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #9 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #10 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b4800030170 by thread T94:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xbf77b)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb9b4e)
    #3 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistry.cpp:115 (libCppMicroServicesd.so.3.7.6+0xc471d)
    #4 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xd0f28)
    #5 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1dec1)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 376 at 0x7b4800030000 allocated by thread T94:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceRegistrationBasePrivate::ServiceRegistrationBasePrivate(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const>, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0xbf77b)
    #2 cppmicroservices::ServiceRegistrationBase::ServiceRegistrationBase(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, cppmicroservices::Properties&&) /usr/include/c++/10/ext/new_allocator.h:150 (libCppMicroServicesd.so.3.7.6+0xb9b4e)
    #3 cppmicroservices::ServiceRegistry::RegisterService(cppmicroservices::BundlePrivate*, std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistry.cpp:115 (libCppMicroServicesd.so.3.7.6+0xc471d)
    #4 cppmicroservices::BundleContext::RegisterService(std::shared_ptr<std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::shared_ptr<void>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::shared_ptr<void> > > > const> const&, std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:217 (libCppMicroServicesd.so.3.7.6+0xd0f28)
    #5 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:103 (libTestBundleC1d.so+0x1dec1)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T100 (tid=2245229, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T94 (tid=2245223, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>&, int&>(void (cppmicroservices::TestBundleC1Activator::*&&)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*&&, std::shared_future<void>&, int&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x11627)
    #3 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #4 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #5 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #6 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #7 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #8 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #9 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #10 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/atomic_base.h:426 in std::__atomic_base<bool>::load(std::memory_order) const
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b4000018008 by thread T100:
    #0 std::shared_ptr<cppmicroservices::LockSet> std::make_shared<cppmicroservices::LockSet, std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&, std::shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo>&>(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&, std::shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo>&) /usr/include/c++/10/bits/shared_ptr_base.h:737 (libCppMicroServicesd.so.3.7.6+0xb90c9)
    #1 cppmicroservices::ServiceRegistrationBase::GetLocks() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:324 (libCppMicroServicesd.so.3.7.6+0xb90c9)
    #2 cppmicroservices::ServiceRegistrationBase::GetReference(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ServiceRegistrationBase.cpp:82 (libCppMicroServicesd.so.3.7.6+0xb94bd)
    #3 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17672)
    #4 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #5 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #6 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #7 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #8 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #9 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b4000018008 by thread T97 (mutexes: write M123140079630681928):
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 256 at 0x7b4000018000 allocated by thread T97:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 __gnu_cxx::new_allocator<cppmicroservices::ServiceRegistration<void> >::allocate(unsigned long, void const*) /usr/include/c++/10/ext/new_allocator.h:115 (libTestBundleC1d.so+0x11ea3)
    #2 std::allocator_traits<std::allocator<cppmicroservices::ServiceRegistration<void> > >::allocate(std::allocator<cppmicroservices::ServiceRegistration<void> >&, unsigned long) /usr/include/c++/10/bits/alloc_traits.h:460 (libTestBundleC1d.so+0x11ea3)
    #3 std::_Vector_base<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_allocate(unsigned long) /usr/include/c++/10/bits/stl_vector.h:346 (libTestBundleC1d.so+0x11ea3)
    #4 void std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::_M_realloc_insert<cppmicroservices::ServiceRegistration<void> >(__gnu_cxx::__normal_iterator<cppmicroservices::ServiceRegistration<void>*, std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > > >, cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:440 (libTestBundleC1d.so+0x11ea3)
    #5 cppmicroservices::ServiceRegistration<void>& std::vector<cppmicroservices::ServiceRegistration<void>, std::allocator<cppmicroservices::ServiceRegistration<void> > >::emplace_back<cppmicroservices::ServiceRegistration<void> >(cppmicroservices::ServiceRegistration<void>&&) /usr/include/c++/10/bits/vector.tcc:121 (libTestBundleC1d.so+0x1e1df)
    #6 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1e1df)
    #7 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #8 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M123140079630681928 is already destroyed.

  Thread T100 (tid=2245229, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #3 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #4 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #5 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #6 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #7 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #8 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T97 (tid=2245226, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::TestBundleC1Activator::Start(cppmicroservices::BundleContext) <null> (libTestBundleC1d.so+0x15c47)
    #3 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:564 (libCppMicroServicesd.so.3.7.6+0x1021f4)
    #4 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #5 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #6 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #7 FrameworkTest_Events_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:668 (usFrameworkTests+0x130c0f)
    #8 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #9 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /usr/include/c++/10/bits/shared_ptr_base.h:737 in std::shared_ptr<cppmicroservices::LockSet> std::make_shared<cppmicroservices::LockSet, std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&, std::shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo>&>(std::shared_ptr<cppmicroservices::ServiceRegistrationBasePrivate> const&, std::shared_ptr<cppmicroservices::ServiceRegistrationCoreInfo>&)
==================
[       OK ] FrameworkTest.Events (221 ms)
[ RUN      ] FrameworkTest.IndirectFrameworkStop
[       OK ] FrameworkTest.IndirectFrameworkStop (3 ms)
[ RUN      ] FrameworkTest.ShutdownAndStart
[       OK ] FrameworkTest.ShutdownAndStart (21 ms)
[ RUN      ] FrameworkTest.ConfigurationWithBundleValidation
[       OK ] FrameworkTest.ConfigurationWithBundleValidation (1 ms)
[ RUN      ] FrameworkTest.LoadLibraryLogsMessagesTest
[       OK ] FrameworkTest.LoadLibraryLogsMessagesTest (4 ms)
[----------] 21 tests from FrameworkTest (503 ms total)

[----------] 1 test from Framework
[ RUN      ] Framework.LifeCycle
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=2244821)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x61082)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x61082)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x61082)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x61082)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x61082)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (libCppMicroServicesd.so.3.7.6+0x61082)
    #7 cppmicroservices::FrameworkPrivate::Shutdown0(bool, bool) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:291 (libCppMicroServicesd.so.3.7.6+0x61082)
    #8 std::thread::_State_impl<std::thread::_Invoker<std::tuple<std::_Bind<void (cppmicroservices::FrameworkPrivate::*(cppmicroservices::FrameworkPrivate*, bool, bool))(bool, bool)> > > >::_M_run() <null> (libCppMicroServicesd.so.3.7.6+0x61435)
    #9 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 616 at 0x7b540000d980 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::CoreBundleContext::CoreBundleContext(std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&, std::ostream*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:102 (libCppMicroServicesd.so.3.7.6+0x126840)
    #2 cppmicroservices::FrameworkFactory::NewFramework(std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&, std::ostream*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkFactory.cpp:66 (libCppMicroServicesd.so.3.7.6+0x5b0cb)
    #3 cppmicroservices::FrameworkFactory::NewFramework() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkFactory.cpp:76 (libCppMicroServicesd.so.3.7.6+0x5b56c)
    #4 Framework_LifeCycle_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:386 (usFrameworkTests+0x12ec62)
    #5 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #6 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M17479 (0x7b540000d988) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #7 cppmicroservices::FrameworkPrivate::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:102 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #8 cppmicroservices::Framework::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/Framework.cpp:74 (libCppMicroServicesd.so.3.7.6+0x59cde)
    #9 Framework_LifeCycle_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:392 (usFrameworkTests+0x12ecf9)
    #10 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #11 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Write of size 1 at 0x7b540000dba0 by thread T107 (mutexes: write M17479):
    #0 cppmicroservices::FrameworkPrivate::FrameworkEventInternal::operator=(cppmicroservices::FrameworkPrivate::FrameworkEventInternal const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.h:103 (libCppMicroServicesd.so.3.7.6+0x5cbd7)
    #1 cppmicroservices::FrameworkPrivate::SystemShuttingdownDone_unlocked(cppmicroservices::FrameworkPrivate::FrameworkEventInternal const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:375 (libCppMicroServicesd.so.3.7.6+0x5cbd7)
    #2 cppmicroservices::FrameworkPrivate::ShutdownDone_unlocked(bool) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:323 (libCppMicroServicesd.so.3.7.6+0x5cd21)
    #3 cppmicroservices::FrameworkPrivate::Shutdown0(bool, bool) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:294 (libCppMicroServicesd.so.3.7.6+0x610bb)
    #4 std::thread::_State_impl<std::thread::_Invoker<std::tuple<std::_Bind<void (cppmicroservices::FrameworkPrivate::*(cppmicroservices::FrameworkPrivate*, bool, bool))(bool, bool)> > > >::_M_run() <null> (libCppMicroServicesd.so.3.7.6+0x61435)
    #5 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 1 at 0x7b540000dba0 by thread T106 (mutexes: write M17479):
    #0 cppmicroservices::FrameworkPrivate::FrameworkEventInternal::operator=(cppmicroservices::FrameworkPrivate::FrameworkEventInternal&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.h:103 (libCppMicroServicesd.so.3.7.6+0x5e53a)
    #1 cppmicroservices::FrameworkPrivate::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:109 (libCppMicroServicesd.so.3.7.6+0x5e53a)
    #2 cppmicroservices::Framework::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/Framework.cpp:74 (libCppMicroServicesd.so.3.7.6+0x59cde)
    #3 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:460 (usFrameworkTests+0x12c221)
    #4 __invoke_impl<void, Framework_LifeCycle_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x12c221)
    #5 __invoke<Framework_LifeCycle_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x12c221)
    #6 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x12c221)
    #7 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x12c221)
    #8 _M_run /usr/include/c++/10/thread:215 (usFrameworkTests+0x12c221)
    #9 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 616 at 0x7b540000d980 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::CoreBundleContext::CoreBundleContext(std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&, std::ostream*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:102 (libCppMicroServicesd.so.3.7.6+0x126840)
    #2 cppmicroservices::FrameworkFactory::NewFramework(std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&, std::ostream*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkFactory.cpp:66 (libCppMicroServicesd.so.3.7.6+0x5b0cb)
    #3 cppmicroservices::FrameworkFactory::NewFramework() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkFactory.cpp:76 (libCppMicroServicesd.so.3.7.6+0x5b56c)
    #4 Framework_LifeCycle_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:386 (usFrameworkTests+0x12ec62)
    #5 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #6 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M17479 (0x7b540000d988) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #7 cppmicroservices::FrameworkPrivate::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:102 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #8 cppmicroservices::Framework::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/Framework.cpp:74 (libCppMicroServicesd.so.3.7.6+0x59cde)
    #9 Framework_LifeCycle_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:392 (usFrameworkTests+0x12ecf9)
    #10 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #11 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T107 (tid=2245241, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::FrameworkPrivate::Stop(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:249 (libCppMicroServicesd.so.3.7.6+0x5d268)
    #3 cppmicroservices::Bundle::Stop(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:144 (libCppMicroServicesd.so.3.7.6+0xccc43)
    #4 cppmicroservices::Bundle::Stop() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:133 (libCppMicroServicesd.so.3.7.6+0xccce6)
    #5 Framework_LifeCycle_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:469 (usFrameworkTests+0x12fb2d)
    #6 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #7 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T106 (tid=2245240, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #3 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.h:103 in cppmicroservices::FrameworkPrivate::FrameworkEventInternal::operator=(cppmicroservices::FrameworkPrivate::FrameworkEventInternal const&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Write of size 4 at 0x7b540000dba4 by thread T107 (mutexes: write M17479):
    #0 cppmicroservices::FrameworkPrivate::FrameworkEventInternal::operator=(cppmicroservices::FrameworkPrivate::FrameworkEventInternal const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.h:103 (libCppMicroServicesd.so.3.7.6+0x5cbf7)
    #1 cppmicroservices::FrameworkPrivate::SystemShuttingdownDone_unlocked(cppmicroservices::FrameworkPrivate::FrameworkEventInternal const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:375 (libCppMicroServicesd.so.3.7.6+0x5cbf7)
    #2 cppmicroservices::FrameworkPrivate::ShutdownDone_unlocked(bool) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:323 (libCppMicroServicesd.so.3.7.6+0x5cd21)
    #3 cppmicroservices::FrameworkPrivate::Shutdown0(bool, bool) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:294 (libCppMicroServicesd.so.3.7.6+0x610bb)
    #4 std::thread::_State_impl<std::thread::_Invoker<std::tuple<std::_Bind<void (cppmicroservices::FrameworkPrivate::*(cppmicroservices::FrameworkPrivate*, bool, bool))(bool, bool)> > > >::_M_run() <null> (libCppMicroServicesd.so.3.7.6+0x61435)
    #5 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 4 at 0x7b540000dba4 by thread T106 (mutexes: write M17479):
    #0 cppmicroservices::FrameworkPrivate::FrameworkEventInternal::operator=(cppmicroservices::FrameworkPrivate::FrameworkEventInternal&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.h:103 (libCppMicroServicesd.so.3.7.6+0x5e55a)
    #1 cppmicroservices::FrameworkPrivate::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:109 (libCppMicroServicesd.so.3.7.6+0x5e55a)
    #2 cppmicroservices::Framework::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/Framework.cpp:74 (libCppMicroServicesd.so.3.7.6+0x59cde)
    #3 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:460 (usFrameworkTests+0x12c221)
    #4 __invoke_impl<void, Framework_LifeCycle_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x12c221)
    #5 __invoke<Framework_LifeCycle_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x12c221)
    #6 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x12c221)
    #7 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x12c221)
    #8 _M_run /usr/include/c++/10/thread:215 (usFrameworkTests+0x12c221)
    #9 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 616 at 0x7b540000d980 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::CoreBundleContext::CoreBundleContext(std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&, std::ostream*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:102 (libCppMicroServicesd.so.3.7.6+0x126840)
    #2 cppmicroservices::FrameworkFactory::NewFramework(std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, cppmicroservices::Any, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, cppmicroservices::Any> > > const&, std::ostream*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkFactory.cpp:66 (libCppMicroServicesd.so.3.7.6+0x5b0cb)
    #3 cppmicroservices::FrameworkFactory::NewFramework() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkFactory.cpp:76 (libCppMicroServicesd.so.3.7.6+0x5b56c)
    #4 Framework_LifeCycle_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:386 (usFrameworkTests+0x12ec62)
    #5 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #6 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M17479 (0x7b540000d988) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #7 cppmicroservices::FrameworkPrivate::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:102 (libCppMicroServicesd.so.3.7.6+0x5e42e)
    #8 cppmicroservices::Framework::WaitForStop(std::chrono::duration<long, std::ratio<1l, 1000l> > const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/Framework.cpp:74 (libCppMicroServicesd.so.3.7.6+0x59cde)
    #9 Framework_LifeCycle_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:392 (usFrameworkTests+0x12ecf9)
    #10 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #11 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T107 (tid=2245241, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 cppmicroservices::FrameworkPrivate::Stop(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:249 (libCppMicroServicesd.so.3.7.6+0x5d268)
    #3 cppmicroservices::Bundle::Stop(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:144 (libCppMicroServicesd.so.3.7.6+0xccc43)
    #4 cppmicroservices::Bundle::Stop() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:133 (libCppMicroServicesd.so.3.7.6+0xccce6)
    #5 Framework_LifeCycle_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/FrameworkTest.cpp:469 (usFrameworkTests+0x12fb2d)
    #6 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #7 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T106 (tid=2245240, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #3 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.h:103 in cppmicroservices::FrameworkPrivate::FrameworkEventInternal::operator=(cppmicroservices::FrameworkPrivate::FrameworkEventInternal const&)
==================
[       OK ] Framework.LifeCycle (33 ms)
[----------] 1 test from Framework (33 ms total)

[----------] 5 tests from BundleObjFile
[ RUN      ] BundleObjFile.InvalidLocation
[       OK ] BundleObjFile.InvalidLocation (0 ms)
[ RUN      ] BundleObjFile.InvalidBinaryFileFormat
[       OK ] BundleObjFile.InvalidBinaryFileFormat (0 ms)
[ RUN      ] BundleObjFile.NonStandardBundleExt
[       OK ] BundleObjFile.NonStandardBundleExt (0 ms)
[ RUN      ] BundleObjFile.GetRawBundleResourceContainer
[       OK ] BundleObjFile.GetRawBundleResourceContainer (0 ms)
[ RUN      ] BundleObjFile.MappedFile
[       OK ] BundleObjFile.MappedFile (0 ms)
[----------] 5 tests from BundleObjFile (1 ms total)

[----------] 5 tests from BundleGetSymbolTest
[ RUN      ] BundleGetSymbolTest.TestGetSymbolInvalidBundleInput
[       OK ] BundleGetSymbolTest.TestGetSymbolInvalidBundleInput (2 ms)
[ RUN      ] BundleGetSymbolTest.TestGetSymbolValidBundleWithInvalidSymbolName
[       OK ] BundleGetSymbolTest.TestGetSymbolValidBundleWithInvalidSymbolName (10 ms)
[ RUN      ] BundleGetSymbolTest.TestGetSymbolValidBundleWithInvalidSymbolHandle
[       OK ] BundleGetSymbolTest.TestGetSymbolValidBundleWithInvalidSymbolHandle (8 ms)
[ RUN      ] BundleGetSymbolTest.TestGetSymbolNotInstalledBundle
[       OK ] BundleGetSymbolTest.TestGetSymbolNotInstalledBundle (8 ms)
[ RUN      ] BundleGetSymbolTest.TestGetSymbolValidInput
[       OK ] BundleGetSymbolTest.TestGetSymbolValidInput (2 ms)
[----------] 5 tests from BundleGetSymbolTest (33 ms total)

[----------] 1 test from SecurityExceptionTest
[ RUN      ] SecurityExceptionTest.ctor
[       OK ] SecurityExceptionTest.ctor (0 ms)
[----------] 1 test from SecurityExceptionTest (0 ms total)

[----------] 1 test from ServiceExceptionTest
[ RUN      ] ServiceExceptionTest.TestServiceException
[       OK ] ServiceExceptionTest.TestServiceException (0 ms)
[----------] 1 test from ServiceExceptionTest (0 ms total)

[----------] 1 test from ServiceObjectsTest
[ RUN      ] ServiceObjectsTest.TestServiceObjects
[       OK ] ServiceObjectsTest.TestServiceObjects (2 ms)
[----------] 1 test from ServiceObjectsTest (2 ms total)

[----------] 5 tests from ServiceReferenceTest
[ RUN      ] ServiceReferenceTest.TestRegisterAndGetServiceReferenceTest
[       OK ] ServiceReferenceTest.TestRegisterAndGetServiceReferenceTest (2 ms)
[ RUN      ] ServiceReferenceTest.TestGetServiceReferenceWithMultipleRegistrations
[       OK ] ServiceReferenceTest.TestGetServiceReferenceWithMultipleRegistrations (3 ms)
[ RUN      ] ServiceReferenceTest.TestGetServiceReferenceWithRanking
[       OK ] ServiceReferenceTest.TestGetServiceReferenceWithRanking (3 ms)
[ RUN      ] ServiceReferenceTest.TestGetServiceReferenceWithMultipleRegistrationsPerRank
[       OK ] ServiceReferenceTest.TestGetServiceReferenceWithMultipleRegistrationsPerRank (13 ms)
[ RUN      ] ServiceReferenceTest.TestGetServiceReferenceWithModifiedProperties
[       OK ] ServiceReferenceTest.TestGetServiceReferenceWithModifiedProperties (2 ms)
[----------] 5 tests from ServiceReferenceTest (26 ms total)

[----------] 8 tests from ServiceFactoryTest
[ RUN      ] ServiceFactoryTest.TestGetServiceReturnsIncompleteMap
[       OK ] ServiceFactoryTest.TestGetServiceReturnsIncompleteMap (2 ms)
[ RUN      ] ServiceFactoryTest.TestGetServiceThrows
[       OK ] ServiceFactoryTest.TestGetServiceThrows (1 ms)
[ RUN      ] ServiceFactoryTest.TestGetServiceObjectThrows
[       OK ] ServiceFactoryTest.TestGetServiceObjectThrows (1 ms)
[ RUN      ] ServiceFactoryTest.TestGetServiceReturnsNull
[       OK ] ServiceFactoryTest.TestGetServiceReturnsNull (1 ms)
[ RUN      ] ServiceFactoryTest.TestServiceFactoryPrototypeScope
[       OK ] ServiceFactoryTest.TestServiceFactoryPrototypeScope (4 ms)
[ RUN      ] ServiceFactoryTest.TestServiceFactoryBundleScope
[       OK ] ServiceFactoryTest.TestServiceFactoryBundleScope (5 ms)
[ RUN      ] ServiceFactoryTest.TestConcurrentServiceFactory
[       OK ] ServiceFactoryTest.TestConcurrentServiceFactory (1189 ms)
[ RUN      ] ServiceFactoryTest.TestServiceFactoryBundleScopeErrorConditions
[       OK ] ServiceFactoryTest.TestServiceFactoryBundleScopeErrorConditions (1077 ms)
[----------] 8 tests from ServiceFactoryTest (2283 ms total)

[----------] 10 tests from ServiceTrackerTestFixture
[ RUN      ] ServiceTrackerTestFixture.TestFilterString
[       OK ] ServiceTrackerTestFixture.TestFilterString (2 ms)
[ RUN      ] ServiceTrackerTestFixture.TestServiceTracker
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=2244821)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (usFrameworkTests+0x1d6714)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (usFrameworkTests+0x1d6714)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (usFrameworkTests+0x1d6714)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (usFrameworkTests+0x1d6714)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (usFrameworkTests+0x1d6714)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (usFrameworkTests+0x1d6714)
    #7 cppmicroservices::ServiceTracker<void, void>::GetServiceReferences() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:260 (usFrameworkTests+0x1d6714)
    #8 cppmicroservices::ServiceTracker<void, void>::Close() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:180 (usFrameworkTests+0x1e151e)
    #9 ServiceTrackerTestFixture_TestServiceTracker_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:227 (usFrameworkTests+0x1c83ea)
    #10 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #11 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Location is heap block of size 352 at 0x7b4800004f80 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 cppmicroservices::ServiceTracker<void, void>::Open() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:106 (usFrameworkTests+0x1e03ce)
    #2 ServiceTrackerTestFixture_TestServiceTracker_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:216 (usFrameworkTests+0x1c784b)
    #3 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #4 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M454436161578880912 is already destroyed.

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
[       OK ] ServiceTrackerTestFixture.TestServiceTracker (554 ms)
[ RUN      ] ServiceTrackerTestFixture.GetTrackingCount
[       OK ] ServiceTrackerTestFixture.GetTrackingCount (2 ms)
[ RUN      ] ServiceTrackerTestFixture.GetTracked
[       OK ] ServiceTrackerTestFixture.GetTracked (1 ms)
[ RUN      ] ServiceTrackerTestFixture.IsEmpty
[       OK ] ServiceTrackerTestFixture.IsEmpty (1 ms)
[ RUN      ] ServiceTrackerTestFixture.ServiceTrackerCloseRace
[       OK ] ServiceTrackerTestFixture.ServiceTrackerCloseRace (202 ms)
[ RUN      ] ServiceTrackerTestFixture.DefaultCustomizerServiceTrackerCloseRace
[       OK ] ServiceTrackerTestFixture.DefaultCustomizerServiceTrackerCloseRace (171 ms)
[ RUN      ] ServiceTrackerTestFixture.ServiceTrackerConcurrentOpenClose
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b4400026770 by thread T21:
    #0 cppmicroservices::ListenerToken::ListenerToken(cppmicroservices::ListenerToken&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ListenerToken.cpp:34 (libCppMicroServicesd.so.3.7.6+0x7b2cf)
    #1 Close /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:143 (usFrameworkTests+0x1cd9f4)
    #2 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:556 (usFrameworkTests+0x1a2d5a)
    #3 __invoke_impl<void, ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #4 __invoke<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a2d5a)
    #5 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a2d5a)
    #6 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a2d5a)
    #7 operator() /usr/include/c++/10/future:1373 (usFrameworkTests+0x1a2d5a)
    #8 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #9 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:113 (usFrameworkTests+0x1a2d5a)
    #10 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usFrameworkTests+0x1a2d5a)
    #11 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0x1819a6)
    #12 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usFrameworkTests+0x1819a6)
    #13 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usFrameworkTests+0x1804c6)
    #14 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1804c6)
    #15 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usFrameworkTests+0x1804c6)
    #16 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #17 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #18 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #19 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usFrameworkTests+0x184b8d)
    #20 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usFrameworkTests+0x184b8d)
    #21 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usFrameworkTests+0x1a3ed0)
    #22 operator() /usr/include/c++/10/future:1682 (usFrameworkTests+0x1a3ed0)
    #23 __invoke_impl<void, std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a3ed0)
    #24 __invoke<std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a3ed0)
    #25 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a3ed0)
    #26 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a3ed0)
    #27 _M_run /usr/include/c++/10/thread:215 (usFrameworkTests+0x1a3ed0)
    #28 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b4400026770 by thread T14:
    #0 cppmicroservices::ListenerToken::ListenerToken(cppmicroservices::ListenerToken&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ListenerToken.cpp:36 (libCppMicroServicesd.so.3.7.6+0x7b2e6)
    #1 Close /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:143 (usFrameworkTests+0x1cd9f4)
    #2 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:556 (usFrameworkTests+0x1a2d5a)
    #3 __invoke_impl<void, ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #4 __invoke<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a2d5a)
    #5 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a2d5a)
    #6 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a2d5a)
    #7 operator() /usr/include/c++/10/future:1373 (usFrameworkTests+0x1a2d5a)
    #8 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #9 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:113 (usFrameworkTests+0x1a2d5a)
    #10 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usFrameworkTests+0x1a2d5a)
    #11 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0x1819a6)
    #12 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usFrameworkTests+0x1819a6)
    #13 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usFrameworkTests+0x1804c6)
    #14 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1804c6)
    #15 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usFrameworkTests+0x1804c6)
    #16 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #17 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #18 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #19 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usFrameworkTests+0x184b8d)
    #20 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usFrameworkTests+0x184b8d)
    #21 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usFrameworkTests+0x1a3ed0)
    #22 operator() /usr/include/c++/10/future:1682 (usFrameworkTests+0x1a3ed0)
    #23 __invoke_impl<void, std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a3ed0)
    #24 __invoke<std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a3ed0)
    #25 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a3ed0)
    #26 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a3ed0)
    #27 _M_run /usr/include/c++/10/thread:215 (usFrameworkTests+0x1a3ed0)
    #28 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 264 at 0x7b4400026700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 ServiceTracker /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:76 (usFrameworkTests+0x1b7189)
    #2 make_unique<cppmicroservices::ServiceTracker<(anonymous namespace)::FooService>, cppmicroservices::BundleContext&, (anonymous namespace)::CustomFooTracker*> /usr/include/c++/10/bits/unique_ptr.h:962 (usFrameworkTests+0x1bdab7)
    #3 ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:535 (usFrameworkTests+0x1bdab7)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T21 (tid=2245430, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #3 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T14 (tid=2245426, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #3 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ListenerToken.cpp:34 in cppmicroservices::ListenerToken::ListenerToken(cppmicroservices::ListenerToken&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b4400026770 by thread T19:
    #0 cppmicroservices::ListenerToken::ListenerToken(cppmicroservices::ListenerToken&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ListenerToken.cpp:34 (libCppMicroServicesd.so.3.7.6+0x7b2cf)
    #1 Close /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:143 (usFrameworkTests+0x1cd9f4)
    #2 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:556 (usFrameworkTests+0x1a2d5a)
    #3 __invoke_impl<void, ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #4 __invoke<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a2d5a)
    #5 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a2d5a)
    #6 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a2d5a)
    #7 operator() /usr/include/c++/10/future:1373 (usFrameworkTests+0x1a2d5a)
    #8 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #9 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:113 (usFrameworkTests+0x1a2d5a)
    #10 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usFrameworkTests+0x1a2d5a)
    #11 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0x1819a6)
    #12 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usFrameworkTests+0x1819a6)
    #13 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usFrameworkTests+0x1804c6)
    #14 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1804c6)
    #15 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usFrameworkTests+0x1804c6)
    #16 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #17 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #18 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #19 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usFrameworkTests+0x184b8d)
    #20 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usFrameworkTests+0x184b8d)
    #21 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usFrameworkTests+0x1a3ed0)
    #22 operator() /usr/include/c++/10/future:1682 (usFrameworkTests+0x1a3ed0)
    #23 __invoke_impl<void, std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a3ed0)
    #24 __invoke<std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a3ed0)
    #25 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a3ed0)
    #26 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a3ed0)
    #27 _M_run /usr/include/c++/10/thread:215 (usFrameworkTests+0x1a3ed0)
    #28 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b4400026770 by thread T14:
    #0 cppmicroservices::ListenerToken::ListenerToken(cppmicroservices::ListenerToken&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ListenerToken.cpp:36 (libCppMicroServicesd.so.3.7.6+0x7b2e6)
    #1 Close /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:143 (usFrameworkTests+0x1cd9f4)
    #2 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:556 (usFrameworkTests+0x1a2d5a)
    #3 __invoke_impl<void, ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #4 __invoke<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a2d5a)
    #5 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a2d5a)
    #6 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a2d5a)
    #7 operator() /usr/include/c++/10/future:1373 (usFrameworkTests+0x1a2d5a)
    #8 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #9 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:113 (usFrameworkTests+0x1a2d5a)
    #10 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usFrameworkTests+0x1a2d5a)
    #11 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0x1819a6)
    #12 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usFrameworkTests+0x1819a6)
    #13 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usFrameworkTests+0x1804c6)
    #14 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1804c6)
    #15 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usFrameworkTests+0x1804c6)
    #16 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #17 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #18 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #19 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usFrameworkTests+0x184b8d)
    #20 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usFrameworkTests+0x184b8d)
    #21 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usFrameworkTests+0x1a3ed0)
    #22 operator() /usr/include/c++/10/future:1682 (usFrameworkTests+0x1a3ed0)
    #23 __invoke_impl<void, std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a3ed0)
    #24 __invoke<std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a3ed0)
    #25 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a3ed0)
    #26 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a3ed0)
    #27 _M_run /usr/include/c++/10/thread:215 (usFrameworkTests+0x1a3ed0)
    #28 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 264 at 0x7b4400026700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 ServiceTracker /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:76 (usFrameworkTests+0x1b7189)
    #2 make_unique<cppmicroservices::ServiceTracker<(anonymous namespace)::FooService>, cppmicroservices::BundleContext&, (anonymous namespace)::CustomFooTracker*> /usr/include/c++/10/bits/unique_ptr.h:962 (usFrameworkTests+0x1bdab7)
    #3 ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:535 (usFrameworkTests+0x1bdab7)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T19 (tid=2245428, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #3 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T14 (tid=2245426, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #3 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ListenerToken.cpp:34 in cppmicroservices::ListenerToken::ListenerToken(cppmicroservices::ListenerToken&&)
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Read of size 8 at 0x7b4400026770 by thread T23:
    #0 cppmicroservices::ListenerToken::ListenerToken(cppmicroservices::ListenerToken&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ListenerToken.cpp:34 (libCppMicroServicesd.so.3.7.6+0x7b2cf)
    #1 Close /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:143 (usFrameworkTests+0x1cd9f4)
    #2 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:556 (usFrameworkTests+0x1a2d5a)
    #3 __invoke_impl<void, ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #4 __invoke<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a2d5a)
    #5 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a2d5a)
    #6 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a2d5a)
    #7 operator() /usr/include/c++/10/future:1373 (usFrameworkTests+0x1a2d5a)
    #8 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2d5a)
    #9 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:113 (usFrameworkTests+0x1a2d5a)
    #10 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usFrameworkTests+0x1a2d5a)
    #11 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0x1819a6)
    #12 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usFrameworkTests+0x1819a6)
    #13 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usFrameworkTests+0x1804c6)
    #14 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1804c6)
    #15 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usFrameworkTests+0x1804c6)
    #16 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #17 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #18 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #19 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usFrameworkTests+0x184b8d)
    #20 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usFrameworkTests+0x184b8d)
    #21 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usFrameworkTests+0x1a3ed0)
    #22 operator() /usr/include/c++/10/future:1682 (usFrameworkTests+0x1a3ed0)
    #23 __invoke_impl<void, std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a3ed0)
    #24 __invoke<std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a3ed0)
    #25 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a3ed0)
    #26 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a3ed0)
    #27 _M_run /usr/include/c++/10/thread:215 (usFrameworkTests+0x1a3ed0)
    #28 <null> <null> (libstdc++.so.6+0xceecf)

  Previous write of size 8 at 0x7b4400026770 by thread T18 (mutexes: write M313723):
    #0 cppmicroservices::ListenerToken::ListenerToken(cppmicroservices::ListenerToken&&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ListenerToken.cpp:36 (libCppMicroServicesd.so.3.7.6+0x7b2e6)
    #1 Open /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:109 (usFrameworkTests+0x1ceb71)
    #2 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:552 (usFrameworkTests+0x1a2da0)
    #3 __invoke_impl<void, ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2da0)
    #4 __invoke<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a2da0)
    #5 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a2da0)
    #6 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a2da0)
    #7 operator() /usr/include/c++/10/future:1373 (usFrameworkTests+0x1a2da0)
    #8 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2da0)
    #9 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:113 (usFrameworkTests+0x1a2da0)
    #10 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usFrameworkTests+0x1a2da0)
    #11 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0x1819a6)
    #12 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usFrameworkTests+0x1819a6)
    #13 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usFrameworkTests+0x1804c6)
    #14 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1804c6)
    #15 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usFrameworkTests+0x1804c6)
    #16 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #17 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #18 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #19 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usFrameworkTests+0x184b8d)
    #20 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usFrameworkTests+0x184b8d)
    #21 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usFrameworkTests+0x1a3ed0)
    #22 operator() /usr/include/c++/10/future:1682 (usFrameworkTests+0x1a3ed0)
    #23 __invoke_impl<void, std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a3ed0)
    #24 __invoke<std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a3ed0)
    #25 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a3ed0)
    #26 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a3ed0)
    #27 _M_run /usr/include/c++/10/thread:215 (usFrameworkTests+0x1a3ed0)
    #28 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 264 at 0x7b4400026700 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 ServiceTracker /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:76 (usFrameworkTests+0x1b7189)
    #2 make_unique<cppmicroservices::ServiceTracker<(anonymous namespace)::FooService>, cppmicroservices::BundleContext&, (anonymous namespace)::CustomFooTracker*> /usr/include/c++/10/bits/unique_ptr.h:962 (usFrameworkTests+0x1bdab7)
    #3 ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:535 (usFrameworkTests+0x1bdab7)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M313723 (0x7b4400026700) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (usFrameworkTests+0x1d41da)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (usFrameworkTests+0x1d41da)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (usFrameworkTests+0x1d41da)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (usFrameworkTests+0x1ce4e8)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (usFrameworkTests+0x1ce4e8)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (usFrameworkTests+0x1ce4e8)
    #7 Open /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/ServiceTracker.tpp:97 (usFrameworkTests+0x1ce4e8)
    #8 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/ServiceTrackerTest.cpp:552 (usFrameworkTests+0x1a2da0)
    #9 __invoke_impl<void, ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2da0)
    #10 __invoke<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a2da0)
    #11 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a2da0)
    #12 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a2da0)
    #13 operator() /usr/include/c++/10/future:1373 (usFrameworkTests+0x1a2da0)
    #14 __invoke_impl<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a2da0)
    #15 __invoke_r<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter>, std::__future_base::_Task_setter<std::unique_ptr<std::__future_base::_Result<void>, std::__future_base::_Result_base::_Deleter>, std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>&> /usr/include/c++/10/bits/invoke.h:113 (usFrameworkTests+0x1a2da0)
    #16 _M_invoke /usr/include/c++/10/bits/std_function.h:292 (usFrameworkTests+0x1a2da0)
    #17 std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0x1819a6)
    #18 std::__future_base::_State_baseV2::_M_do_set(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*) /usr/include/c++/10/future:572 (usFrameworkTests+0x1819a6)
    #19 void std::__invoke_impl<void, void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::__invoke_memfun_deref, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:73 (usFrameworkTests+0x1804c6)
    #20 std::__invoke_result<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>::type std::__invoke<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1804c6)
    #21 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#1}::operator()() const /usr/include/c++/10/mutex:717 (usFrameworkTests+0x1804c6)
    #22 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::operator()() const /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #23 std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&)::{lambda()#2}::_FUN() /usr/include/c++/10/mutex:722 (usFrameworkTests+0x1804c6)
    #24 pthread_once ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:1442 (libtsan.so.0+0x3ecd0)
    #25 __gthread_once /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:700 (usFrameworkTests+0x184b8d)
    #26 void std::call_once<void (std::__future_base::_State_baseV2::*)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*>(std::once_flag&, void (std::__future_base::_State_baseV2::*&&)(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*, bool*), std::__future_base::_State_baseV2*&&, std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>*&&, bool*&&) /usr/include/c++/10/mutex:729 (usFrameworkTests+0x184b8d)
    #27 std::__future_base::_State_baseV2::_M_set_result(std::function<std::unique_ptr<std::__future_base::_Result_base, std::__future_base::_Result_base::_Deleter> ()>, bool) /usr/include/c++/10/future:412 (usFrameworkTests+0x1a3ed0)
    #28 operator() /usr/include/c++/10/future:1682 (usFrameworkTests+0x1a3ed0)
    #29 __invoke_impl<void, std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x1a3ed0)
    #30 __invoke<std::__future_base::_Async_state_impl<_BoundFn, _Res>::_Async_state_impl<std::thread::_Invoker<std::tuple<ServiceTrackerTestFixture_ServiceTrackerConcurrentOpenClose_Test::TestBody()::<lambda()> > >, void>::<lambda()> > /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x1a3ed0)
    #31 _M_invoke<0> /usr/include/c++/10/thread:264 (usFrameworkTests+0x1a3ed0)
    #32 operator() /usr/include/c++/10/thread:271 (usFrameworkTests+0x1a3ed0)
    #33 _M_run /usr/include/c++/10/thread:215 (usFrameworkTests+0x1a3ed0)
    #34 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T23 (tid=2245432, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #3 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T18 (tid=2245427, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #3 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/service/ListenerToken.cpp:34 in cppmicroservices::ListenerToken::ListenerToken(cppmicroservices::ListenerToken&&)
==================
[       OK ] ServiceTrackerTestFixture.ServiceTrackerConcurrentOpenClose (49 ms)
[ RUN      ] ServiceTrackerTestFixture.TestNullPtrServiceTrackerCustomizer
[       OK ] ServiceTrackerTestFixture.TestNullPtrServiceTrackerCustomizer (1002 ms)
[ RUN      ] ServiceTrackerTestFixture.TestReOpenServiceTrackerWithCustomizer
[       OK ] ServiceTrackerTestFixture.TestReOpenServiceTrackerWithCustomizer (2 ms)
[----------] 10 tests from ServiceTrackerTestFixture (1990 ms total)

[----------] 3 tests from SharedLibraryExceptionTest
[ RUN      ] SharedLibraryExceptionTest.testSharedLibraryFailure
[       OK ] SharedLibraryExceptionTest.testSharedLibraryFailure (1 ms)
[ RUN      ] SharedLibraryExceptionTest.testConstructSharedLibraryException
[       OK ] SharedLibraryExceptionTest.testConstructSharedLibraryException (1 ms)
[ RUN      ] SharedLibraryExceptionTest.testFrameworkSharedLibraryExceptionHandling
[       OK ] SharedLibraryExceptionTest.testFrameworkSharedLibraryExceptionHandling (2 ms)
[----------] 3 tests from SharedLibraryExceptionTest (5 ms total)

[----------] 1 test from ShrinkableVectorTest
[ RUN      ] ShrinkableVectorTest.ShrinkableVector
[       OK ] ShrinkableVectorTest.ShrinkableVector (0 ms)
[----------] 1 test from ShrinkableVectorTest (0 ms total)

[----------] 6 tests from BundleEventTest
[ RUN      ] BundleEventTest.invalidBundleEvents
[       OK ] BundleEventTest.invalidBundleEvents (1 ms)
[ RUN      ] BundleEventTest.invalidBundleOrigin
[       OK ] BundleEventTest.invalidBundleOrigin (1 ms)
[ RUN      ] BundleEventTest.validBundleOrigin
[       OK ] BundleEventTest.validBundleOrigin (1 ms)
[ RUN      ] BundleEventTest.StreamLazyActivationBundleEventType
[       OK ] BundleEventTest.StreamLazyActivationBundleEventType (10 ms)
[ RUN      ] BundleEventTest.StreamUnknownBundleEventType
[       OK ] BundleEventTest.StreamUnknownBundleEventType (9 ms)
[ RUN      ] BundleEventTest.BundleEventValidation
[       OK ] BundleEventTest.BundleEventValidation (8 ms)
[----------] 6 tests from BundleEventTest (34 ms total)

[----------] 2 tests from BundleResourceTestNoBundleInstall
[ RUN      ] BundleResourceTestNoBundleInstall.operatorEqualTo
[       OK ] BundleResourceTestNoBundleInstall.operatorEqualTo (0 ms)
[ RUN      ] BundleResourceTestNoBundleInstall.getChildResourcesFromInvalidBundle
[       OK ] BundleResourceTestNoBundleInstall.getChildResourcesFromInvalidBundle (0 ms)
[----------] 2 tests from BundleResourceTestNoBundleInstall (0 ms total)

[----------] 11 tests from BundleResourceTest
[ RUN      ] BundleResourceTest.getChildResources
[       OK ] BundleResourceTest.getChildResources (9 ms)
[ RUN      ] BundleResourceTest.testInvalidResource
[       OK ] BundleResourceTest.testInvalidResource (5 ms)
[ RUN      ] BundleResourceTest.testResourceTree
[       OK ] BundleResourceTest.testResourceTree (8 ms)
[ RUN      ] BundleResourceTest.testResourceOperators
[       OK ] BundleResourceTest.testResourceOperators (1 ms)
[ RUN      ] BundleResourceTest.testTextResource
[       OK ] BundleResourceTest.testTextResource (1 ms)
[ RUN      ] BundleResourceTest.testTextResourceAsBinary
[       OK ] BundleResourceTest.testTextResourceAsBinary (2 ms)
[ RUN      ] BundleResourceTest.testBinaryResource
[       OK ] BundleResourceTest.testBinaryResource (2 ms)
[ RUN      ] BundleResourceTest.testCompressedResource
[       OK ] BundleResourceTest.testCompressedResource (36 ms)
[ RUN      ] BundleResourceTest.testResources
[       OK ] BundleResourceTest.testResources (4 ms)
[ RUN      ] BundleResourceTest.testResourceFromExecutable
[       OK ] BundleResourceTest.testResourceFromExecutable (1 ms)
[ RUN      ] BundleResourceTest.testSpecialCharacters
[       OK ] BundleResourceTest.testSpecialCharacters (2 ms)
[----------] 11 tests from BundleResourceTest (77 ms total)

[----------] 1 test from BundleResourceDataOnlyTest
[ RUN      ] BundleResourceDataOnlyTest.TestResourceContainerGetsOpened
[       OK ] BundleResourceDataOnlyTest.TestResourceContainerGetsOpened (4 ms)
[----------] 1 test from BundleResourceDataOnlyTest (5 ms total)

[----------] 4 tests from BundleStreamOperatorTest
[ RUN      ] BundleStreamOperatorTest.bundleStateUninstalled
[       OK ] BundleStreamOperatorTest.bundleStateUninstalled (0 ms)
[ RUN      ] BundleStreamOperatorTest.bundleStateStarting
[       OK ] BundleStreamOperatorTest.bundleStateStarting (0 ms)
[ RUN      ] BundleStreamOperatorTest.bundleStateStopping
[       OK ] BundleStreamOperatorTest.bundleStateStopping (0 ms)
[ RUN      ] BundleStreamOperatorTest.bundleStateDefault
[       OK ] BundleStreamOperatorTest.bundleStateDefault (0 ms)
[----------] 4 tests from BundleStreamOperatorTest (0 ms total)

[----------] 4 tests from ServiceEventStreamOperatorTest
[ RUN      ] ServiceEventStreamOperatorTest.serviceEventTypeModified
[       OK ] ServiceEventStreamOperatorTest.serviceEventTypeModified (0 ms)
[ RUN      ] ServiceEventStreamOperatorTest.serviceEventTypeModifiedEndMatch
[       OK ] ServiceEventStreamOperatorTest.serviceEventTypeModifiedEndMatch (0 ms)
[ RUN      ] ServiceEventStreamOperatorTest.serviceEventTypeDefault
[       OK ] ServiceEventStreamOperatorTest.serviceEventTypeDefault (0 ms)
[ RUN      ] ServiceEventStreamOperatorTest.serviceEventNone
[       OK ] ServiceEventStreamOperatorTest.serviceEventNone (0 ms)
[----------] 4 tests from ServiceEventStreamOperatorTest (0 ms total)

[----------] 5 tests from ServiceRegistryTest
[ RUN      ] ServiceRegistryTest.TestServiceInterfaceId
[       OK ] ServiceRegistryTest.TestServiceInterfaceId (2 ms)
[ RUN      ] ServiceRegistryTest.TestMultipleServiceRegistrations
[       OK ] ServiceRegistryTest.TestMultipleServiceRegistrations (3 ms)
[ RUN      ] ServiceRegistryTest.TestUnregisterFix
[       OK ] ServiceRegistryTest.TestUnregisterFix (1 ms)
[ RUN      ] ServiceRegistryTest.TestServiceReferenceMemberFunctions
[       OK ] ServiceRegistryTest.TestServiceReferenceMemberFunctions (1 ms)
[ RUN      ] ServiceRegistryTest.TestServicePropertiesUpdate
[       OK ] ServiceRegistryTest.TestServicePropertiesUpdate (1 ms)
[----------] 5 tests from ServiceRegistryTest (11 ms total)

[----------] 3 tests from LDAPQueryTest
[ RUN      ] LDAPQueryTest.TestLDAPFilterMatchBundle
[       OK ] LDAPQueryTest.TestLDAPFilterMatchBundle (1 ms)
[ RUN      ] LDAPQueryTest.TestLDAPFilterMatchNoException
[       OK ] LDAPQueryTest.TestLDAPFilterMatchNoException (3 ms)
[ RUN      ] LDAPQueryTest.TestLDAPFilterMatchServiceReferenceBase
[       OK ] LDAPQueryTest.TestLDAPFilterMatchServiceReferenceBase (2 ms)
[----------] 3 tests from LDAPQueryTest (7 ms total)

[----------] 1 test from FrameworkFactoryTest
[ RUN      ] FrameworkFactoryTest.testFrameworkInstantiation
[       OK ] FrameworkFactoryTest.testFrameworkInstantiation (0 ms)
[----------] 1 test from FrameworkFactoryTest (0 ms total)

[----------] 4 tests from LogTest
[ RUN      ] LogTest.testDefaultLogMessages
[       OK ] LogTest.testDefaultLogMessages (0 ms)
[ RUN      ] LogTest.testLogDisabled
[       OK ] LogTest.testLogDisabled (0 ms)
[ RUN      ] LogTest.testLogRedirection
[       OK ] LogTest.testLogRedirection (0 ms)
[ RUN      ] LogTest.testLogMultiThreaded
[       OK ] LogTest.testLogMultiThreaded (2883 ms)
[----------] 4 tests from LogTest (2884 ms total)

[----------] 3 tests from StaticBundleResourceTest
[ RUN      ] StaticBundleResourceTest.testResourceOperators
[       OK ] StaticBundleResourceTest.testResourceOperators (3 ms)
[ RUN      ] StaticBundleResourceTest.testResourcesWithStaticImport
[       OK ] StaticBundleResourceTest.testResourcesWithStaticImport (2 ms)
[ RUN      ] StaticBundleResourceTest.testResources
[       OK ] StaticBundleResourceTest.testResources (3 ms)
[----------] 3 tests from StaticBundleResourceTest (9 ms total)

[----------] 1 test from FrameworkEventTest
[ RUN      ] FrameworkEventTest.testFrameworkEvents
[       OK ] FrameworkEventTest.testFrameworkEvents (0 ms)
[----------] 1 test from FrameworkEventTest (0 ms total)

[----------] 1 test from ServiceTemplateTest
[ RUN      ] ServiceTemplateTest.testServiceTemplate
[       OK ] ServiceTemplateTest.testServiceTemplate (5 ms)
[----------] 1 test from ServiceTemplateTest (5 ms total)

[----------] 2 tests from BundleRegistryConcurrencyTest
[ RUN      ] BundleRegistryConcurrencyTest.testSerial
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=2244821)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libTestBundleC1d.so+0x1df68)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libTestBundleC1d.so+0x1df68)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libTestBundleC1d.so+0x1df68)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libTestBundleC1d.so+0x1df68)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libTestBundleC1d.so+0x1df68)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (libTestBundleC1d.so+0x1df68)
    #7 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1df68)
    #8 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #9 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b4000000b00 allocated by main thread:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:563 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #10 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x276b91)
    #11 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:104 (usFrameworkTests+0x277246)
    #12 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #13 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M225034021199940424 is already destroyed.

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
[       OK ] BundleRegistryConcurrencyTest.testSerial (189 ms)
[ RUN      ] BundleRegistryConcurrencyTest.testConcurrent
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=2244821)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x1083b6)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x1083b6)
    #3 std::lock_guard<std::mutex>::lock_guard(std::mutex&) /usr/include/c++/10/bits/std_mutex.h:159 (libCppMicroServicesd.so.3.7.6+0x1083b6)
    #4 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:232 (libCppMicroServicesd.so.3.7.6+0x1083b6)
    #5 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x1083b6)
    #6 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x1083b6)
    #7 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x1083b6)
    #8 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xedef2)
    #9 ~InitialBundleMapCleanup /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x10c9f0)
    #10 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x10c9f0)
    #11 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #12 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #13 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:75 (usFrameworkTests+0x275262)
    #14 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #15 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #16 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #17 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #18 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #19 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 40 at 0x7b0c00013f20 allocated by thread T56:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_MakeUniq<std::mutex>::__single_object std::make_unique<std::mutex>() /usr/include/c++/10/bits/unique_ptr.h:962 (libCppMicroServicesd.so.3.7.6+0x10c085)
    #2 cppmicroservices::BundleRegistry::WaitCondition::WaitCondition() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.h:181 (libCppMicroServicesd.so.3.7.6+0x10c085)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:218 (libCppMicroServicesd.so.3.7.6+0x10c085)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #6 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:75 (usFrameworkTests+0x275262)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M328101 (0x7b0c00013f20) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #8 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:75 (usFrameworkTests+0x275262)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T56 (tid=2245616, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x278bcf)
    #3 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277b09)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Write of size 1 at 0x7b14000d1000 by thread T56 (mutexes: write M328063, write M328101):
    #0 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 (libCppMicroServicesd.so.3.7.6+0x1083c7)
    #1 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x1083c7)
    #2 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x1083c7)
    #3 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x1083c7)
    #4 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xedef2)
    #5 ~InitialBundleMapCleanup /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x10c9f0)
    #6 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x10c9f0)
    #7 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #8 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #9 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:75 (usFrameworkTests+0x275262)
    #10 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #11 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #12 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #13 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #14 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #15 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 1 at 0x7b14000d1000 by thread T58 (mutexes: write M328101):
    #0 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x10cc97)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:157 (libCppMicroServicesd.so.3.7.6+0x10cc97)
    #2 wait_for<long double, std::ratio<1, 1000>, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:185 (libCppMicroServicesd.so.3.7.6+0x10cc97)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x10cc97)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #6 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:75 (usFrameworkTests+0x275262)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 80 at 0x7b14000d0fc0 allocated by thread T56:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_Scoped_node::_Scoped_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, true> > >*, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0x110735)
    #2 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::integral_constant<bool, true>, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:1673 (libCppMicroServicesd.so.3.7.6+0x110735)
    #3 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:788 (libCppMicroServicesd.so.3.7.6+0x10c27d)
    #4 std::enable_if<std::is_constructible<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&>::value, std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> >::type std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > > >::insert<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/unordered_map.h:592 (libCppMicroServicesd.so.3.7.6+0x10c27d)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:219 (libCppMicroServicesd.so.3.7.6+0x10c27d)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #8 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:75 (usFrameworkTests+0x275262)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M328063 (0x7b64000021c8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #7 cppmicroservices::BundleRegistry::Load() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:496 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #8 cppmicroservices::CoreBundleContext::Init() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:175 (libCppMicroServicesd.so.3.7.6+0x124175)
    #9 cppmicroservices::FrameworkPrivate::DoInit() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:58 (libCppMicroServicesd.so.3.7.6+0x5c6e3)
    #10 cppmicroservices::FrameworkPrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:189 (libCppMicroServicesd.so.3.7.6+0x5f4ac)
    #11 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #12 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:114 (usFrameworkTests+0x27771d)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M328101 (0x7b0c00013f20) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #8 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:75 (usFrameworkTests+0x275262)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T56 (tid=2245616, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x278bcf)
    #3 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277b09)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T58 (tid=2245618, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x278bcf)
    #3 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277b09)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 in operator()
==================
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=2244821)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #8 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x2755f6)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 40 at 0x7b0c0004ea20 allocated by thread T56:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_MakeUniq<std::mutex>::__single_object std::make_unique<std::mutex>() /usr/include/c++/10/bits/unique_ptr.h:962 (libCppMicroServicesd.so.3.7.6+0x10c085)
    #2 cppmicroservices::BundleRegistry::WaitCondition::WaitCondition() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.h:181 (libCppMicroServicesd.so.3.7.6+0x10c085)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:218 (libCppMicroServicesd.so.3.7.6+0x10c085)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #6 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x2755f6)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M328121 (0x7b0c0004ea20) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #8 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x2755f6)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T56 (tid=2245616, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x278bcf)
    #3 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277b09)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
==================
WARNING: ThreadSanitizer: data race (pid=2244821)
  Write of size 1 at 0x7b14000e69f0 by thread T56 (mutexes: write M328063, write M328121):
    #0 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 (libCppMicroServicesd.so.3.7.6+0x1083c7)
    #1 __invoke_impl<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x1083c7)
    #2 __invoke_r<void, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()>&> /usr/include/c++/10/bits/invoke.h:110 (libCppMicroServicesd.so.3.7.6+0x1083c7)
    #3 _M_invoke /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x1083c7)
    #4 std::function<void ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (usFrameworkTests+0xedef2)
    #5 ~InitialBundleMapCleanup /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:54 (libCppMicroServicesd.so.3.7.6+0x10c9f0)
    #6 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:238 (libCppMicroServicesd.so.3.7.6+0x10c9f0)
    #7 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #8 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #9 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x2755f6)
    #10 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #11 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #12 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #13 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #14 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #15 <null> <null> (libstdc++.so.6+0xceecf)

  Previous read of size 1 at 0x7b14000e69f0 by thread T58 (mutexes: write M328121):
    #0 operator() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x10cc97)
    #1 wait_until<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> >, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:157 (libCppMicroServicesd.so.3.7.6+0x10cc97)
    #2 wait_for<long double, std::ratio<1, 1000>, cppmicroservices::BundleRegistry::Install(const string&, cppmicroservices::BundlePrivate*, const cppmicroservices::AnyMap&)::<lambda()> > /usr/include/c++/10/condition_variable:185 (libCppMicroServicesd.so.3.7.6+0x10cc97)
    #3 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:261 (libCppMicroServicesd.so.3.7.6+0x10cc97)
    #4 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #5 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #6 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x2755f6)
    #7 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #8 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #9 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #10 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #11 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #12 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 80 at 0x7b14000e69b0 allocated by thread T56:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_Scoped_node::_Scoped_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::__detail::_Hashtable_alloc<std::allocator<std::__detail::_Hash_node<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, true> > >*, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/ext/new_allocator.h:115 (libCppMicroServicesd.so.3.7.6+0x110735)
    #2 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::_M_emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::integral_constant<bool, true>, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:1673 (libCppMicroServicesd.so.3.7.6+0x110735)
    #3 std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> std::_Hashtable<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >, std::__detail::_Select1st, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::emplace<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/hashtable.h:788 (libCppMicroServicesd.so.3.7.6+0x10c27d)
    #4 std::enable_if<std::is_constructible<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&>::value, std::pair<std::__detail::_Node_iterator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >, false, true>, bool> >::type std::unordered_map<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition>, std::hash<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::equal_to<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > > >::insert<std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> > >(std::pair<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::pair<unsigned int, cppmicroservices::BundleRegistry::WaitCondition> >&&) /usr/include/c++/10/bits/unordered_map.h:592 (libCppMicroServicesd.so.3.7.6+0x10c27d)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:219 (libCppMicroServicesd.so.3.7.6+0x10c27d)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #8 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x2755f6)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M328063 (0x7b64000021c8) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #7 cppmicroservices::BundleRegistry::Load() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:496 (libCppMicroServicesd.so.3.7.6+0x108bcc)
    #8 cppmicroservices::CoreBundleContext::Init() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/CoreBundleContext.cpp:175 (libCppMicroServicesd.so.3.7.6+0x124175)
    #9 cppmicroservices::FrameworkPrivate::DoInit() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:58 (libCppMicroServicesd.so.3.7.6+0x5c6e3)
    #10 cppmicroservices::FrameworkPrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/util/FrameworkPrivate.cpp:189 (libCppMicroServicesd.so.3.7.6+0x5f4ac)
    #11 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #12 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:114 (usFrameworkTests+0x27771d)
    #13 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #14 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Mutex M328121 (0x7b0c0004ea20) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #5 cppmicroservices::BundleRegistry::Install(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::BundlePrivate*, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:254 (libCppMicroServicesd.so.3.7.6+0x10cc4a)
    #6 cppmicroservices::BundleContext::InstallBundles(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, cppmicroservices::AnyMap const&) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleContext.cpp:529 (libCppMicroServicesd.so.3.7.6+0xd2934)
    #7 InstallTestBundleNoErrorHandling /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:57 (usFrameworkTests+0x274c2a)
    #8 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:77 (usFrameworkTests+0x2755f6)
    #9 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #10 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #11 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #12 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #13 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #14 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T56 (tid=2245616, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x278bcf)
    #3 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277b09)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

  Thread T58 (tid=2245618, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x278bcf)
    #3 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277b09)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: data race /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundleRegistry.cpp:233 in operator()
==================
==================
WARNING: ThreadSanitizer: double lock of a mutex (pid=2244821)
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 __gthread_mutex_lock /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 (libTestBundleC1d.so+0x1df68)
    #2 std::mutex::lock() /usr/include/c++/10/bits/std_mutex.h:100 (libTestBundleC1d.so+0x1df68)
    #3 std::unique_lock<std::mutex>::lock() /usr/include/c++/10/bits/unique_lock.h:138 (libTestBundleC1d.so+0x1df68)
    #4 std::unique_lock<std::mutex>::unique_lock(std::mutex&) /usr/include/c++/10/bits/unique_lock.h:68 (libTestBundleC1d.so+0x1df68)
    #5 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::UniqueLock::UniqueLock(cppmicroservices::detail::MutexLockingStrategy<std::mutex> const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:81 (libTestBundleC1d.so+0x1df68)
    #6 cppmicroservices::detail::MutexLockingStrategy<std::mutex>::Lock() const /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/include/cppmicroservices/detail/Threads.h:152 (libTestBundleC1d.so+0x1df68)
    #7 cppmicroservices::TestBundleC1Activator::RegisterServices(std::shared_future<void>, int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:104 (libTestBundleC1d.so+0x1df68)
    #8 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(std::shared_future<void>, int), cppmicroservices::TestBundleC1Activator*, std::shared_future<void>, int> > >::_M_run() <null> (libTestBundleC1d.so+0xe7bb)
    #9 <null> <null> (libstdc++.so.6+0xceecf)

  Location is heap block of size 248 at 0x7b400005f200 allocated by thread T60:
    #0 operator new(unsigned long) ../../../../src/libsanitizer/tsan/tsan_new_delete.cpp:64 (libtsan.so.0+0x8499c)
    #1 _us_create_activator_TestBundleC1 /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/bundles/libC1/TestBundleC1.cpp:203 (libTestBundleC1d.so+0xaee5)
    #2 cppmicroservices::BundleActivator* std::__invoke_impl<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(std::__invoke_other, cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:60 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #3 std::enable_if<is_invocable_r_v<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>, cppmicroservices::BundleActivator*>::type std::__invoke_r<cppmicroservices::BundleActivator*, cppmicroservices::BundleActivator* (*&)()>(cppmicroservices::BundleActivator* (*&)()) /usr/include/c++/10/bits/invoke.h:113 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #4 std::_Function_handler<cppmicroservices::BundleActivator* (), cppmicroservices::BundleActivator* (*)()>::_M_invoke(std::_Any_data const&) /usr/include/c++/10/bits/std_function.h:291 (libCppMicroServicesd.so.3.7.6+0x104f19)
    #5 std::function<cppmicroservices::BundleActivator* ()>::operator()() const /usr/include/c++/10/bits/std_function.h:622 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #6 cppmicroservices::BundlePrivate::Start0() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:563 (libCppMicroServicesd.so.3.7.6+0x101c71)
    #7 cppmicroservices::BundlePrivate::FinalizeActivation() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:275 (libCppMicroServicesd.so.3.7.6+0x1043bd)
    #8 cppmicroservices::BundlePrivate::Start(unsigned int) /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/BundlePrivate.cpp:436 (libCppMicroServicesd.so.3.7.6+0x104cb1)
    #9 cppmicroservices::Bundle::Start() /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/src/bundle/Bundle.cpp:116 (libCppMicroServicesd.so.3.7.6+0xccaad)
    #10 TestSerialBundleInstall /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:95 (usFrameworkTests+0x276b91)
    #11 void std::__invoke_impl<void, void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(std::__invoke_other, void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:60 (usFrameworkTests+0x27858f)
    #12 std::__invoke_result<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>::type std::__invoke<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework>(void (*&&)(cppmicroservices::Framework const&), cppmicroservices::Framework&&) /usr/include/c++/10/bits/invoke.h:95 (usFrameworkTests+0x27858f)
    #13 void std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (usFrameworkTests+0x27858f)
    #14 std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> >::operator()() /usr/include/c++/10/thread:271 (usFrameworkTests+0x27858f)
    #15 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (*)(cppmicroservices::Framework const&), cppmicroservices::Framework> > >::_M_run() /usr/include/c++/10/thread:215 (usFrameworkTests+0x27858f)
    #16 <null> <null> (libstdc++.so.6+0xceecf)

  Mutex M328461 (0x7b400005f248) created at:
    #0 pthread_mutex_lock ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:4148 (libtsan.so.0+0x4db3a)
    #1 cppmicroservices::TestBundleC1Activator::UnRegister() <null> (libTestBundleC1d.so+0x17740)
    #2 void std::__invoke_impl<void, void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(std::__invoke_memfun_deref, void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:73 (libTestBundleC1d.so+0xbb4f)
    #3 std::__invoke_result<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>::type std::__invoke<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*>(void (cppmicroservices::TestBundleC1Activator::*&&)(), cppmicroservices::TestBundleC1Activator*&&) /usr/include/c++/10/bits/invoke.h:95 (libTestBundleC1d.so+0xbb4f)
    #4 void std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::_M_invoke<0ul, 1ul>(std::_Index_tuple<0ul, 1ul>) /usr/include/c++/10/thread:264 (libTestBundleC1d.so+0xbb4f)
    #5 std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> >::operator()() /usr/include/c++/10/thread:271 (libTestBundleC1d.so+0xbb4f)
    #6 std::thread::_State_impl<std::thread::_Invoker<std::tuple<void (cppmicroservices::TestBundleC1Activator::*)(), cppmicroservices::TestBundleC1Activator*> > >::_M_run() /usr/include/c++/10/thread:215 (libTestBundleC1d.so+0xbb4f)
    #7 <null> <null> (libstdc++.so.6+0xceecf)

  Thread T60 (tid=2245620, running) created by main thread at:
    #0 pthread_create ../../../../src/libsanitizer/tsan/tsan_interceptors_posix.cpp:962 (libtsan.so.0+0x58ba2)
    #1 std::thread::_M_start_thread(std::unique_ptr<std::thread::_State, std::default_delete<std::thread::_State> >, void (*)()) <null> (libstdc++.so.6+0xcf144)
    #2 std::thread& std::vector<std::thread, std::allocator<std::thread> >::emplace_back<void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&>(void (&)(cppmicroservices::Framework const&), cppmicroservices::Framework&) /usr/include/c++/10/bits/vector.tcc:121 (usFrameworkTests+0x278bcf)
    #3 TestBody /home/tcormack/Documents/withCoreInfo/CppMicroServices/framework/test/gtest/BundleRegistryConcurrencyTest.cpp:135 (usFrameworkTests+0x277b09)
    #4 void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) /home/tcormack/Documents/withCoreInfo/CppMicroServices/third_party/googletest/googletest/src/gtest.cc:2631 (libgtestd.so.1.11.0+0xc1d72)
    #5 __libc_start_main ../csu/libc-start.c:308 (libc.so.6+0x23d09)

SUMMARY: ThreadSanitizer: double lock of a mutex /usr/include/x86_64-linux-gnu/c++/10/bits/gthr-default.h:749 in __gthread_mutex_lock
==================
[       OK ] BundleRegistryConcurrencyTest.testConcurrent (310 ms)
[----------] 2 tests from BundleRegistryConcurrencyTest (499 ms total)

[----------] 1 test from StaticBundleTest
[ RUN      ] StaticBundleTest.testStaticBundle
[       OK ] StaticBundleTest.testStaticBundle (3 ms)
[----------] 1 test from StaticBundleTest (3 ms total)

[----------] 1 test from ShrinkableMapTest
[ RUN      ] ShrinkableMapTest.testShrinkableMapOperations
[       OK ] ShrinkableMapTest.testShrinkableMapOperations (0 ms)
[----------] 1 test from ShrinkableMapTest (0 ms total)

[----------] 5 tests from FrameworkListenerTest
[ RUN      ] FrameworkListenerTest.testStartStopFrameworkEvents
[       OK ] FrameworkListenerTest.testStartStopFrameworkEvents (1 ms)
[ RUN      ] FrameworkListenerTest.testAddRemoveFrameworkListener
[       OK ] FrameworkListenerTest.testAddRemoveFrameworkListener (5 ms)
[ RUN      ] FrameworkListenerTest.testFrameworkListenersAfterFrameworkStop
[       OK ] FrameworkListenerTest.testFrameworkListenersAfterFrameworkStop (2 ms)
[ RUN      ] FrameworkListenerTest.testFrameworkListenerThrowingInvariant
[       OK ] FrameworkListenerTest.testFrameworkListenerThrowingInvariant (4 ms)
[ RUN      ] FrameworkListenerTest.testDeadLock
[       OK ] FrameworkListenerTest.testDeadLock (2 ms)
[----------] 5 tests from FrameworkListenerTest (16 ms total)

[----------] 4 tests from BundleHooksTest
[ RUN      ] BundleHooksTest.TestFindHook
[       OK ] BundleHooksTest.TestFindHook (2 ms)
[ RUN      ] BundleHooksTest.TestEventHook
[       OK ] BundleHooksTest.TestEventHook (2 ms)
[ RUN      ] BundleHooksTest.TestEventHookFailure
[       OK ] BundleHooksTest.TestEventHookFailure (2 ms)
[ RUN      ] BundleHooksTest.TestFindHookFailure
[       OK ] BundleHooksTest.TestFindHookFailure (2 ms)
[----------] 4 tests from BundleHooksTest (10 ms total)

[----------] 6 tests from ServiceHooksTest
[ RUN      ] ServiceHooksTest.TestListenerHook
[       OK ] ServiceHooksTest.TestListenerHook (14 ms)
[ RUN      ] ServiceHooksTest.TestFindHook
[       OK ] ServiceHooksTest.TestFindHook (13 ms)
[ RUN      ] ServiceHooksTest.TestEventListenerHook
[       OK ] ServiceHooksTest.TestEventListenerHook (3 ms)
[ RUN      ] ServiceHooksTest.TestFindHookFailure
[       OK ] ServiceHooksTest.TestFindHookFailure (8 ms)
[ RUN      ] ServiceHooksTest.TestEventListenerHookFailure
[       OK ] ServiceHooksTest.TestEventListenerHookFailure (2 ms)
[ RUN      ] ServiceHooksTest.TestListenerHookFailure
[       OK ] ServiceHooksTest.TestListenerHookFailure (2 ms)
[----------] 6 tests from ServiceHooksTest (45 ms total)

[----------] 7 tests from CounterLatchTest
[ RUN      ] CounterLatchTest.TestInitialState
[       OK ] CounterLatchTest.TestInitialState (0 ms)
[ RUN      ] CounterLatchTest.TestCountUp
[       OK ] CounterLatchTest.TestCountUp (0 ms)
[ RUN      ] CounterLatchTest.TestCountUpConcurrent
[       OK ] CounterLatchTest.TestCountUpConcurrent (25 ms)
[ RUN      ] CounterLatchTest.TestCountDown_Initial
[       OK ] CounterLatchTest.TestCountDown_Initial (0 ms)
[ RUN      ] CounterLatchTest.TestCountDown_AfterCountUp
[       OK ] CounterLatchTest.TestCountDown_AfterCountUp (0 ms)
[ RUN      ] CounterLatchTest.TestWait
[       OK ] CounterLatchTest.TestWait (0 ms)
[ RUN      ] CounterLatchTest.TestWaitAfterCountUp
[       OK ] CounterLatchTest.TestWaitAfterCountUp (25 ms)
[----------] 7 tests from CounterLatchTest (50 ms total)

[----------] 26 tests from ResourceCompilerTest
[ RUN      ] ResourceCompilerTest.testEscapePath
[       OK ] ResourceCompilerTest.testEscapePath (0 ms)
[ RUN      ] ResourceCompilerTest.testManifestAdd
[       OK ] ResourceCompilerTest.testManifestAdd (12 ms)
[ RUN      ] ResourceCompilerTest.testManifestResAdd
[       OK ] ResourceCompilerTest.testManifestResAdd (14 ms)
[ RUN      ] ResourceCompilerTest.testResAdd
[       OK ] ResourceCompilerTest.testResAdd (11 ms)
[ RUN      ] ResourceCompilerTest.testZipAdd
[       OK ] ResourceCompilerTest.testZipAdd (13 ms)
[ RUN      ] ResourceCompilerTest.testZipAddBundle
[       OK ] ResourceCompilerTest.testZipAddBundle (14 ms)
[ RUN      ] ResourceCompilerTest.testZipAddTwice
[       OK ] ResourceCompilerTest.testZipAddTwice (10 ms)
[ RUN      ] ResourceCompilerTest.testBundleManifestZipAdd
[       OK ] ResourceCompilerTest.testBundleManifestZipAdd (15 ms)
[ RUN      ] ResourceCompilerTest.testCompressionLevel
[       OK ] ResourceCompilerTest.testCompressionLevel (29 ms)
[ RUN      ] ResourceCompilerTest.testDuplicateManifestFileAdd
[       OK ] ResourceCompilerTest.testDuplicateManifestFileAdd (13 ms)
[ RUN      ] ResourceCompilerTest.testHelpReturnsZero

USAGE: usResourceCompiler3 [options]

Options:
 --help, -h               Print usage and exit.
 --verbose, -V            Run in verbose mode.
 --bundle-name, -n        The bundle name as specified in the US_BUNDLE_NAME
                          compile definition.
 --compression-level, -c  Compression level used for zip. Value range is 0 to 9.
                          Default value is 6.
 --out-file, -o           Path to output zip file. If the file exists it will be
                          overwritten. If this option is not provided, a
                          temporary zip fie will be created.
 --res-add, -r            Path to a resource file, relative to the current
                          working directory.
 --zip-add, -z            Path to a file containing a zip archive to be merged
                          into the output zip file. 
 --manifest-add, -m       Path to a bundle manifest file. Multiple bundle
                          manifests will be concatenated together into one.
 --bundle-file, -b        Path to the bundle binary. The resources zip file will
                          be appended to this binary. 

Note:
1. Only options --res-add and --zip-add can be specified multiple times.

2. If option --manifest-add or --res-add is specified, option --bundle-name must
be provided.

3. At-least one of --bundle-file or --out-file options must be provided.

Examples:

Create a zip file with resources:
  usResourceCompiler3 --compression-level 9 --verbose --bundle-name mybundle
--out-file Example.zip --manifest-add manifest.json --zip-add filetomerge.zip
Behavior: Construct a zip blob with contents 'mybundle/manifest.json', merge the
contents of zip file 'filetomerge.zip' into it and write the resulting blob into
'Example.zip'


Append a bundle with resources
  usResourceCompiler3 -V -n mybundle -b mybundle.dylib -m manifest.json -z
archivetomerge.zip
Behavior: Construct a zip blob with contents 'mybundle/manifest.json', merge the
contents of zip file 'archivetomerge.zip' into it and append the resulting zip
blob to 'mybundle.dylib'


Append a bundle binary with existing zip file
  usResourceCompiler3.exe -b mybundle.dll -z archivetoembed.zip
Behavior: Append the contents of 'archivetoembed.zip' to 'mybundle.dll'

[       OK ] ResourceCompilerTest.testHelpReturnsZero (11 ms)
[ RUN      ] ResourceCompilerTest.testFailureModes
unrecognized options ...
	test2.dll
At least one of the options (--bundle-file | --out-file) is required. Check usage.
Error: Could not open file file_does_not_exist.json
--bundle-file appears multiple times in the arguments. Check usage.
--out-file appears multiple times in the arguments. Check usage.
--bundle-name appears multiple times in the arguments. Check usage.
At least one of the options (--bundle-file | --out-file) is required. Check usage.
At least one of the options (--bundle-file | --out-file) is required. Check usage.
If either --manifest-add or --res-add is provided, --bundle-name must be provided.
At least one of the options (--bundle-file | --out-file) is required. Check usage.
If either --manifest-add or --res-add is provided, --bundle-name must be provided.
At least one of the options (--bundle-file | --out-file) is required. Check usage.
At least one of the options (--bundle-file | --out-file) is required. Check usage.
Warning: --bundle-name option is unnecessary here.
Error: Found duplicate file with name mybundle/manifest.json
[       OK ] ResourceCompilerTest.testFailureModes (131 ms)
[ RUN      ] ResourceCompilerTest.testManifestAddWithInvalidJSON
JSON Parsing Error: /tmp/usdir-jO6Cmj/manifest.json: * Line 5, Column 4
  Missing ',' or '}' in object declaration

JSON Parsing Error: /tmp/usdir-jO6Cmj/manifest.json: * Line 5, Column 4
  Missing ',' or '}' in object declaration

JSON Parsing Error: manifest.json: * Line 5, Column 4
  Missing ',' or '}' in object declaration

JSON Parsing Error: manifest.json: * Line 5, Column 4
  Missing ',' or '}' in object declaration

[       OK ] ResourceCompilerTest.testManifestAddWithInvalidJSON (43 ms)
[ RUN      ] ResourceCompilerTest.testUnicodeBundleFile
[       OK ] ResourceCompilerTest.testUnicodeBundleFile (8 ms)
[ RUN      ] ResourceCompilerTest.testUnicodeBundleName
Warning: --bundle-name option is unnecessary here.
[       OK ] ResourceCompilerTest.testUnicodeBundleName (8 ms)
[ RUN      ] ResourceCompilerTest.testUnicodeOutFile
[       OK ] ResourceCompilerTest.testUnicodeOutFile (9 ms)
[ RUN      ] ResourceCompilerTest.testUnicodeResAdd
using compression level 6
Initializing zip archive unicodeResAdd00.zip ...
Adding file myunicodebundle00//manifest.json ...
	 new dir entry myunicodebundle00/
	 new dir entry myunicodebundle00//
Finalizing the zip archive ...
Archive has the following files
	 myunicodebundle00//manifest.json
and directory entries
	 myunicodebundle00/
	 myunicodebundle00//
Validating manifests in unicodeResAdd00.zip ... 
	Validating: myunicodebundle00//manifest.json (from unicodeResAdd00.zip) 
	Validating: myunicodebundle00/ (from unicodeResAdd00.zip) 
	Validating: myunicodebundle00// (from unicodeResAdd00.zip) 
Finished validating manifest files from myunicodebundle00//
Appending file /myArchive03.zip with contents of resources zip file at unicodeResAdd00.zip
  Initial file size : 0
  Final file size : 555
[       OK ] ResourceCompilerTest.testUnicodeResAdd (11 ms)
[ RUN      ] ResourceCompilerTest.testUnicodeZipAdd
Warning: --bundle-name option is unnecessary here.
[       OK ] ResourceCompilerTest.testUnicodeZipAdd (8 ms)
[ RUN      ] ResourceCompilerTest.testUnicodeManifestAdd
[       OK ] ResourceCompilerTest.testUnicodeManifestAdd (14 ms)
[ RUN      ] ResourceCompilerTest.testManifestAddWithJSONComments
[       OK ] ResourceCompilerTest.testManifestAddWithJSONComments (11 ms)
[ RUN      ] ResourceCompilerTest.testManifestAddWithDuplicateKeys
JSON Parsing Error: /tmp/usdir-jO6Cmj/manifest.json: * Line 7, Column 4
  Duplicate key: 'bundle.name'

JSON Parsing Error: /tmp/usdir-jO6Cmj/manifest.json: * Line 7, Column 4
  Duplicate key: 'bundle.name'

JSON Parsing Error: manifest.json: * Line 7, Column 4
  Duplicate key: 'bundle.name'

JSON Parsing Error: manifest.json: * Line 7, Column 4
  Duplicate key: 'bundle.name'

[       OK ] ResourceCompilerTest.testManifestAddWithDuplicateKeys (49 ms)
[ RUN      ] ResourceCompilerTest.testAppendZipWithInvalidManifest
Warning: --bundle-name option is unnecessary here.
JSON Parsing Error: /tmp/usdir-jO6Cmj/append_invalid_manifest_zip.zip (invalid/manifest.json) : * Line 5, Column 10
  Missing ',' or '}' in object declaration

[       OK ] ResourceCompilerTest.testAppendZipWithInvalidManifest (24 ms)
[ RUN      ] ResourceCompilerTest.testZipMergeWithInvalidManifest
Warning: --bundle-name option is unnecessary here.
JSON Parsing Error: /tmp/usdir-jO6Cmj/invalid_manifest.zip (invalid/manifest.json) : * Line 5, Column 4
  Missing ',' or '}' in object declaration

[       OK ] ResourceCompilerTest.testZipMergeWithInvalidManifest (12 ms)
[ RUN      ] ResourceCompilerTest.testMultipleManifestAdd
JSON Parsing Error: /tmp/usdir-jO6Cmj/invalid_manifest.json: * Line 4, Column 4
  Missing ',' or '}' in object declaration

JSON Parsing Error: Duplicate key: 'test' found in /tmp/usdir-jO6Cmj/duplicate_manifest.json
[       OK ] ResourceCompilerTest.testMultipleManifestAdd (39 ms)
[ RUN      ] ResourceCompilerTest.testMultipleManifestConcatenation
[       OK ] ResourceCompilerTest.testMultipleManifestConcatenation (19 ms)
[ RUN      ] ResourceCompilerTest.testManifestWithNullTerminator
[       OK ] ResourceCompilerTest.testManifestWithNullTerminator (24 ms)
[----------] 26 tests from ResourceCompilerTest (565 ms total)

[----------] 3 tests from MultipleListenersTest
[ RUN      ] MultipleListenersTest.testMultipleListeners
[       OK ] MultipleListenersTest.testMultipleListeners (31 ms)
[ RUN      ] MultipleListenersTest.testListenerTypes
[       OK ] MultipleListenersTest.testListenerTypes (161 ms)
[ RUN      ] MultipleListenersTest.testConcurrentAdd
[       OK ] MultipleListenersTest.testConcurrentAdd (405 ms)
[----------] 3 tests from MultipleListenersTest (598 ms total)

[----------] 20 tests from BundleTest
[ RUN      ] BundleTest.testFramework
[       OK ] BundleTest.testFramework (3 ms)
[ RUN      ] BundleTest.testNonDefaultFramework
[       OK ] BundleTest.testNonDefaultFramework (4 ms)
[ RUN      ] BundleTest.TestListenerFunctors
[       OK ] BundleTest.TestListenerFunctors (2 ms)
[ RUN      ] BundleTest.TestBundleStates
[       OK ] BundleTest.TestBundleStates (107 ms)
[ RUN      ] BundleTest.TestForInstallFailure
[       OK ] BundleTest.TestForInstallFailure (2 ms)
[ RUN      ] BundleTest.TestDuplicateInstall
[       OK ] BundleTest.TestDuplicateInstall (2 ms)
[ RUN      ] BundleTest.TestAutoInstallEmbeddedBundles
[       OK ] BundleTest.TestAutoInstallEmbeddedBundles (1 ms)
[ RUN      ] BundleTest.TestNonStandardBundleExtension
[       OK ] BundleTest.TestNonStandardBundleExtension (2 ms)
[ RUN      ] BundleTest.TestUnicodePaths
Skipping test point for unicode path
[       OK ] BundleTest.TestUnicodePaths (1 ms)
[ RUN      ] BundleTest.TestBundleStartOptions
[       OK ] BundleTest.TestBundleStartOptions (2 ms)
[ RUN      ] BundleTest.TestBundleLessThanOperator
[       OK ] BundleTest.TestBundleLessThanOperator (2 ms)
[ RUN      ] BundleTest.TestBundleAssignmentOperator
[       OK ] BundleTest.TestBundleAssignmentOperator (2 ms)
[ RUN      ] BundleTest.TestBundleGetProperties
[       OK ] BundleTest.TestBundleGetProperties (1 ms)
[ RUN      ] BundleTest.TestBundleGetProperty
[       OK ] BundleTest.TestBundleGetProperty (1 ms)
[ RUN      ] BundleTest.TestBundleGetPropertyKeys
[       OK ] BundleTest.TestBundleGetPropertyKeys (1 ms)
[ RUN      ] BundleTest.TestBundleManifestFailures
[       OK ] BundleTest.TestBundleManifestFailures (3 ms)
[ RUN      ] BundleTest.TestIllegalBundleStateChange
[       OK ] BundleTest.TestIllegalBundleStateChange (7 ms)
[ RUN      ] BundleTest.TestBundleActivatorFailures
[       OK ] BundleTest.TestBundleActivatorFailures (12 ms)
[ RUN      ] BundleTest.TestBundleStreamOperator
Bundle[id=2, loc=/home/tcormack/Documents/withCoreInfo/CppMicroServices/build/glnxa64/lib/libTestBundleAd.so, name=TestBundleA, state=INSTALLED][       OK ] BundleTest.TestBundleStreamOperator (9 ms)
[ RUN      ] BundleTest.TestFrameworkAccessDuringFrameworkShutdown
[       OK ] BundleTest.TestFrameworkAccessDuringFrameworkShutdown (14 ms)
[----------] 20 tests from BundleTest (193 ms total)

[----------] 1 test from SharedLibraryTest
[ RUN      ] SharedLibraryTest.TestSharedLibraryOperations
[       OK ] SharedLibraryTest.TestSharedLibraryOperations (0 ms)
[----------] 1 test from SharedLibraryTest (0 ms total)

[----------] 4 tests from ServiceListenerTest
[ RUN      ] ServiceListenerTest.frameSL02a
[       OK ] ServiceListenerTest.frameSL02a (2 ms)
[ RUN      ] ServiceListenerTest.frameSL05a
[       OK ] ServiceListenerTest.frameSL05a (2 ms)
[ RUN      ] ServiceListenerTest.frameSL10a
[       OK ] ServiceListenerTest.frameSL10a (2 ms)
[ RUN      ] ServiceListenerTest.frameSL25a
[       OK ] ServiceListenerTest.frameSL25a (5 ms)
[----------] 4 tests from ServiceListenerTest (13 ms total)

[----------] Global test environment tear-down
[==========] 300 tests from 51 test suites ran. (11181 ms total)
[  PASSED  ] 300 tests.
ThreadSanitizer: reported 27 warnings
